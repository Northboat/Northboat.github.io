---
date: 2024-6-22
permalink: /pages/ce21a8/
author: 
  name: Arkrypto
  link: https://github.com/Arkrypto
title: å¸¸è§çš„åŒå› ç´ è®¤è¯ - UKEY
---

## ä»€ä¹ˆæ˜¯ 2FAï¼Ÿ

2FAï¼ŒTwo-Factor Authenticationï¼Œå³åŒå› ç´ è®¤è¯

- ä¼ ç»Ÿçš„è´¦å·å¯†ç ä¸ºå•é‡è®¤è¯ï¼Œå¦‚ QQ çš„ç™»å½•ï¼›Stream çš„ç™»å½•åˆ™ä¸ºåŒå› ç´ ï¼Œä¸€é‡ä¸ºè´¦å·å¯†ç ï¼ŒäºŒä¸ºæ‰‹æœºæ¥æ”¶çš„è®¤è¯ç çŸ­ä¿¡

å¯†ç  + æŸç§ä¸ªäººç‰©å“æ˜¯å¸¸è§çš„åŒå› ç´ ç»„åˆï¼Œå¦‚é“¶è¡Œä½¿ç”¨çš„ U ç›¾ï¼ˆä¸€ä¸ª U ç›˜ï¼‰ï¼Œåœ¨æ­¤å¤„ U ç›¾ å……å½“â€œæŸç§ä¸ªäººç‰©å“â€çš„ä½œç”¨ï¼Œæ¯ä½ç”¨æˆ·å°†é…å¤‡å„è‡ªçš„ U ç›¾ï¼Œå†…ç½®æœ‰ç”¨æˆ·çš„ç­¾åè¯ä¹¦ä¸åŠ å¯†è¯ä¹¦ï¼ŒåŒæ—¶ U ç›¾çš„è®¿é—®å— PIN ç ä¿æŠ¤

ä¸€ç§å…¸å‹å®ç°æ–¹æ¡ˆä¸º

- ç”¨æˆ·åœ¨å®Œæˆå£ä»¤ã€éªŒè¯ç çš„è¾“å…¥åï¼Œå‰ç«¯è°ƒç”¨ USBKEY çš„æ¥å£å¯¹ç™»å½•è¯·æ±‚æ•°æ®è¿›è¡Œç­¾åï¼Œå¹¶ä¸”å°†è¯¥ç­¾åä½œä¸ºä¸€ä¸ªå­—æ®µåŠ å…¥ HTTP è¯·æ±‚ä¸­
- åç«¯ç³»ç»Ÿä¼šéƒ¨ç½²ä¸€ä¸ªç­¾åéªŒç­¾æœåŠ¡å™¨ï¼Œæ¥æ”¶åˆ°å‰ç«¯ç™»å½•è¯·æ±‚åï¼Œåˆ©ç”¨ç­¾åéªŒç­¾æœåŠ¡å™¨å®ŒæˆéªŒç­¾ï¼ŒéªŒç­¾æ­£ç¡®åˆ™èº«ä»½é‰´åˆ«é€šè¿‡ï¼Œè€Œåå†è¿›è¡Œå¯†ç çš„è®¤è¯ï¼Œå®ç°åŒå› ç´ è®¤è¯

æœ¬æ–‡é‡‡ç”¨å¥¥è”çš„ USBKEY ä»¥åŠå…¶ç›¸å¯¹åº”çš„å¯†ç æœºå®ç° U ç›¾çš„ 2FA è®¤è¯ã€‚çœŸçš„ä¸å¾—ä¸è¯´ï¼Œå¥¥è”ç»™çš„æ¥å£ç®€ç›´æ˜¯ä¸€å¨å¤§èŠ¬ğŸ¤®ï¼Œæ–‡æ¡£æ›´æ˜¯ç‰›å¤´ä¸å¯¹é©¬å˜´

## å®ç°

ä¸€äº›å‰ç½®å·¥ä½œ

- ç”¨æˆ· UKEY ä¸­æ‰€ä½¿ç”¨çš„ç­¾åè¯ä¹¦éœ€è¦åœ¨åç«¯ç­¾åéªŒç­¾æœåŠ¡å™¨ä¸­æ³¨å†Œ
- ä¸‹è½½å®‰è£… UKEY çš„æ’ä»¶ç¯å¢ƒ
- éœ€è¦ä¸€ä¸ªå€’éœ‰è›‹å°† U ç›˜ä»è¥¿å®‰é‚®åˆ°ç§¦çš‡å²›

### UKEY ç¯å¢ƒæ£€æµ‹

é‡‡ç”¨ WebSocket å½¢å¼çš„æ¥å£ï¼ˆæ„å¼å¥¥è”æä¾›çš„ï¼‰å¯¹å‰ç«¯è¡¨å•æ•°æ®è¿›è¡Œ SGD_SM3_SM2 è¿›è¡Œç­¾åï¼Œè¯¥ UKEY æ¥å£å†…éƒ¨å†™æ­» SignerID ä¸º`"1234567812345678"`ï¼ˆé»˜è®¤ IDï¼‰ï¼Œè¿™åœ¨åç»­éªŒç­¾æ—¶éœ€ä¿æŒä¸€è‡´

æ£€æµ‹æ’ä»¶ç¯å¢ƒä»¥åŠæ˜¯å¦æ’å…¥ U ç›¾

```js
envCheck(){
    if(!ntlsUtil.wsObj){
        ntlsUtil.websocketInit(this.check_plugin_exist, null, this.check_plugin_exist);
    } else {
        this.check_plugin_exist();
    }
}
```

ntlsUtil æ˜¯ä»å¥¥è”æ¥å£ä¸­å¯¼å…¥çš„å…¨å±€å·¥å…·ç±»

```js
import { ntlsUtil } from '@/utils/ntls-plugin'
```

å¦‚æœ ntlsUtil.wsObj ä¸ä¸ºç©ºï¼Œå³ websocket è¿æ¥æ‰“å¼€ï¼Œåˆ™è®¤ä¸ºå·²ç»æ£€æŸ¥è¿‡ä¸è¿›è¡Œåç»­æ“ä½œï¼ˆå› ä¸ºæ£€æŸ¥è¿‡ç¨‹ä¼šä¸»åŠ¨æ‰“å¼€ websocketï¼Œè‹¥åœ¨å·²è¿æ¥çš„æƒ…å†µä¸‹å†æ‰“å¼€ä¼šæŠ¥é”™ï¼Œæ‰€ä»¥è¿™é‡Œè¿™ä¹ˆå¤„ç†ï¼Œä½†åœ¨åç»­å¼•å‘äº†å…¶ä»–é—®é¢˜ï¼‰

æ’ä»¶æ£€æŸ¥

```js
//æ£€æŸ¥æ’ä»¶
check_plugin_exist(){
    if(ntlsUtil.pluginExist==false){
        //è¿æ¥ä¸æˆåŠŸ,æ’ä»¶æœªå®‰è£…æˆ–è€…æœåŠ¡æœªå¯åŠ¨
        alert("è¿æ¥ä¸æˆåŠŸ,æ’ä»¶æœªå®‰è£…æˆ–è€…æœåŠ¡æœªå¯åŠ¨")
        return false;
    }
    //step4 æ£€æµ‹æ˜¯å¦æ’å…¥ukey, æ‰€æœ‰æ¥æ”¶ä¿¡æ¯çš„å›è°ƒå‡½æ•°åç§°éƒ½ä¸ºå½“å‰å‘é€æ¶ˆæ¯çš„actionåç§° 
    ntlsUtil.func.enumerate_ukey_user(this.enumerate_ukey_user);
}
```

`ntlsUtil.func.enumerate_ukey_user()`æ˜¯ä¸€ä¸ªå¼‚æ­¥å‡½æ•°ï¼Œä¼ å‚ä¸ºå›è°ƒå‡½æ•°ï¼Œå¯¹å¼‚æ­¥è¿”å›çš„æ•°æ®è¿›è¡Œå¤„ç†ï¼Œ`this.enumerate_ukey_user`å¦‚ä¸‹

```js
enumerate_ukey_user(message){
    if(message == null){
        alert("WebSocketæ£€æµ‹è¯·æ±‚å¤±è´¥")
        return false;
    }
    var ukey_exist = false;
    for(var i = 0; i < message.data.usbkey.length; i++){
        var key_data = message.data.usbkey[i];
        if(typeof key_data.keytype != 'undefined'){
            if(this.check_key_type == true &&  key_data.keytype != this.key_type ){ }
            else{
                //keytype=file åœ¨ç§é’¥æ ‡è¯†ä¸­æŸ¥æ‰¾ï¼Œä»æ¯ä¸ªidentity.0.type æŸ¥æ‰¾sm2/sm9/...
                var this_ukey_exist = false;
                var length = key_data.identity.length;
                for (var m = 0; m < length; m++){
                    //åªåŒ¹é…éœ€è¦çš„alg
                    if(key_data.identity[m].type.toUpperCase().indexOf(this.alg_type) != -1){
                        this_ukey_exist = true;//å±€éƒ¨
                    }
                }
                if(this_ukey_exist){
                    ukey_exist = true;//å…¨å±€
                }
            }
        } else {
            //key_type=usbkey  åœ¨äº§å•†ä¸­æŸ¥æ‰¾
            if(key_data.manufacturer.toUpperCase().indexOf(alg_type)!==-1 || key_data.alg.toUpperCase().indexOf(this.alg_type)!==-1 ){
                ukey_exist = true;
            }
        }
    }
    if(ukey_exist == false){
        alert('æœªæ£€æµ‹åˆ°'+this.alg_type+'ç§é’¥æ ‡è¯†'); //æŒ‰æ‰­åŠŸèƒ½ ï¼Œæ£€æµ‹sm2/sm9ç­‰ UKEYæ˜¯å¦æ’ä»¶
        return false;
    }else{
        console.log('æ£€æµ‹åˆ°'+this.alg_type+'ç§é’¥æ ‡è¯†',true,true);
        console.log(JSON.stringify(message));
        this.keyindex = message.data.usbkey[0].keyindex;
        this.container = message.data.usbkey[0].identity[0].container;
        console.log("keyindex: " + this.keyindex + "\ncontainer: " + this.container);
        this.ret = true;
    }
}
```

è¯·æ±‚å®Œæ¯•åï¼Œå°† UKEY ä¸­çš„`keyindex`å’Œ`container`å­˜åœ¨å‰ç«¯ç»´æŠ¤çš„ä¸¤ä¸ªå˜é‡ä¸­ï¼Œåœ¨åç»­ç™»é™†æ—¶ä½¿ç”¨

### ç”¨æˆ·æ³¨å†Œ

ç³»ç»Ÿè¦æ±‚ç”¨æˆ·æ³¨å†Œæ—¶å½•å…¥ç”¨æˆ·æ‰€ä½¿ç”¨ UKEY ä¸­çš„è¯ä¹¦ä¿¡æ¯ï¼ŒåŒæ ·é‡‡ç”¨å¼‚æ­¥å‡½æ•°è·å–

```js
handleRegister() {
    this.$refs.registerForm.validate(valid => {
        if (valid) {
            this.loading = true
            let ukey_val = this.keyindex;
            let identity_val = this.container;
            ntlsUtil.func.get_cert_content(ukey_val, identity_val, 1, this.doRegister);
        }
    })
},
// message ä¸­ä¸ºè¯ä¹¦ä¿¡æ¯
doRegister(message){
    if(!message || !message.data){
        alert("è·å–è¯ä¹¦å†…å®¹å¤±è´¥");
        return false;
    }
    console.log(message.data)
    // æˆªå–cert
    let cert = message.data.replace(/[\r\n]/g,"");
    cert = cert.substr(27, cert.length)
    cert = cert.substr(0, cert.indexOf("-"))
    console.log(cert)

    this.registerForm.certificate = cert;
    register(this.registerForm).then(() => {
        this.$message({
            message: 'æ³¨å†ŒæˆåŠŸï¼Œå³å°†è¿”å›ç™»å½•é¡µé¢ï¼',
            type: 'success',
            duration: 2000
        })
        this.loginForm.username = this.registerForm.username
        this.loginForm.password = this.registerForm.password
        setTimeout(() => {
            this.switchLogin = true
        }, 1500)
        this.$refs['registerForm'].resetFields()
    }).finally(() => {
        this.loading = false
    })
},
```

### ç­¾ååŠç™»å½•

è¡¨å•æ•°æ®åœ¨ç­¾åå‰éœ€è¦è¿›è¡Œ Base64 ç¼–ç å¤„ç†

```js
encodeBase64(str){
    return Buffer.from(str, 'utf8').toString('base64');
}
```

ç”¨æˆ·æ³¨å†ŒæˆåŠŸï¼Œå¹¶ä¸”åœ¨é¡µé¢æ­£å¸¸è·å¾— UKEY ä¿¡æ¯åï¼Œæ‰§è¡Œç™»é™†æ“ä½œï¼Œpass ä¸º UKEY çš„ PIN ç ï¼Œéœ€è¦ç”¨æˆ·åœ¨å‰ç«¯æ‰‹åŠ¨è¾“å…¥

```js
// ç™»å½•
handleLogin() {
    this.$refs.loginForm.validate(valid => {
        valid = valid && this.ret // this.ret åœ¨ç¯å¢ƒæ£€æµ‹é€šè¿‡åç½®ä¸º trueï¼Œvalid ä¸ºè¡¨å•æ•°æ®åˆæ³•æ€§
        if (valid) {
            this.loading = true
            this.loginForm.iniData = JSON.stringify(this.loginForm);
            console.log(this.loginForm.iniData);
            let inData = this.encodeBase64(this.loginForm.iniData);
            let ukey_val = this.keyindex;
            let identity_val = this.container;
            let pass = this.loginForm.key;
            let hashtype = "";
            let format = "asn.1";
            // æ³¨æ„è¿™é‡Œè¦æ ‡æ˜ format ä¸º asn.1
            ntlsUtil.func.data_sm2_signature(ukey_val, identity_val, pass, inData, hashtype, format, this.doLogin);
        } else {
            console.log('error submit!!');
            alert("error submit!")
            return false
        }
    })
}
```

æ ¸å¿ƒåœ¨äºè¿™æ¡åŠ å¯†å‡½æ•°

```js
ntlsUtil.func.data_sm2_signature(ukey_val, identity_val, pass, inData, hashtype, format, this.doLogin);
```

`ukey_val`å’Œ`identity_val`ä¸ºç¯å¢ƒæ£€æµ‹æ—¶è·å–çš„ UKEY ä¿¡æ¯`keyindex`å’Œ`container`ï¼Œ`pass`ä¸º UKEY çš„ PIN ç ï¼Œ`inData`ä¸ºç™»é™†çš„è¡¨å•åŸæ–‡ï¼ˆJson æ•°æ®ï¼‰ï¼Œå¦‚

```json
"{\"account\":\"wx\", \"password\":\"123456\", \"verify_code\":\"dQ3k\", \"PIN\":\"123456\"}"
```

`this.doLogin`ä¸ºå›è°ƒå‡½æ•°ï¼Œä¼ å…¥çš„`message`ä¸ºç­¾åæ•°æ®

```js
// æ‰“è¯·æ±‚
doLogin(message){
    if(!message || !message.data){
        alert("ç­¾åå¤±è´¥, è¯·æ£€æŸ¥UKeyæ˜¯å¦æ’å…¥æˆ–PINç æ˜¯å¦æ­£ç¡®, æˆ–PINç æ˜¯å¦è¢«é”å®š");
        this.loading = false;
        return false;
    }
    console.log("ç­¾åæ‰€ç”¨è¯ä¹¦ä¸º: " + this.cert  + "\nå‰ç«¯ç­¾ååŸæ–‡ä¸º" + this.encodeBase64(this.loginForm.iniData) + "\nå‰ç«¯ç­¾åæ‰€å¾—å¯†æ–‡ä¸º: " + message.data)
    this.loginForm.signature = message.data;

    this.$store.dispatch('user/login', this.loginForm).then(() => {
        localStorage.setItem("pin", this.loginForm.key);
        localStorage.setItem("keyindex", this.keyindex);
        localStorage.setItem("container", this.container);
        this.$router.push({ path: this.redirect || '/' })

        this.loading = false
    }).catch(() => {
        this.loading = false
    })
}
```

æ³¨æ„ä¼ å…¥çš„åŸæ–‡æ•°æ®éœ€è¦æ˜¯ Base64 ç¼–ç ï¼Œå¹¶ä¸”åœ¨ç­¾åæ—¶ï¼Œå¿…é¡»è¦è§„å®šä¼ å‚`format`ä¸º`asn.1`ï¼Œæ‰èƒ½ç­¾åå¾—åˆ° Base64 ç¼–ç çš„å¯†æ–‡ï¼Ÿå¥¥è”çœŸçš„æ˜¯ä¸€å¨æ„æ€

å¦å¤–è¿™é‡Œéå¸¸ä¸ä¼˜é›…çš„æŠŠä¸€ç³»åˆ—ä¿¡æ¯å­˜åˆ°äº† localStorageï¼Œå› ä¸ºåœ¨åç»­çš„è½¬è´¦æ“ä½œä¸­è¦ç”¨åˆ°ï¼Œä¸ºä»€ä¹ˆè¦è¿™ä¹ˆå†™ï¼Ÿï¼Ÿå”‰ï¼Œæ˜¯è¿™æ ·

1. ä¹‹å‰åœ¨æ£€æµ‹ç¯å¢ƒæ—¶è¯´è¿‡ï¼Œæ˜¯å¦æ£€æµ‹çš„æ¡ä»¶æ˜¯ websocket æ˜¯å¦è¿æ¥ï¼Œè¿™å°±é€ æˆç™»å½•æ—¶ç”¨çš„è¿™ä¸ªè¿æ¥ä¸€ç›´ä¿æŒï¼Œäºæ˜¯åœ¨åç»­å¹¶ä¸ä¼šè¿›è¡Œç¯å¢ƒæ£€æµ‹
2. æ‰€ä»¥å‘¢ï¼Œåœ¨è½¬è´¦é¡µé¢ï¼Œæ²¡æœ‰è¿›è¡Œç¯å¢ƒæ£€æµ‹ï¼Œè‡ªç„¶å°±ä¸ä¼šå»éå†é’¥åŒ™ï¼Œå°±ä¸ä¼šè·å¾—`keyindex`å’Œ`container`ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘å·æ‡’ç›´æ¥å­˜äº†ï¼Œåˆ°æ—¶å€™ç›´æ¥å–äº†ç”¨

æ­£ç¡®çš„æµç¨‹åº”è¯¥æ˜¯ï¼šåœ¨ç™»é™†æˆåŠŸåï¼Œä¸»åŠ¨æ–­å¼€ websocket è¿æ¥ï¼Œåœ¨è½¬è´¦é¡µé¢é‡å¤ä¸Šè¿°æµç¨‹è·å–é’¥åŒ™ä¿¡æ¯å†è¿›è¡Œç­¾åæ“ä½œï¼Œä½†æ˜¯ä»–å°±ç»™äº†æˆ‘ 1kï¼Œæˆ‘æ‡’å¾—å†™äº†ï¼Œåæ­£ç”²æ–¹æ²¡æ‰¾æˆ‘éº»çƒ¦

### éªŒç­¾å®ç°

å‰ç«¯å°†åŸå§‹è¡¨å•æ•°æ®ï¼ˆåŸæ–‡ï¼‰å’Œç­¾åæ•°æ®ï¼ˆå¯†æ–‡ï¼‰ä¸€åŒæ‰“åœ¨åç«¯æ¥å£ä¸Šï¼Œåç«¯æ¥æ”¶åˆ°è¯·æ±‚åï¼Œé¦–å…ˆæ ¹æ®ç”¨æˆ·åä»æ•°æ®åº“ä¸­å–å‡ºç”¨æˆ·è¯ä¹¦ï¼Œå†å¯¹å‰ç«¯ä¼ æ¥çš„åŸæ–‡å’Œå¯†æ–‡é€šè¿‡è¯ä¹¦å’Œç­¾åéªŒç­¾æœåŠ¡å™¨è¿›è¡ŒéªŒè¯ï¼Œè¿”å›`true/false`ï¼Œå®ç°ä¸€é‡è®¤è¯

Controller å±‚

```java
@PostMapping("/login")
public Result doLogin(@RequestBody LoginInfoDTO user,HttpServletRequest req) throws CryptoException, UnsupportedEncodingException {
    System.out.println("signature: "+ user.getSignature());
    HttpSession session = req.getSession();
    String gencode = (String) session.getAttribute("index_code");
    if(StringUtils.isEmpty(user.getCode())){
        return Result.ERROR("éªŒè¯ç ä¸èƒ½ä¸ºç©º");
    }
    System.out.println("éªŒè¯ç ï¼š " + gencode);
    if (!gencode.toLowerCase().equals(user.getCode().toLowerCase())){
        return Result.ERROR("éªŒè¯ç é”™è¯¯");
    }

    //éªŒè¯ç”¨æˆ·ç™»å½•ç­¾åä¿¡æ¯
    if(StringUtils.isEmpty(user.getSignature())){
        return Result.ERROR("ç­¾åä¿¡æ¯ä¸èƒ½ä¸ºç©º");
    }

    String jwtToken = userService.doLogin(user);
    if (jwtToken == null) {
        return Result.ERROR("ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯!!!!!!");
    }
    System.out.println("ç”¨æˆ·ç™»å½•");
    return Result.OK(jwtToken);
}
```

ä¸»è¦çš„éªŒè¯ä¸šåŠ¡å†`String jwtToken = userService.doLogin(user)`è¿™ä¸€è¡Œ

Service å±‚

```java
@Override
public String doLogin(LoginInfoDTO user) {
    User uu = userMapper.findByName(user.getUsername());
    String cert = uu.getCertificate();
    String iniData = user.getIniData();
    String signData = user.getSignature();
    System.out.println("iniData: " + iniData);
    System.out.println("signature: " + signData);
    boolean flag = OlymSignature.verifySignature(cert, iniData, signData);
    if(flag)
        return doLogin(user.getUsername(), user.getPassword());
    else
        return null;
}
```

ç¬¬ä¸€é‡è®¤è¯åœ¨`boolean flag = OlymSignature.verifySignature(cert, iniData, signData);`

```java
public static boolean verifySignature(String cert, String inData, String signed){
    boolean flag = false;
    try{
        flag = verify(cert, inData, signed);
    }catch (Exception e){
        System.out.println("---------->éªŒç­¾å‡ºé”™");
        e.printStackTrace();
    }
    return flag;
}
```

verify å‡½æ•°å°è£…ä¸€ä¸ª HTTP è¯·æ±‚ï¼Œæ‰“å‘åç«¯å†…ç½‘ä¸­çš„å¯†ç æœºï¼Œè·å–éªŒç­¾ç»“æœï¼Œè¿™é‡Œçš„ cert æ˜¯æ³¨å†Œæ—¶ç”¨æˆ·å­˜å…¥æ•°æ®åº“çš„é‚£ä»½è¯ä¹¦ï¼ŒinData å’Œ signature åˆ†åˆ«æ˜¯ä»å‰ç«¯æ‰“æ¥çš„è¡¨å•åŸæ–‡ä¿¡æ¯å’Œå‰ç«¯çš„ç­¾åä¿¡æ¯

- æ‰€ä»¥è¿™é‡Œçš„éªŒç­¾å®é™…ä¸Šå°±æ˜¯ï¼Œæ ¹æ®ç”¨æˆ·åœ¨åç«¯å­˜çš„è¯ä¹¦ certï¼Œå¯¹ç”¨æˆ·çš„åŸæ–‡åŠ å¯†ï¼Œå¹¶å’Œç”¨æˆ·åœ¨å‰ç«¯çš„å¯†æ–‡è¿›è¡Œæ¯”å¯¹ï¼Œè‹¥ä¸€è‡´åˆ™è®¤è¯é€šè¿‡

```java
public static boolean verify(String cert, String inData, String signature) throws Exception {
    if(cert == null){
        cert = Cert;
    }
    byte[] signerIDBytes = SignerID.getBytes();
    Integer signerIDLen = signerIDBytes.length;
    String signerID = Base64.getEncoder().encodeToString(signerIDBytes);

    byte[] inDataBytes = inData.getBytes();
    Integer inDataLen = inDataBytes.length;
    System.out.println(inDataLen);
    inData = Base64.getEncoder().encodeToString(inDataBytes);

    System.out.println("éªŒç­¾æ‰€ä½¿ç”¨çš„è¯ä¹¦ä¸º: " + cert);
    System.out.println("éªŒç­¾æ‰€ä½¿ç”¨çš„åŸæ–‡ä¸º: " + inData);
    System.out.println("éªŒç­¾æ‰€ä½¿ç”¨çš„ç­¾åå¯†æ–‡ä¸º: " + signature);
    System.out.println("éªŒç­¾æ‰€ä½¿ç”¨çš„ç­¾åIDä¸º: " + signerID);

    VerifySignedDataReq verifySignedDataReq = new VerifySignedDataReq();
    verifySignedDataReq.setSignMethod(SGD_SM3_SM2);
    verifySignedDataReq.setType(Type);
    verifySignedDataReq.setCert(cert);
    // Typeä¸º1æ—¶certSNæ²¡ç”¨ï¼Œå°†ä½¿ç”¨cert
    verifySignedDataReq.setInData(inData);
    verifySignedDataReq.setInDataLen(inDataLen);
    // è¿™ä¸ªIDé»˜è®¤ä¸º"1234567812345678"
    verifySignedDataReq.setSignerID(signerID);
    verifySignedDataReq.setSignerIDLen(signerIDLen);
    verifySignedDataReq.setSignature(signature);
    verifySignedDataReq.setVerifyLevel(VerifyLevel);
    System.out.println(verifySignedDataReq);
    Integer verifySignedDataResult = SignVerifyUtil.verifySignedData(verifySignedDataReq);
    System.out.println(
        "å•åŒ…éªŒè¯æ•°å­—ç­¾åç»“æœï¼š" + Objects.equals(SVSRESPONSE_RESPVALUE_SUCCESS, verifySignedDataResult));
    return SignVerifyUtil.verifySignedData(verifySignedDataReq) == 0;
}
```

è€Œåçš„äºŒé‡è®¤è¯`doLogin(user.getUsername(), user.getPassword())`å°±æ˜¯æ•°æ®åº“å¯†ç è®¤è¯ï¼Œä¸å†èµ˜è¿°

### å¤–éƒ¨ jar å¼•å…¥æ‰“åŒ…

IDEA éœ€è¦åœ¨`Project Structure`ä¸­æ·»åŠ `Modules`ï¼ŒåŒæ—¶åœ¨`pom.xml`ä¸­é…ç½®å¯¼å‡º

```xml
<dependencies>
<!--å¤–éƒ¨å¼•ç”¨ï¼Œæ‰“åŒ…æ—¶è¦åŒ…å«è¿›å»-->
    <dependency>
        <groupId>obymtect.ibc</groupId>
        <artifactId>sign</artifactId>
        <version>1.0.1</version>
        <scope>system</scope>
        <systemPath>${pom.basedir}/lib/olymibc.jar</systemPath>
    </dependency>
</dependencies>

<build>
    <plugins>
        <plugin>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-maven-plugin</artifactId>
            <configuration>
                <!-- åœ¨æ‰“åŒ…æ—¶å°†å¼•ç”¨çš„å¤–éƒ¨jarå¼•å…¥åˆ°å½“å‰é¡¹ç›®åŒ…ä¸­	-->
                <includeSystemScope>true</includeSystemScope>
            </configuration>
        </plugin>
    </plugins>
</build>
```

## åè®°

å…³äºè¿™ä¸ªæ–¹æ¡ˆï¼Œç”¨æˆ·ä¸å¯èƒ½éšæ—¶æºå¸¦ U ç›¾ï¼Œæ‰‹æœºæ‰æ˜¯æœ€å¥½çš„æ›¿ä»£å“ã€‚å¯†ç  + æ‰‹æœºå°±æˆäº†æœ€ä½³çš„åŒå› ç´ è®¤è¯æ–¹æ¡ˆï¼ˆfrom é˜®ä¸€å³°ï¼‰

å¦å¤–ï¼Œå¥¥è”çš„æ¥å£ï¼Œè°ç”¨è°çŸ¥é“ï¼Œæ— æ•Œäº†



