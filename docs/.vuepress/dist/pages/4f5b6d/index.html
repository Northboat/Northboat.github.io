<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>常见的分布式问题 | Arkrypto</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="https://at.alicdn.com/t/font_3129839_xft6cqs5gc.css">
    <noscript><meta http-equiv="refresh" content="0; url=https://www.youngkbt.cn/noscript/"><style>.theme-vdoing-content { display:none }</noscript>
    <meta name="description" content="My Wiki">
    <meta name="keywords" content="Arkrypto, ComputerScience, DevOps, Crypto">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.718aaf93.css" as="style"><link rel="preload" href="/assets/js/app.df01b8d3.js" as="script"><link rel="preload" href="/assets/js/3.b20caba6.js" as="script"><link rel="preload" href="/assets/js/37.5295b891.js" as="script"><link rel="preload" href="/assets/js/89.046449b0.js" as="script"><link rel="prefetch" href="/assets/js/10.9acf1611.js"><link rel="prefetch" href="/assets/js/100.518873ff.js"><link rel="prefetch" href="/assets/js/101.440ff492.js"><link rel="prefetch" href="/assets/js/102.2109e68a.js"><link rel="prefetch" href="/assets/js/103.379e512d.js"><link rel="prefetch" href="/assets/js/104.8c768a21.js"><link rel="prefetch" href="/assets/js/105.24a4b586.js"><link rel="prefetch" href="/assets/js/106.fcc1c75c.js"><link rel="prefetch" href="/assets/js/107.1af78c92.js"><link rel="prefetch" href="/assets/js/108.540ae613.js"><link rel="prefetch" href="/assets/js/109.31585d10.js"><link rel="prefetch" href="/assets/js/11.267836da.js"><link rel="prefetch" href="/assets/js/110.61a7a090.js"><link rel="prefetch" href="/assets/js/111.6f04a8ca.js"><link rel="prefetch" href="/assets/js/112.56289c74.js"><link rel="prefetch" href="/assets/js/113.05373713.js"><link rel="prefetch" href="/assets/js/114.a12bf83d.js"><link rel="prefetch" href="/assets/js/115.6b356175.js"><link rel="prefetch" href="/assets/js/116.61361160.js"><link rel="prefetch" href="/assets/js/117.1ca914cc.js"><link rel="prefetch" href="/assets/js/118.b9637d23.js"><link rel="prefetch" href="/assets/js/119.be9a6272.js"><link rel="prefetch" href="/assets/js/12.3542e809.js"><link rel="prefetch" href="/assets/js/120.25359a70.js"><link rel="prefetch" href="/assets/js/121.40cc62dd.js"><link rel="prefetch" href="/assets/js/122.bf801322.js"><link rel="prefetch" href="/assets/js/123.7380adbe.js"><link rel="prefetch" href="/assets/js/124.69af861d.js"><link rel="prefetch" href="/assets/js/125.79c6590c.js"><link rel="prefetch" href="/assets/js/126.80116bd2.js"><link rel="prefetch" href="/assets/js/127.f715c037.js"><link rel="prefetch" href="/assets/js/128.27713658.js"><link rel="prefetch" href="/assets/js/129.a2c947b9.js"><link rel="prefetch" href="/assets/js/13.230cbaa4.js"><link rel="prefetch" href="/assets/js/130.2f2fa99d.js"><link rel="prefetch" href="/assets/js/131.fa945504.js"><link rel="prefetch" href="/assets/js/132.38e098db.js"><link rel="prefetch" href="/assets/js/133.104a6fe4.js"><link rel="prefetch" href="/assets/js/134.d003ed07.js"><link rel="prefetch" href="/assets/js/135.64377409.js"><link rel="prefetch" href="/assets/js/136.7fc593d8.js"><link rel="prefetch" href="/assets/js/137.a7af845d.js"><link rel="prefetch" href="/assets/js/138.b1e9446d.js"><link rel="prefetch" href="/assets/js/139.48c97281.js"><link rel="prefetch" href="/assets/js/14.d0e442e6.js"><link rel="prefetch" href="/assets/js/140.88e54749.js"><link rel="prefetch" href="/assets/js/141.8f92aa63.js"><link rel="prefetch" href="/assets/js/142.963b83a1.js"><link rel="prefetch" href="/assets/js/143.1de1a26a.js"><link rel="prefetch" href="/assets/js/144.18a94f62.js"><link rel="prefetch" href="/assets/js/145.95e03f92.js"><link rel="prefetch" href="/assets/js/146.c691607b.js"><link rel="prefetch" href="/assets/js/147.bc48b0d9.js"><link rel="prefetch" href="/assets/js/148.6272922d.js"><link rel="prefetch" href="/assets/js/149.bb6c9192.js"><link rel="prefetch" href="/assets/js/15.ca4689d1.js"><link rel="prefetch" href="/assets/js/150.0980e048.js"><link rel="prefetch" href="/assets/js/151.b3f65afb.js"><link rel="prefetch" href="/assets/js/152.666559ef.js"><link rel="prefetch" href="/assets/js/153.503aeb45.js"><link rel="prefetch" href="/assets/js/154.15a547b2.js"><link rel="prefetch" href="/assets/js/155.9f904987.js"><link rel="prefetch" href="/assets/js/156.d6c316ce.js"><link rel="prefetch" href="/assets/js/157.07e27365.js"><link rel="prefetch" href="/assets/js/158.00c068dc.js"><link rel="prefetch" href="/assets/js/159.be57a7aa.js"><link rel="prefetch" href="/assets/js/16.741913a3.js"><link rel="prefetch" href="/assets/js/160.a92985b6.js"><link rel="prefetch" href="/assets/js/161.80be93a6.js"><link rel="prefetch" href="/assets/js/162.d405fd98.js"><link rel="prefetch" href="/assets/js/163.84901d3a.js"><link rel="prefetch" href="/assets/js/164.97f15acd.js"><link rel="prefetch" href="/assets/js/165.729ddfb9.js"><link rel="prefetch" href="/assets/js/166.a9025716.js"><link rel="prefetch" href="/assets/js/167.712b38b9.js"><link rel="prefetch" href="/assets/js/168.620a0ac1.js"><link rel="prefetch" href="/assets/js/169.52cdb151.js"><link rel="prefetch" href="/assets/js/17.75cc88a9.js"><link rel="prefetch" href="/assets/js/170.9a5d0291.js"><link rel="prefetch" href="/assets/js/18.2e1b490b.js"><link rel="prefetch" href="/assets/js/19.8e37e6b1.js"><link rel="prefetch" href="/assets/js/2.dd969d6a.js"><link rel="prefetch" href="/assets/js/20.33b34c4d.js"><link rel="prefetch" href="/assets/js/21.fe2bdcea.js"><link rel="prefetch" href="/assets/js/22.22c63fab.js"><link rel="prefetch" href="/assets/js/23.f8356826.js"><link rel="prefetch" href="/assets/js/24.6fe53e86.js"><link rel="prefetch" href="/assets/js/25.b3ed685c.js"><link rel="prefetch" href="/assets/js/26.0719d9ab.js"><link rel="prefetch" href="/assets/js/27.bdb68d26.js"><link rel="prefetch" href="/assets/js/28.faf057f4.js"><link rel="prefetch" href="/assets/js/29.8048ccf7.js"><link rel="prefetch" href="/assets/js/30.dd49b176.js"><link rel="prefetch" href="/assets/js/31.8025146a.js"><link rel="prefetch" href="/assets/js/32.3a48989d.js"><link rel="prefetch" href="/assets/js/33.3de3e440.js"><link rel="prefetch" href="/assets/js/34.c82829c7.js"><link rel="prefetch" href="/assets/js/35.a92f220f.js"><link rel="prefetch" href="/assets/js/36.6fab3e63.js"><link rel="prefetch" href="/assets/js/38.bab9ab51.js"><link rel="prefetch" href="/assets/js/39.9410054f.js"><link rel="prefetch" href="/assets/js/4.7f226d3e.js"><link rel="prefetch" href="/assets/js/40.4e5328d1.js"><link rel="prefetch" href="/assets/js/41.91569636.js"><link rel="prefetch" href="/assets/js/42.9100ebee.js"><link rel="prefetch" href="/assets/js/43.d03ff42e.js"><link rel="prefetch" href="/assets/js/44.ba785f55.js"><link rel="prefetch" href="/assets/js/45.b2b92772.js"><link rel="prefetch" href="/assets/js/46.596213e0.js"><link rel="prefetch" href="/assets/js/47.cec4a250.js"><link rel="prefetch" href="/assets/js/48.d7556110.js"><link rel="prefetch" href="/assets/js/49.2c262da2.js"><link rel="prefetch" href="/assets/js/5.c2b31a39.js"><link rel="prefetch" href="/assets/js/50.632076e7.js"><link rel="prefetch" href="/assets/js/51.bc546ae8.js"><link rel="prefetch" href="/assets/js/52.47277e72.js"><link rel="prefetch" href="/assets/js/53.ccddd157.js"><link rel="prefetch" href="/assets/js/54.125582d4.js"><link rel="prefetch" href="/assets/js/55.4f87e6f4.js"><link rel="prefetch" href="/assets/js/56.7fd0af19.js"><link rel="prefetch" href="/assets/js/57.f5a14377.js"><link rel="prefetch" href="/assets/js/58.0fe2455b.js"><link rel="prefetch" href="/assets/js/59.ec4078e6.js"><link rel="prefetch" href="/assets/js/6.0da7a7d4.js"><link rel="prefetch" href="/assets/js/60.4c907fc1.js"><link rel="prefetch" href="/assets/js/61.a1e94400.js"><link rel="prefetch" href="/assets/js/62.ed19a0d7.js"><link rel="prefetch" href="/assets/js/63.d18294e5.js"><link rel="prefetch" href="/assets/js/64.c4f5edaf.js"><link rel="prefetch" href="/assets/js/65.5ea5c002.js"><link rel="prefetch" href="/assets/js/66.8b2e02ed.js"><link rel="prefetch" href="/assets/js/67.345e5976.js"><link rel="prefetch" href="/assets/js/68.6651fe8f.js"><link rel="prefetch" href="/assets/js/69.4b60b842.js"><link rel="prefetch" href="/assets/js/7.5f1d5c5a.js"><link rel="prefetch" href="/assets/js/70.f84f7690.js"><link rel="prefetch" href="/assets/js/71.86ada907.js"><link rel="prefetch" href="/assets/js/72.3557f777.js"><link rel="prefetch" href="/assets/js/73.59c92e1e.js"><link rel="prefetch" href="/assets/js/74.1946b7e9.js"><link rel="prefetch" href="/assets/js/75.b24e0b82.js"><link rel="prefetch" href="/assets/js/76.3492c71c.js"><link rel="prefetch" href="/assets/js/77.6e5d34af.js"><link rel="prefetch" href="/assets/js/78.764d3ebd.js"><link rel="prefetch" href="/assets/js/79.c2776306.js"><link rel="prefetch" href="/assets/js/8.2aa75537.js"><link rel="prefetch" href="/assets/js/80.33426e1c.js"><link rel="prefetch" href="/assets/js/81.1d2108ec.js"><link rel="prefetch" href="/assets/js/82.1f8fa7b6.js"><link rel="prefetch" href="/assets/js/83.04424930.js"><link rel="prefetch" href="/assets/js/84.86df4321.js"><link rel="prefetch" href="/assets/js/85.48348a48.js"><link rel="prefetch" href="/assets/js/86.0090d435.js"><link rel="prefetch" href="/assets/js/87.88b1b6bd.js"><link rel="prefetch" href="/assets/js/88.3a41a9a1.js"><link rel="prefetch" href="/assets/js/9.f4fb8cc5.js"><link rel="prefetch" href="/assets/js/90.0c2edc78.js"><link rel="prefetch" href="/assets/js/91.3bd5c1c8.js"><link rel="prefetch" href="/assets/js/92.cc33112b.js"><link rel="prefetch" href="/assets/js/93.209ee79f.js"><link rel="prefetch" href="/assets/js/94.d1ed7be5.js"><link rel="prefetch" href="/assets/js/95.2906d222.js"><link rel="prefetch" href="/assets/js/96.1f628e52.js"><link rel="prefetch" href="/assets/js/97.d9416ac1.js"><link rel="prefetch" href="/assets/js/98.8ddf3b81.js"><link rel="prefetch" href="/assets/js/99.f55ef8e9.js">
    <link rel="stylesheet" href="/assets/css/0.styles.718aaf93.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu have-body-img"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="Arkrypto" class="logo"> <span class="site-name can-hide">Arkrypto</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/cs/" class="nav-link">计算机科学与技术</a></div><div class="nav-item"><a href="/dev/" class="nav-link">开发与运维</a></div><div class="nav-item"><a href="/sec/" class="nav-link">网络与信息安全</a></div><div class="nav-item"><a href="/mine/" class="nav-link">我的</a></div><div class="nav-item"><a href="/archives/" class="nav-link">归档</a></div> <a href="https://github.com/Arkrypto" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/img/avatar.png"> <div class="blogger-info"><h3>Arkrypto</h3> <span>就在坚冰还盖着北海的时候，我看到了怒放的梅花</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/cs/" class="nav-link">计算机科学与技术</a></div><div class="nav-item"><a href="/dev/" class="nav-link">开发与运维</a></div><div class="nav-item"><a href="/sec/" class="nav-link">网络与信息安全</a></div><div class="nav-item"><a href="/mine/" class="nav-link">我的</a></div><div class="nav-item"><a href="/archives/" class="nav-link">归档</a></div> <a href="https://github.com/Arkrypto" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>后端开发</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Java 基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Web 开发</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>并发编程与安全开发</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>微服务与分布式</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/9e801d/" class="sidebar-link">软件工程原理与应用</a></li><li><a href="/pages/9a8ad9/" class="sidebar-link">分布式系统与微服务架构概述</a></li><li><a href="/pages/4f5b6d/" aria-current="page" class="active sidebar-link">常见的分布式问题</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/4f5b6d/#常见分布式问题" class="sidebar-link">常见分布式问题</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/4f5b6d/#分布式事务" class="sidebar-link">分布式事务</a></li><li class="sidebar-sub-header level3"><a href="/pages/4f5b6d/#分布式锁" class="sidebar-link">分布式锁</a></li><li class="sidebar-sub-header level3"><a href="/pages/4f5b6d/#分布式会话" class="sidebar-link">分布式会话</a></li><li class="sidebar-sub-header level3"><a href="/pages/4f5b6d/#分布式-id" class="sidebar-link">分布式 ID</a></li><li class="sidebar-sub-header level3"><a href="/pages/4f5b6d/#分布式链路追踪" class="sidebar-link">分布式链路追踪</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/4f5b6d/#索引与事务" class="sidebar-link">索引与事务</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/4f5b6d/#索引" class="sidebar-link">索引</a></li><li class="sidebar-sub-header level3"><a href="/pages/4f5b6d/#事务" class="sidebar-link">事务</a></li><li class="sidebar-sub-header level3"><a href="/pages/4f5b6d/#脏读、不可重复读、幻读和丢失修改" class="sidebar-link">脏读、不可重复读、幻读和丢失修改</a></li><li class="sidebar-sub-header level3"><a href="/pages/4f5b6d/#seata-实战" class="sidebar-link">Seata 实战</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/4f5b6d/#降级、熔断和限流" class="sidebar-link">降级、熔断和限流</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/4f5b6d/#什么是降级、熔断和限流" class="sidebar-link">什么是降级、熔断和限流</a></li><li class="sidebar-sub-header level3"><a href="/pages/4f5b6d/#熔断实现" class="sidebar-link">熔断实现</a></li><li class="sidebar-sub-header level3"><a href="/pages/4f5b6d/#限流实现" class="sidebar-link">限流实现</a></li><li class="sidebar-sub-header level3"><a href="/pages/4f5b6d/#熔断-vs-限流" class="sidebar-link">熔断 VS. 限流</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/4f5b6d/#redis-集群同步" class="sidebar-link">Redis 集群同步</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/4f5b6d/#主从架构如何避免脏读" class="sidebar-link">主从架构如何避免脏读</a></li><li class="sidebar-sub-header level3"><a href="/pages/4f5b6d/#限流算法" class="sidebar-link">限流算法</a></li><li class="sidebar-sub-header level3"><a href="/pages/4f5b6d/#缓存穿透、击穿和雪崩" class="sidebar-link">缓存穿透、击穿和雪崩</a></li></ul></li></ul></li><li><a href="/pages/2afee4/" class="sidebar-link">注册中心和 RPC 框架详解</a></li><li><a href="/pages/48385f/" class="sidebar-link">Golang 基础</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>运维</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端开发</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06970110><div class="articleInfo" data-v-06970110><ul class="breadcrumbs" data-v-06970110><li data-v-06970110><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06970110></a></li> <li data-v-06970110><a href="/dev/#开发与运维" data-v-06970110>开发与运维</a></li><li data-v-06970110><a href="/dev/#后端开发" data-v-06970110>后端开发</a></li><li data-v-06970110><a href="/dev/#微服务与分布式" data-v-06970110>微服务与分布式</a></li></ul> <div class="info" data-v-06970110><div title="作者" class="author iconfont icon-touxiang" data-v-06970110><a href="https://github.com/Arkrypto" target="_blank" title="作者" class="beLink" data-v-06970110>Arkrypto</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06970110><a href="javascript:;" data-v-06970110>2025-02-21</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">常见的分布式问题<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h2 id="常见分布式问题"><a href="#常见分布式问题" class="header-anchor">#</a> 常见分布式问题</h2> <h3 id="分布式事务"><a href="#分布式事务" class="header-anchor">#</a> 分布式事务</h3> <p>2PC：两阶段提交，将事务的提交过程分为资源准备和资源提交两个阶段，并且由事务协调者来协调所有事务参与者，如果准备阶段所有事务参与者都预留资源成功，则进行第二阶段的资源提交，否则事务协调者回滚资源</p> <p>3PC：三阶段提交协议，是二阶段提交协议的改进版本，三阶段提交有两个改动点</p> <ol><li>在协调者和参与者中都引入超时机制</li> <li>在第一阶段和第二阶段中插入一个准备阶段，保证了在最后提交阶段之前各参与节点的状态是一致的</li></ol> <p>TCC：一种分布式事务处理方法，它的名称来自于其三个阶段<code>Try, Confirm, Cancel</code>，这种方法主要用于处理在分布式系统中，多个服务需要协同完成一项操作时的一致性问题</p> <h3 id="分布式锁"><a href="#分布式锁" class="header-anchor">#</a> 分布式锁</h3> <p>由于要保证分布式系统的性能，分布式锁一般都是乐观锁，与之对应的是悲观锁</p> <p>悲观锁是将资源锁住，等一个之前获得锁的线程释放锁之后，下一个线程才可以访问。而乐观锁采取了一种宽泛的态度，通过某种方式不加锁来处理资源，比如通过给记录加 version 或 timestamp 来操作数据（比如 CAS 策略），<strong>性能较悲观锁有很大的提高</strong></p> <ul><li>像 synchronized、Lock、ReadWriteLock 均为悲观锁</li> <li>而原子类例如 AtomicInteger 用的实际上是 CAS 机制，所以是一个乐观锁 → 但是没有引入版本控制，所以会出现 ABA 问题（A→B→A），详见 - <a href="https://northboat.github.io/pages/479c11/#%E4%BB%80%E4%B9%88%E6%98%AF-cas" target="_blank" rel="nofollow noopener noreferrer">原子性、单例模式和 CAS | 北船<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <p>还有一种乐观锁的理解：Git</p> <ul><li>我们只有在 push 的时候才会进行锁的检查，返回错误信息</li> <li>无论是 add 还是 commit，都是不上锁的（乐观的默认可执行），碰到问题（push 版本不对）再去解决</li></ul> <p>当然，我们在此处只讨论分布式锁的实现，需要明确的是，分布式锁既可以是悲观的也可以是乐观的，这要根据具体场景进行设计考量</p> <p>1️⃣ Redis 实现</p> <p>Redission，基于 Redis 集群的分布式锁，本质上就是维护同一个键值对，作为 Lock，获取时上锁，获取前检查这个键值对是否有锁，释放时解锁</p> <p>2️⃣ Zookeeper 实现</p> <p>订阅发布模式下，多个 Watcher 争用一个临时节点</p> <ul><li>上锁：创建临时节点</li> <li>释放：删除临时节点</li></ul> <h3 id="分布式会话"><a href="#分布式会话" class="header-anchor">#</a> 分布式会话</h3> <p>在分布式系统的诸多后端接口之间维护<strong>唯一</strong>的用户 Session，用以管理用户登陆状态，可以用 Redis 存放用户 Session 并设置有效期实现（在这里，一个 Session 实际上就是一个 KV 对）</p> <p>使用 Redis 做用户登陆状态管理（分布式会话管理），通常有这样两种做法</p> <p>1️⃣ Token 为键，用户信息为值，例如</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Key:   login:token:{jwt-token}
Value: &quot;{userId: u12345}, {username: arkrypto}, {roles: [admin]}, {loginTime: 2025-05-19T18:00:00}&quot;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Value 实际上是用户信息的一个 JsonToString</p> <p>2️⃣ 用户 ID 为键，Token 为值，这个很简单</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Key:   login:user:{userId}
Value: jwt-token
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>其中，2 适合单点登录（SSO，Single Sign-On）控制，因为可以很轻松的做到一个 ID 对应一个 KV 对，即一个会话；而前者默认支持多端登录</p> <table><thead><tr><th>项目</th> <th>方式一：以 <code>token</code> 为 key</th> <th>方式二：以 <code>userId</code> 为 key</th></tr></thead> <tbody><tr><td>Key</td> <td><code>login:token:{token}</code></td> <td><code>login:user:{userId}</code></td></tr> <tr><td>Value</td> <td>用户信息（JSON 格式）</td> <td>token 字符串</td></tr> <tr><td>是否支持多端登录</td> <td>支持（每个 token 独立）</td> <td>默认不支持（一个 userId 对应一个 token）</td></tr> <tr><td>用途</td> <td>校验身份和获取用户信息</td> <td>实现单点登录/控制登录唯一性</td></tr> <tr><td>删除策略</td> <td>删除 token（用于登出）</td> <td>删除 userId-token 绑定（用于限制）</td></tr></tbody></table> <h3 id="分布式-id"><a href="#分布式-id" class="header-anchor">#</a> 分布式 ID</h3> <p>在分布式系统中，要保证 ID 的唯一性，粗糙方案</p> <ol><li>UUID：空间大，无序</li> <li>数据库自增 ID：性能差，单点故障</li></ol> <p>较好的方案</p> <ol><li>Redis 自增 ID：多机设置不同初始 ID 和不同步长</li> <li>雪花算法（Snowflake）
<ul><li>生成 64 位的 ID，包含时间戳、机器 ID 和序列号</li> <li>高性能、有序，但依赖时钟同步</li></ul></li></ol> <h3 id="分布式链路追踪"><a href="#分布式链路追踪" class="header-anchor">#</a> 分布式链路追踪</h3> <p>用到再看吧</p> <h2 id="索引与事务"><a href="#索引与事务" class="header-anchor">#</a> 索引与事务</h2> <h3 id="索引"><a href="#索引" class="header-anchor">#</a> 索引</h3> <p>在 MySQL 建表是，会对主键（primary key）自动添加索引，实际上就是一个额外的存储主键有序数据结构，采用类似二分搜索的快速规模压缩算法对主键进行检索（实际上是一棵 B+ 树）</p> <p>这是 B 树：需要保证叶子结点都在同一层</p> <img src="/assets/img/e84842ce8a18fb34d9907169bad94a7f.027fc02e.png"> <p>B+ 树在 B 树的基础上</p> <ul><li>把所有的关键字都放在最后一层（叶子层），所有非叶子结点都是“索引”</li> <li>在叶子结点那层加了一个链指针把叶子层连接在一起，可以避免当树规模过大时，搜索效率降低</li></ul> <img src="/assets/img/20190813232949316.f538284c.png"> <h3 id="事务"><a href="#事务" class="header-anchor">#</a> 事务</h3> <p>在 Spring 中，可用<code>@Transactional</code> 声明事务，它极大地简化了事务管理，直接在 Service 层对应的方法上进行注解，即可完成一次事务的编写</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Deprecated</span>
<span class="token annotation punctuation">@Transactional</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">doWithdrawal</span><span class="token punctuation">(</span><span class="token class-name">TransactionDTO</span> transactionDTO<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> r <span class="token operator">=</span> accountMapper<span class="token punctuation">.</span><span class="token function">updateBalanceById</span><span class="token punctuation">(</span>transactionDTO<span class="token punctuation">.</span><span class="token function">getMyAccount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> transactionDTO<span class="token punctuation">.</span><span class="token function">getAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">negate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>transactionDTO<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Transaction</span> transaction <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Transaction</span><span class="token punctuation">(</span>transactionDTO<span class="token punctuation">.</span><span class="token function">getMyAccount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                              <span class="token number">0L</span><span class="token punctuation">,</span>
                                              transactionDTO<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                              <span class="token string">&quot;外部账户&quot;</span><span class="token punctuation">,</span>
                                              transactionDTO<span class="token punctuation">.</span><span class="token function">getAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                              <span class="token string">&quot;用户取款&quot;</span><span class="token punctuation">,</span>
                                              r <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> transactionMapper<span class="token punctuation">.</span><span class="token function">insertTransaction</span><span class="token punctuation">(</span>transaction<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>但在使用时需要注意一些关键点，否则可能导致事务失效或出现意外行为</p> <ul><li><code>@Transactional</code> 只能修饰 public 方法</li> <li><code>@Transactional</code> 不能自身调用，比如方法 A 和 B 都在 UserService 类中，如果在 A 中调用 B 方法，即使 B 方法有<code>@Transactional</code> 修饰，这个事务也不会生效，这和 Java 的动态代理机制有关</li></ul> <p>设置超时（timeout）：设置事务的超时时间（单位：秒），超过时间未完成则回滚</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>timeout <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">methodC</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 事务超时时间为 5 秒</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>只读（readOnly）：标记事务为只读，优化数据库性能（如 MySQL 的只读事务会禁用写锁）</p> <ul><li><strong>注意</strong>：只读事务中不能执行写操作，否则会抛出异常</li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>readOnly <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">methodD</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 只读事务</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>事务回滚规则：默认情况下，<code>@Transactional</code> 回滚的是 RunTimeException，如果需要特殊要求，需要指定</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 回滚 I/O 和 SQL 异常</span>
<span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>rollbackFor <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token class-name">IOException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">SQLException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 不回滚空指针异常</span>
<span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>noRollbackFor <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token class-name">NullPointerException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="脏读、不可重复读、幻读和丢失修改"><a href="#脏读、不可重复读、幻读和丢失修改" class="header-anchor">#</a> 脏读、不可重复读、幻读和丢失修改</h3> <p><code>@Transactional</code> 的 <code>isolation</code> 属性用于定义事务的隔离级别，常见的隔离级别如下</p> <table><thead><tr><th>隔离级别</th> <th>防止脏读</th> <th>防止不可重复读</th> <th>防止幻读</th></tr></thead> <tbody><tr><td><strong>read uncommitted</strong></td> <td>✗</td> <td>✗</td> <td>✗</td></tr> <tr><td><strong>read committed</strong></td> <td>✓</td> <td>✗</td> <td>✗</td></tr> <tr><td><strong>repeatable read</strong> (MySQL 默认)</td> <td>✓</td> <td>✓</td> <td>部分 ✓（间隙锁）</td></tr> <tr><td><strong>serializable</strong></td> <td>✓</td> <td>✓</td> <td>✓</td></tr></tbody></table> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>isolation <span class="token operator">=</span> <span class="token class-name">Isolation</span><span class="token punctuation">.</span><span class="token constant">REPEATABLE_READ</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">methodB</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 在可重复读隔离级别下执行</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>什么是脏读、不可重复读和幻读？</p> <p>1️⃣ 脏读：读到了写过程中的临时数据</p> <p>解决办法：给写加锁，写时不能读</p> <p>2️⃣ 不可重复读：就是说，在一个事务中，前后重复读同一数据，数据存在改变</p> <p>原因：读时可写 → 解决办法：给读加锁</p> <p>3️⃣ 幻读：针对表而言，之前给行加了读/写锁，即单个数据项有读/写锁从而防止脏读和不可重复读，但对于数据表而言，比如<code>count(*)</code>操作，即使数据项 a 在被写，数据项 b 在被读，但不影响数据 c 插入数据表，那么同一事务的前后两次<code>count(*)</code>就有可能返回不一样的结果，这就叫幻读</p> <p>解决方法：对整个数据表加读写锁，彻底串行执行，效率极低</p> <p>4️⃣ 修改丢失：写写没加锁，后一次写覆盖了前一次写的提交，很有可能会破坏数据一致性</p> <p>例如：存款原本有 1000，A 事务存 50，B 事务取 100，二者进行修改时，都会先读取余额，假设他们现在同时读，都读到 1000，那么 A 会将 1050 写回（操作 ①），B 会将 900 写回（操作 ②），操作 ① ② 先后执行，那么最终存款将会变成 900</p> <p>这一过程覆盖了 A 事务存款 50 的 commit，并且破坏了数据的一致性</p> <h3 id="seata-实战"><a href="#seata-实战" class="header-anchor">#</a> Seata 实战</h3> <h2 id="降级、熔断和限流"><a href="#降级、熔断和限流" class="header-anchor">#</a> 降级、熔断和限流</h2> <h3 id="什么是降级、熔断和限流"><a href="#什么是降级、熔断和限流" class="header-anchor">#</a> 什么是降级、熔断和限流</h3> <p>降级：服务端出现问题，客户端降级使用 FallbackMethod 方法，返回一个友好的提示，而不至于忙等</p> <p>熔断：达到一定条件后（比如请求故障率达到 60%），一直降级，缓慢恢复</p> <p>限流：比如点对点消息队列缓慢消费请求，大家<strong>排队</strong>，一秒钟 N 个，有序进行，秒杀高并发等操作，严禁一窝蜂的过来拥挤</p> <h3 id="熔断实现"><a href="#熔断实现" class="header-anchor">#</a> 熔断实现</h3> <blockquote><p>以前是 Hystrix，现在用 Resilience4J 或者 <strong>Sentinel</strong></p></blockquote> <p>熔断（Circuit Breaker）和限流（Rate Limiting）是分布式系统中<strong>保障服务高可用性和稳定性</strong>的重要手段，主要用于<strong>防止雪崩效应</strong>，确保在高并发场景下系统能平稳运行</p> <ul><li>熔断（Circuit Breaker）类似于<strong>家里的电路保险丝</strong>，当电流过大时，保险丝会断开电路，以防电器损坏。在<strong>分布式系统</strong>中，熔断机制用于<strong>检测服务是否故障，并在故障严重时自动阻止请求，以防止系统崩溃</strong></li></ul> <p>熔断器通常有以下<strong>三种状态</strong></p> <ol><li>关闭（Closed）：服务正常运行，请求可以自由通过</li> <li>打开（Open）：当错误率达到阈值，熔断器打开，所有请求都会被拒绝，防止系统继续崩溃</li> <li>半开（Half-Open）：经过一段时间后，系统尝试放行部分请求进行测试，如果恢复正常，熔断器关闭，否则保持打开状态</li></ol> <p>Spring Cloud 以前使用 <strong>Hystrix</strong> 作为熔断组件，但现在推荐使用 <strong>Resilience4J</strong></p> <p><strong>1️⃣ 添加依赖</strong></p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.github.resilience4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>resilience4j-spring-boot2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.7.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>2️⃣ 代码示例</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@CircuitBreaker</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;paymentService&quot;</span><span class="token punctuation">,</span> fallbackMethod <span class="token operator">=</span> <span class="token string">&quot;fallbackPayment&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">callPaymentService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 调用远程支付服务</span>
    <span class="token keyword">return</span> restTemplate<span class="token punctuation">.</span><span class="token function">getForObject</span><span class="token punctuation">(</span><span class="token string">&quot;http://payment-service/pay&quot;</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 熔断后的降级方法</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">fallbackPayment</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot;支付服务不可用，请稍后重试&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><strong>3️⃣ 配置熔断阈值</strong></p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">resilience4j.circuitbreaker</span><span class="token punctuation">:</span>
  <span class="token key atrule">instances</span><span class="token punctuation">:</span>
    <span class="token key atrule">paymentService</span><span class="token punctuation">:</span>
      <span class="token key atrule">failureRateThreshold</span><span class="token punctuation">:</span> <span class="token number">50</span>  <span class="token comment"># 失败率达到 50% 时触发熔断</span>
      <span class="token key atrule">waitDurationInOpenState</span><span class="token punctuation">:</span> 5000ms  <span class="token comment"># 熔断后 5 秒再尝试恢复</span>
      <span class="token key atrule">permittedNumberOfCallsInHalfOpenState</span><span class="token punctuation">:</span> <span class="token number">3</span>  <span class="token comment"># 半开状态时允许 3 个请求进行尝试</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>👉 这样，当支付服务失败率超过 50% 时，请求会自动走 <code>fallbackPayment</code> 方法，而不会继续尝试访问已故障的支付服务</p> <h3 id="限流实现"><a href="#限流实现" class="header-anchor">#</a> 限流实现</h3> <blockquote><p>SpringCloud Gateway</p></blockquote> <p>限流（Rate Limiting）是一种<strong>限制请求速率</strong>的技术，防止单个服务被过量请求拖垮，确保系统能够平稳运行</p> <p>为什么需要限流？</p> <ul><li>防止流量暴增导致系统崩溃（如双十一购物、秒杀活动）</li> <li>防止恶意攻击（如爬虫、DDoS 攻击）</li> <li>合理分配系统资源，保障 VIP 用户的优先级</li></ul> <p>Spring Cloud Gateway 内置了基于 <strong>Redis 令牌桶算法</strong>的限流功能</p> <p><strong>1️⃣ 添加 Redis 依赖</strong></p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-redis-reactive<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>2️⃣ 配置限流规则</strong></p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> order<span class="token punctuation">-</span>service
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//order<span class="token punctuation">-</span>service
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> Path=/orders/<span class="token important">**</span>
          <span class="token key atrule">filters</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> RequestRateLimiter
              <span class="token key atrule">args</span><span class="token punctuation">:</span>
                <span class="token key atrule">redis-rate-limiter.replenishRate</span><span class="token punctuation">:</span> <span class="token number">10</span>  <span class="token comment"># 每秒补充 10 个令牌</span>
                <span class="token key atrule">redis-rate-limiter.burstCapacity</span><span class="token punctuation">:</span> <span class="token number">20</span>  <span class="token comment"># 允许的最大突发流量</span>
                <span class="token key atrule">key-resolver</span><span class="token punctuation">:</span> <span class="token string">&quot;#{@apiKeyResolver}&quot;</span>  <span class="token comment"># 限流的 key 规则</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p><strong>3️⃣ 自定义 Key 解析器</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token class-name">KeyResolver</span> <span class="token function">userKeyResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> exchange <span class="token operator">-&gt;</span> <span class="token class-name">Mono</span><span class="token punctuation">.</span><span class="token function">just</span><span class="token punctuation">(</span>exchange<span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getRemoteAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getHostName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>👉 这样，每个 IP 地址每秒最多只能访问 10 次 API，超出后会被限流</p> <table><thead><tr><th>特性</th> <th>熔断（Circuit Breaker）</th> <th>限流（Rate Limiting）</th></tr></thead> <tbody><tr><td>目的</td> <td>保护服务，防止雪崩</td> <td>保护系统，防止过载</td></tr> <tr><td>触发条件</td> <td>远程服务故障率高</td> <td>访问量超出限制</td></tr> <tr><td>作用</td> <td>暂停访问故障服务</td> <td>限制请求速率</td></tr> <tr><td>适用场景</td> <td>微服务间调用</td> <td>API 网关、秒杀活动</td></tr> <tr><td>实现工具</td> <td>Resilience4J、Hystrix</td> <td>Spring Cloud Gateway、Redis</td></tr></tbody></table> <h3 id="熔断-vs-限流"><a href="#熔断-vs-限流" class="header-anchor">#</a> 熔断 VS. 限流</h3> <p>什么时候使用熔断？什么时候使用限流？</p> <ul><li>熔断：当你调用的<strong>远程服务变慢或崩溃</strong>时，防止请求继续堆积导致整个系统挂掉</li> <li>限流：当你的服务<strong>流量暴增</strong>时，防止服务器资源被耗尽</li></ul> <p>现实案例</p> <ul><li>淘宝双十一：高并发<strong>限流</strong>，防止流量冲垮系统</li> <li>微信支付：如果支付接口故障，启用<strong>熔断</strong>，显示“支付系统繁忙”</li></ul> <p><strong>总结</strong></p> <ul><li>熔断用于<strong>保护服务</strong>，防止雪崩效应</li> <li>限流用于<strong>平稳流量</strong>，防止高并发拖垮系统</li> <li><strong>Spring Cloud Resilience4J</strong> 提供<strong>熔断</strong>机制，<strong>Spring Cloud Gateway</strong> 提供<strong>限流</strong>功能</li></ul> <p>当然了，也可以用阿里的开源中间件 Seatinel 实现限流熔断，方法多种多样</p> <h2 id="redis-集群同步"><a href="#redis-集群同步" class="header-anchor">#</a> Redis 集群同步</h2> <h3 id="主从架构如何避免脏读"><a href="#主从架构如何避免脏读" class="header-anchor">#</a> 主从架构如何避免脏读</h3> <p>在 Redis 主从架构中：</p> <ul><li><strong>主节点</strong>：负责处理写操作（如 SET、DEL），并将写操作同步到从节点</li> <li><strong>从节点</strong>：负责处理读操作（如 GET），并提供数据的副本</li></ul> <p>可以参考 Eureka 集群和 Zookeeper 集群的设计，感觉是差不多的（同属于 NoSQL）：主节点负责写，通过<strong>复制</strong>将数据同步到副节点，而副节点只负责数据的读取</p> <p>这里的复制加粗了，为什么呢？因为在 Eureka 中是异步复制，而 Zookeeper 中是同步复制，这造就了二者<strong>一致性</strong>的差别，前者是 AP 系统，而后者是 CP 系统</p> <p>在 Redis 集群中，这样的复制和 Eureka 一样，属于异步复制</p> <ul><li>由于主从同步是异步的，写操作在主节点完成后，并不会立即同步到从节点。因此，在同步完成之前，从节点可能会返回旧数据，导致<strong>脏读</strong></li></ul> <p>一个很经典的避免脏读的方法：<strong>读写锁</strong>（写时禁止读）</p> <p>这样会有很多局限性，存在以下问题：</p> <ol><li><strong>性能瓶颈</strong>：写操作期间禁止读操作，会导致读请求被阻塞，降低系统的并发性能</li> <li><strong>系统卡住</strong>：如果主节点的写 I/O 阻塞，整个系统可能会卡住，影响可用性</li> <li><strong>复杂性</strong>：实现<strong>分布式读写锁</strong>会增加系统的复杂性</li></ol> <p>主从结构下，避免脏读除了读写锁还有什么方法呢？（天美 /(ㄒoㄒ)/~~）</p> <p>4️⃣ 强制读主节点</p> <p>对于敏感数据，强制性的让用户只能读取主节点内容，由于 Redis 是单线程的原子操作，单独读写一个节点，当然不会发生脏读啦</p> <p>随之而来的是主节点负担增加，从而拖慢读写性能</p> <p>1️⃣ 写后同步等待</p> <p>刚刚提到，用读写锁，实际上是分布式锁的一种应用，这与“写后同步等待”不同，“写后同步等待”实际上就类似于 Eureka 的同步复制机制，主节点写完后对所有副节点进行阻塞的同步更新，更新完成后，才可以执行读操作</p> <p>这可以使用 Redis 的 Wait 命令实现</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>SET key value
WAIT <span class="token number">1</span> <span class="token number">1000</span>  <span class="token comment"># 等待至少 1 个从节点同步完成，超时时间为 1000 毫秒</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>2️⃣ 版本号或时间戳机制</p> <p>原理：为每个键（Key）添加版本号或时间戳，客户端在读取数据时检查版本号或时间戳，确保读取的是最新数据</p> <p>优点</p> <ul><li>不需要阻塞读操作，性能较高</li> <li>可以灵活控制数据的一致性级别</li></ul> <p>缺点</p> <ul><li>需要在客户端实现额外的逻辑</li> <li>增加了数据存储的开销（多一个存储字段）</li></ul> <p>实现方式</p> <p>在写操作时，更新键的版本号或时间戳</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>SET key:version <span class="token number">1</span>
SET key:value <span class="token string">&quot;data&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>在读操作时，检查版本号或时间戳</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>GET key:version
GET key:value
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>这里的读是指一次事务中的前后两次读（脏读的本质），在后一次做一个版本的检查，比如刚进入时读一次数据（这个数据上带一个版本号，或时间戳），然后在退出函数时再读一次，若版本号不同，则按后一次读出的数据为准</p> <p>3️⃣ 最终一致性容忍</p> <p>原理：接受一定时间内的脏读，通过业务逻辑容忍最终一致性</p> <p>优点</p> <ul><li>性能最高，没有额外的同步开销</li> <li>适合对一致性要求不高的场景</li></ul> <p>缺点：不适用于对一致性要求严格的场景（如金融交易）</p> <p>实现方式：在业务逻辑中处理脏读问题，例如</p> <ul><li>对脏读不敏感的数据（如用户昵称、文章内容）可以直接使用从节点读取</li> <li>对脏读敏感的数据（如余额、库存）可以从主节点读取</li></ul> <p><strong>注意，我们可以强制用户在主节点上读取数据，这样可以保证不会出现脏读，代价是主节点负担较大</strong>，所以这里的实现采取了折中的方案，敏感数据限定读主节点，非敏感数据读副节点</p> <p>那么“最终一致性容忍”是个什么情况呢，允许了一部分的脏读，但换回了相当一部分的性能</p> <h3 id="限流算法"><a href="#限流算法" class="header-anchor">#</a> 限流算法</h3> <p>令牌桶算法、漏桶算法、固定窗口算法、滑动窗口算法以及动态限流算法</p> <ul><li>令牌桶：每秒给多少令牌，同时给定令牌上限，令牌用完了拒绝请求</li> <li>漏桶：每秒处理多少个水滴（请求），类似于消息队列的方式，每秒消费多少个请求</li> <li>固定窗口：固定时间窗口，每个窗口通过的请求有限</li> <li>滑动窗口：细粒的划分时间，在每个大窗口中控制小窗口，并可以通过小窗口的状态判断大窗口的访问控制，详见示例</li> <li>动态限流：根据系统负载动态调节漏桶的流速，负载越高，流速越小</li></ul> <p>不同算法的异同</p> <table><thead><tr><th>算法</th> <th>原理</th> <th>优点</th> <th>缺点</th> <th>适用场景</th> <th>示例</th></tr></thead> <tbody><tr><td>令牌桶算法</td> <td>系统以固定的速率向桶中添加令牌（Token），桶的容量是固定的。 每个请求需要从桶中获取一个令牌，如果桶中有足够的令牌，则允许请求通过；否则拒绝请求。 如果桶满了，新生成的令牌会被丢弃</td> <td>可以应对突发流量，因为桶中的令牌可以累积。 限流速率平滑，适合需要控制平均速率的场景</td> <td>实现相对复杂，需要维护令牌桶的状态。 突发流量可能导致短时间内大量请求通过</td> <td>需要平滑限流的场景，如 API 网关、流量控制</td> <td>假设桶的容量为 10，每秒生成 2 个令牌。 如果桶中有 5 个令牌，同时有 8 个请求到达，则前 5 个请求可以通过，后 3 个请求被拒绝</td></tr> <tr><td>漏桶算法</td> <td>请求像水一样流入漏桶，漏桶以固定的速率处理请求（漏水）。 如果桶满了，新的请求会被丢弃或排队等待</td> <td>限流速率非常平滑，适合需要严格控制请求速率的场景。 实现简单，容易理解</td> <td>无法应对突发流量，即使桶中有空闲容量，请求也只能以固定速率通过。 可能导致请求的延迟增加</td> <td>需要严格控制请求速率的场景，如消息队列、任务调度</td> <td>假设漏桶的容量为 10，处理速率为每秒 2 个请求。 如果桶中有 5 个请求，同时有 8 个请求到达，则前 5 个请求可以进入桶中，后 3 个请求被拒绝。 桶中的请求以每秒 2 个的速率被处理</td></tr> <tr><td>固定窗口算法</td> <td>将时间划分为固定的窗口（如 1 秒），每个窗口内允许通过的请求数量是固定的。 如果窗口内的请求数量超过限制，则拒绝多余的请求</td> <td>实现简单，容易理解。 适合对限流精度要求不高的场景</td> <td>无法应对窗口边界处的突发流量。例如，如果窗口大小为 1 秒，限制为 100 个请求，则可能在窗口的最后 100ms 内收到 100 个请求，而在下一个窗口的前 100ms 内又收到 100 个请求，导致实际通过的请求数量是限制的两倍。 限流不够平滑</td> <td>对限流精度要求不高的场景，如简单的 API 限流</td> <td>假设窗口大小为 1 秒，限制为 100 个请求。 如果在 1 秒内收到 120 个请求，则前 100 个请求可以通过，后 20 个请求被拒绝</td></tr> <tr><td>滑动窗口算法</td> <td>将时间划分为多个小窗口（如 100ms），每个小窗口内允许通过的请求数量是固定的。 通过滑动窗口的方式动态计算当前时间窗口内的请求数量，如果超过限制，则拒绝多余的请求</td> <td>比固定窗口算法更精确，能够更好地应对突发流量。 限流更加平滑</td> <td>实现相对复杂，需要维护滑动窗口的状态。 计算开销较大</td> <td>对限流精度要求较高的场景，如高并发 API 限流</td> <td>假设窗口大小为 1 秒，划分为 10 个小窗口，每个小窗口的限制为 10 个请求。 如果在当前时间窗口内已经收到 90 个请求，则新的请求会被拒绝</td></tr> <tr><td>动态限流算法</td> <td>根据系统的实时负载动态调整限流速率。 例如，当系统负载较高时，降低限流速率；当系统负载较低时，提高限流速率</td> <td>能够根据系统状态动态调整限流策略，更加灵活。 适合负载波动较大的场景</td> <td>实现复杂，需要实时监控系统状态。 调整限流速率的策略需要精心设计</td> <td>负载波动较大的场景，如电商大促、秒杀活动</td> <td>假设系统负载超过 80% 时，将限流速率从每秒 100 个请求降低到每秒 50 个请求</td></tr></tbody></table> <p>限流算法的选择</p> <ul><li>如果需要平滑限流并支持突发流量，选择<strong>令牌桶算法</strong></li> <li>如果需要严格控制请求速率，选择<strong>漏桶算法</strong></li> <li>如果对限流精度要求不高，选择<strong>固定窗口算法</strong>或<strong>计数器算法</strong></li> <li>如果对限流精度要求较高，选择<strong>滑动窗口算法</strong></li> <li>如果需要根据系统状态动态调整限流策略，选择<strong>动态限流算法</strong></li></ul> <h3 id="缓存穿透、击穿和雪崩"><a href="#缓存穿透、击穿和雪崩" class="header-anchor">#</a> 缓存穿透、击穿和雪崩</h3> <p>充当缓存是 Redis 的主要功能之一，既然作为缓存，就面临穿透、击穿和雪崩的问题（所谓缓存三兄弟）</p> <ul><li>主要问题是如何避免以及发生了如何挽救</li></ul></div></div> <!----> <div class="page-edit"><!----> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2025/06/19, 23:12:53</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/9a8ad9/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">分布式系统与微服务架构概述</div></a> <a href="/pages/2afee4/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">注册中心和 RPC 框架详解</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/9a8ad9/" class="prev">分布式系统与微服务架构概述</a></span> <span class="next"><a href="/pages/2afee4/">注册中心和 RPC 框架详解</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/706b77/"><div>
            先进数据库技术（二）
            <!----></div></a> <span class="date">6-20</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/aecc6a/"><div>
            Java 静态代码分析
            <!----></div></a> <span class="date">6-19</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/2ce9d5/"><div>
            基于可擦除签名的权限切换协议
            <!----></div></a> <span class="date">6-5</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:Arkrypto@qq.com" title="邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/Arkrypto" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/#/my/m/music/playlist?id=5123040741" title="音乐" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2021-2025
    <span>Arkrypto | <a href="https://github.com/Arkrypto/Arkrypto.github.io/blob/main/LICENSE" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <div class="body-bg" style="background:url() center center / cover no-repeat;opacity:0.5;"></div> <!----> <!----></div><div class="global-ui"><div class="reco-bgm-panel" data-v-b1d3339e><audio id="bgm" src="/song/The Sun Also Rises.mp3" data-v-b1d3339e></audio> <div class="reco-float-box" style="bottom:10px;z-index:999999;background-color:blackcadetblue;display:none;" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><img src="/img/logo.png" data-v-b1d3339e></div> <div class="reco-bgm-box" style="left:10px;bottom:10px;z-index:999999;" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><div class="reco-bgm-cover" style="background-image:url(/img/logo.png);" data-v-b1d3339e><div class="mini-operation" style="display:none;" data-v-b1d3339e><i class="reco-bgm reco-bgm-pause" style="display:none;" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-play" style="display:none;" data-v-b1d3339e></i></div> <div class="falut-message" style="display:none;" data-v-b1d3339e>
          播放失败
        </div></div> <div class="reco-bgm-info" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><div class="info-box" data-v-b1d3339e><i class="reco-bgm reco-bgm-music music" data-v-b1d3339e></i>太阳照常升起</div> <div class="info-box" data-v-b1d3339e><i class="reco-bgm reco-bgm-artist" data-v-b1d3339e></i>久石譲</div> <div class="reco-bgm-progress" data-v-b1d3339e><div class="progress-bar" data-v-b1d3339e><div class="bar" data-v-b1d3339e></div></div></div> <div class="reco-bgm-operation" data-v-b1d3339e><i class="reco-bgm reco-bgm-last last" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-pause pause" style="display:none;" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-play play" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-next next" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-volume1 volume" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-mute mute" style="display:none;" data-v-b1d3339e></i> <div class="volume-bar" data-v-b1d3339e><div class="bar" data-v-b1d3339e></div></div></div></div> <div class="reco-bgm-left-box" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><i class="reco-bgm reco-bgm-left" data-v-b1d3339e></i></div></div></div></div></div>
    <script src="/assets/js/app.df01b8d3.js" defer></script><script src="/assets/js/3.b20caba6.js" defer></script><script src="/assets/js/37.5295b891.js" defer></script><script src="/assets/js/89.046449b0.js" defer></script>
  </body>
</html>
