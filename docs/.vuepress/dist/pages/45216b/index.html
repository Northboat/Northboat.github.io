<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>RabbitMQ 和 Kafka | Northboat</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="https://at.alicdn.com/t/font_3129839_xft6cqs5gc.css">
    <noscript><meta http-equiv="refresh" content="0; url=https://www.youngkbt.cn/noscript/"><style>.theme-vdoing-content { display:none }</noscript>
    <meta name="description" content="My Wiki">
    <meta name="keywords" content="Northboat, ComputerScience, DevOps, CyberSecurity">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.39b691be.css" as="style"><link rel="preload" href="/assets/js/app.d665c284.js" as="script"><link rel="preload" href="/assets/js/3.e0c187c4.js" as="script"><link rel="preload" href="/assets/js/40.f0fb9086.js" as="script"><link rel="preload" href="/assets/js/71.b6d585a6.js" as="script"><link rel="prefetch" href="/assets/js/10.8b446fb8.js"><link rel="prefetch" href="/assets/js/100.6d6af7ec.js"><link rel="prefetch" href="/assets/js/101.a01ab463.js"><link rel="prefetch" href="/assets/js/102.fc27f167.js"><link rel="prefetch" href="/assets/js/103.b0ca1e97.js"><link rel="prefetch" href="/assets/js/104.ffac3a34.js"><link rel="prefetch" href="/assets/js/105.b1ac4684.js"><link rel="prefetch" href="/assets/js/106.4fe3c7ac.js"><link rel="prefetch" href="/assets/js/107.f19977e1.js"><link rel="prefetch" href="/assets/js/108.9af8395e.js"><link rel="prefetch" href="/assets/js/109.794bfaa7.js"><link rel="prefetch" href="/assets/js/11.db06f384.js"><link rel="prefetch" href="/assets/js/110.ffca72bb.js"><link rel="prefetch" href="/assets/js/111.ba5c10e2.js"><link rel="prefetch" href="/assets/js/112.46561130.js"><link rel="prefetch" href="/assets/js/113.a3bb5037.js"><link rel="prefetch" href="/assets/js/114.9c180cbe.js"><link rel="prefetch" href="/assets/js/115.e163bdca.js"><link rel="prefetch" href="/assets/js/116.dd003d05.js"><link rel="prefetch" href="/assets/js/117.a10ceaee.js"><link rel="prefetch" href="/assets/js/118.d7a69eee.js"><link rel="prefetch" href="/assets/js/119.efd43fb7.js"><link rel="prefetch" href="/assets/js/12.3514c31d.js"><link rel="prefetch" href="/assets/js/120.bfd3b1b1.js"><link rel="prefetch" href="/assets/js/121.ccab2aa1.js"><link rel="prefetch" href="/assets/js/122.b0beb5fd.js"><link rel="prefetch" href="/assets/js/123.df801efc.js"><link rel="prefetch" href="/assets/js/124.aced7a00.js"><link rel="prefetch" href="/assets/js/125.2d4b6d49.js"><link rel="prefetch" href="/assets/js/126.9c05d2d0.js"><link rel="prefetch" href="/assets/js/127.79e281c8.js"><link rel="prefetch" href="/assets/js/128.e7136e6e.js"><link rel="prefetch" href="/assets/js/129.f5b5a3fe.js"><link rel="prefetch" href="/assets/js/13.accb642f.js"><link rel="prefetch" href="/assets/js/130.92056d2d.js"><link rel="prefetch" href="/assets/js/131.b89aeeff.js"><link rel="prefetch" href="/assets/js/132.8925ad47.js"><link rel="prefetch" href="/assets/js/133.88d8155e.js"><link rel="prefetch" href="/assets/js/134.42bb1ffb.js"><link rel="prefetch" href="/assets/js/135.5fb603fd.js"><link rel="prefetch" href="/assets/js/136.3e7fb66a.js"><link rel="prefetch" href="/assets/js/137.ed2514d9.js"><link rel="prefetch" href="/assets/js/138.ab9cc780.js"><link rel="prefetch" href="/assets/js/139.208cc306.js"><link rel="prefetch" href="/assets/js/14.5c55299f.js"><link rel="prefetch" href="/assets/js/140.031c16a1.js"><link rel="prefetch" href="/assets/js/141.ada06046.js"><link rel="prefetch" href="/assets/js/142.51dd7d20.js"><link rel="prefetch" href="/assets/js/143.cb0985bf.js"><link rel="prefetch" href="/assets/js/144.b3ff947c.js"><link rel="prefetch" href="/assets/js/145.57c15072.js"><link rel="prefetch" href="/assets/js/146.4be9fcd0.js"><link rel="prefetch" href="/assets/js/147.b511bb37.js"><link rel="prefetch" href="/assets/js/148.f945a667.js"><link rel="prefetch" href="/assets/js/149.c119cf6d.js"><link rel="prefetch" href="/assets/js/15.1cd29e94.js"><link rel="prefetch" href="/assets/js/150.5278a95f.js"><link rel="prefetch" href="/assets/js/151.d4f9cc91.js"><link rel="prefetch" href="/assets/js/152.ee32104b.js"><link rel="prefetch" href="/assets/js/153.7de80bed.js"><link rel="prefetch" href="/assets/js/154.ae2a4226.js"><link rel="prefetch" href="/assets/js/155.a49ffbc1.js"><link rel="prefetch" href="/assets/js/156.56595e38.js"><link rel="prefetch" href="/assets/js/157.fd11a2fd.js"><link rel="prefetch" href="/assets/js/158.8e1ce051.js"><link rel="prefetch" href="/assets/js/159.f3797654.js"><link rel="prefetch" href="/assets/js/16.6390e543.js"><link rel="prefetch" href="/assets/js/160.503d405a.js"><link rel="prefetch" href="/assets/js/161.84686fe9.js"><link rel="prefetch" href="/assets/js/162.28a2072f.js"><link rel="prefetch" href="/assets/js/163.117abe35.js"><link rel="prefetch" href="/assets/js/164.8cc2b9b4.js"><link rel="prefetch" href="/assets/js/165.9a6ea5cc.js"><link rel="prefetch" href="/assets/js/166.3955fc54.js"><link rel="prefetch" href="/assets/js/167.c7218c4f.js"><link rel="prefetch" href="/assets/js/168.271174d5.js"><link rel="prefetch" href="/assets/js/169.9a537ed0.js"><link rel="prefetch" href="/assets/js/17.8ebb173d.js"><link rel="prefetch" href="/assets/js/170.f3b82e94.js"><link rel="prefetch" href="/assets/js/171.84fc3b5d.js"><link rel="prefetch" href="/assets/js/172.65a7dfdd.js"><link rel="prefetch" href="/assets/js/173.a901b46d.js"><link rel="prefetch" href="/assets/js/174.0d716402.js"><link rel="prefetch" href="/assets/js/175.d6e6efa2.js"><link rel="prefetch" href="/assets/js/176.666e3747.js"><link rel="prefetch" href="/assets/js/177.98bf8458.js"><link rel="prefetch" href="/assets/js/18.b64c4c5c.js"><link rel="prefetch" href="/assets/js/19.fa12655d.js"><link rel="prefetch" href="/assets/js/2.4eeb132c.js"><link rel="prefetch" href="/assets/js/20.bfff0801.js"><link rel="prefetch" href="/assets/js/21.e0d3cfac.js"><link rel="prefetch" href="/assets/js/22.e9dc3796.js"><link rel="prefetch" href="/assets/js/23.bd1f8714.js"><link rel="prefetch" href="/assets/js/24.d5125a79.js"><link rel="prefetch" href="/assets/js/25.066d11c5.js"><link rel="prefetch" href="/assets/js/26.4ba8fcc8.js"><link rel="prefetch" href="/assets/js/27.ea74c083.js"><link rel="prefetch" href="/assets/js/28.59749eb0.js"><link rel="prefetch" href="/assets/js/29.9716bc75.js"><link rel="prefetch" href="/assets/js/30.99c05562.js"><link rel="prefetch" href="/assets/js/31.cac4b1ce.js"><link rel="prefetch" href="/assets/js/32.2e2be4b1.js"><link rel="prefetch" href="/assets/js/33.a743588d.js"><link rel="prefetch" href="/assets/js/34.7139dcee.js"><link rel="prefetch" href="/assets/js/35.1d274260.js"><link rel="prefetch" href="/assets/js/36.46d12ee0.js"><link rel="prefetch" href="/assets/js/37.b0238cfc.js"><link rel="prefetch" href="/assets/js/38.91f68d90.js"><link rel="prefetch" href="/assets/js/39.ab0caa26.js"><link rel="prefetch" href="/assets/js/4.6e3273d6.js"><link rel="prefetch" href="/assets/js/41.622fb909.js"><link rel="prefetch" href="/assets/js/42.bb608400.js"><link rel="prefetch" href="/assets/js/43.3fe39c35.js"><link rel="prefetch" href="/assets/js/44.132f7ba5.js"><link rel="prefetch" href="/assets/js/45.99d6aff6.js"><link rel="prefetch" href="/assets/js/46.e801356c.js"><link rel="prefetch" href="/assets/js/47.3d676561.js"><link rel="prefetch" href="/assets/js/48.b84b247d.js"><link rel="prefetch" href="/assets/js/49.5ff8cdb5.js"><link rel="prefetch" href="/assets/js/5.0b35d4d2.js"><link rel="prefetch" href="/assets/js/50.98c0b12d.js"><link rel="prefetch" href="/assets/js/51.f7a866dc.js"><link rel="prefetch" href="/assets/js/52.e3d8fa57.js"><link rel="prefetch" href="/assets/js/53.60eb6a0e.js"><link rel="prefetch" href="/assets/js/54.a4bafab0.js"><link rel="prefetch" href="/assets/js/55.9c8e2edd.js"><link rel="prefetch" href="/assets/js/56.5fdf5a13.js"><link rel="prefetch" href="/assets/js/57.51b7f06f.js"><link rel="prefetch" href="/assets/js/58.f7abe603.js"><link rel="prefetch" href="/assets/js/59.6b1f320b.js"><link rel="prefetch" href="/assets/js/6.d18fd2c3.js"><link rel="prefetch" href="/assets/js/60.62f4f38a.js"><link rel="prefetch" href="/assets/js/61.38501521.js"><link rel="prefetch" href="/assets/js/62.fee979ea.js"><link rel="prefetch" href="/assets/js/63.46f817a7.js"><link rel="prefetch" href="/assets/js/64.643c6afc.js"><link rel="prefetch" href="/assets/js/65.dddab1ea.js"><link rel="prefetch" href="/assets/js/66.0f69b459.js"><link rel="prefetch" href="/assets/js/67.410494a2.js"><link rel="prefetch" href="/assets/js/68.8f136f88.js"><link rel="prefetch" href="/assets/js/69.aa93a998.js"><link rel="prefetch" href="/assets/js/7.7c0e5aae.js"><link rel="prefetch" href="/assets/js/70.f19c22ce.js"><link rel="prefetch" href="/assets/js/72.e56642e2.js"><link rel="prefetch" href="/assets/js/73.95716e3c.js"><link rel="prefetch" href="/assets/js/74.7ba73646.js"><link rel="prefetch" href="/assets/js/75.639e3e42.js"><link rel="prefetch" href="/assets/js/76.9fb56389.js"><link rel="prefetch" href="/assets/js/77.2afc8ea1.js"><link rel="prefetch" href="/assets/js/78.5325feba.js"><link rel="prefetch" href="/assets/js/79.a60aab79.js"><link rel="prefetch" href="/assets/js/8.c4607f22.js"><link rel="prefetch" href="/assets/js/80.86f905f7.js"><link rel="prefetch" href="/assets/js/81.cd2fa884.js"><link rel="prefetch" href="/assets/js/82.4d41a346.js"><link rel="prefetch" href="/assets/js/83.b2b35bd6.js"><link rel="prefetch" href="/assets/js/84.37cadace.js"><link rel="prefetch" href="/assets/js/85.20fe3591.js"><link rel="prefetch" href="/assets/js/86.5aa28ec2.js"><link rel="prefetch" href="/assets/js/87.c546a477.js"><link rel="prefetch" href="/assets/js/88.afa359b6.js"><link rel="prefetch" href="/assets/js/89.8a2b6a89.js"><link rel="prefetch" href="/assets/js/9.8da42e60.js"><link rel="prefetch" href="/assets/js/90.4d38ecdd.js"><link rel="prefetch" href="/assets/js/91.bdb514f9.js"><link rel="prefetch" href="/assets/js/92.0b3ad886.js"><link rel="prefetch" href="/assets/js/93.db102d93.js"><link rel="prefetch" href="/assets/js/94.842bc20b.js"><link rel="prefetch" href="/assets/js/95.1972b8ee.js"><link rel="prefetch" href="/assets/js/96.c9a692d9.js"><link rel="prefetch" href="/assets/js/97.3836e0e5.js"><link rel="prefetch" href="/assets/js/98.77f44ee0.js"><link rel="prefetch" href="/assets/js/99.51e8e751.js">
    <link rel="stylesheet" href="/assets/css/0.styles.39b691be.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu have-body-img"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="Northboat" class="logo"> <span class="site-name can-hide">Northboat</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/cs/" class="nav-link">计算机科学与技术</a></div><div class="nav-item"><a href="/dev/" class="nav-link">开发与运维</a></div><div class="nav-item"><a href="/sec/" class="nav-link">网络与信息安全</a></div><div class="nav-item"><a href="/mine/" class="nav-link">我的</a></div><div class="nav-item"><a href="/archives/" class="nav-link">归档</a></div> <a href="https://github.com/Northboat" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/img/avatar.png"> <div class="blogger-info"><h3>Northboat</h3> <span>就在坚冰还盖着北海的时候，我看到了怒放的梅花</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/cs/" class="nav-link">计算机科学与技术</a></div><div class="nav-item"><a href="/dev/" class="nav-link">开发与运维</a></div><div class="nav-item"><a href="/sec/" class="nav-link">网络与信息安全</a></div><div class="nav-item"><a href="/mine/" class="nav-link">我的</a></div><div class="nav-item"><a href="/archives/" class="nav-link">归档</a></div> <a href="https://github.com/Northboat" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>后端开发</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>运维</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Linux 基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>中间件</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/0d525f/" class="sidebar-link">MySQL 和 Redis</a></li><li><a href="/pages/45216b/" aria-current="page" class="active sidebar-link">RabbitMQ 和 Kafka</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/45216b/#消息队列模型" class="sidebar-link">消息队列模型</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/45216b/#点对点模型" class="sidebar-link">点对点模型</a></li><li class="sidebar-sub-header level3"><a href="/pages/45216b/#订阅发布模型" class="sidebar-link">订阅发布模型</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/45216b/#rabbitmq" class="sidebar-link">RabbitMQ</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/45216b/#安装部署" class="sidebar-link">安装部署</a></li><li class="sidebar-sub-header level3"><a href="/pages/45216b/#spring-集成" class="sidebar-link">Spring 集成</a></li><li class="sidebar-sub-header level3"><a href="/pages/45216b/#确保可靠传输" class="sidebar-link">确保可靠传输</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/45216b/#kafka" class="sidebar-link">Kafka</a></li><li class="sidebar-sub-header level2"><a href="/pages/45216b/#消息队列的选择" class="sidebar-link">消息队列的选择</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/45216b/#kafka-vs-rabbitmq" class="sidebar-link">Kafka VS RabbitMQ</a></li><li class="sidebar-sub-header level3"><a href="/pages/45216b/#其他" class="sidebar-link">其他</a></li></ul></li></ul></li><li><a href="/pages/49af8b/" class="sidebar-link">H2 和 PostgreSQL</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>服务部署</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端开发</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06970110><div class="articleInfo" data-v-06970110><ul class="breadcrumbs" data-v-06970110><li data-v-06970110><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06970110></a></li> <li data-v-06970110><a href="/dev/#开发与运维" data-v-06970110>开发与运维</a></li><li data-v-06970110><a href="/dev/#运维" data-v-06970110>运维</a></li><li data-v-06970110><a href="/dev/#中间件" data-v-06970110>中间件</a></li></ul> <div class="info" data-v-06970110><div title="作者" class="author iconfont icon-touxiang" data-v-06970110><a href="https://github.com/Northboat" target="_blank" title="作者" class="beLink" data-v-06970110>Northboat</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06970110><a href="javascript:;" data-v-06970110>2025-2-23</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">RabbitMQ 和 Kafka<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h2 id="消息队列模型"><a href="#消息队列模型" class="header-anchor">#</a> 消息队列模型</h2> <h3 id="点对点模型"><a href="#点对点模型" class="header-anchor">#</a> 点对点模型</h3> <p>队列模型，又叫点对点模型，每个生产者对应一个消费者（一对一）</p> <p>比如 OJ 中 MQ 的使用，后端收到判题请求后，先将判题记录写入数据库，而后作为生产者将判题记录 ID 写入消息队列，此时真正的判题模块由于订阅了该判题队列，于是自动从 MQ 中读出判题请求 ID，从 DB 中拿取数据执行判题业务，最后通过 WebSocket 返回</p> <h3 id="订阅发布模型"><a href="#订阅发布模型" class="header-anchor">#</a> 订阅发布模型</h3> <p>订阅发布模型，一个生产者将把消息广播到每一个订阅者，即一对多</p> <p>订阅发布能够将串行执行的任务变成“并行”，例如以下串行场景，他是一步步执行</p> <img src="/assets/img/image-20250303143017426.77128625.png"> <p>若引入 MQ，它可以变成这样的形式，这是合理的，实际上，更新积分、通知商家、更新用户标签这三个事件并没有直接的逻辑联系或是执行顺序问题，他们都是由“更新订单状态触发”</p> <img src="/assets/img/image-20250303143143342.6d217d1f.png"> <p>从而大幅提高效率</p> <p>上述订阅发布模式的举例是 MQ 一大应用场景，<strong>异步处理</strong>，而队列模式的举例是<strong>应用解耦</strong>，消息队列的常用场景如下</p> <ul><li>异步处理：就是将一些非核心的业务流程以异步并行的方式执行，从而减少请求响应时间，提高系统吞吐量</li> <li>应用解耦：顾名思义就是解除应用系统之间的耦合依赖。通过消息队列，使得每个应用系统不必受其他系统影响，可以更独立自主运行</li> <li>流量削峰：是消息队列中的常用场景，一般在秒杀或团抢活动中使用广泛</li> <li>消息通讯：指应用间的数据通信，消息队列一般都内置了高效的通信机制，因此也可以用在纯的消息通讯。比如实现点对点消息队列，或者聊天室等点对点通讯</li></ul> <h2 id="rabbitmq"><a href="#rabbitmq" class="header-anchor">#</a> RabbitMQ</h2> <h3 id="安装部署"><a href="#安装部署" class="header-anchor">#</a> 安装部署</h3> <p>manjaro 安装</p> <div class="language-bash extra-class"><pre class="language-bash"><code>yay <span class="token parameter variable">-S</span> rabbitmq rabbitmqadmin
</code></pre></div><p>启动</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">sudo</span> rabbitmq-plugins <span class="token builtin class-name">enable</span>
<span class="token function">sudo</span> rabbitmq-server
</code></pre></div><p>默认端口</p> <ul><li>管理界面：15672</li> <li>客户端：5672</li></ul> <p>后台运行</p> <div class="language-bash extra-class"><pre class="language-bash"><code>rabbitmq-server <span class="token parameter variable">-detached</span>
</code></pre></div><h3 id="spring-集成"><a href="#spring-集成" class="header-anchor">#</a> Spring 集成</h3> <p>引入 RabbitMQ 依赖</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-amqp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>配置文件</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
	<span class="token key atrule">rabbitmq</span><span class="token punctuation">:</span>
		<span class="token key atrule">host</span><span class="token punctuation">:</span> 10.2.1.231
		<span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">5672</span>
		<span class="token key atrule">username</span><span class="token punctuation">:</span> northboat
		<span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">123456</span>
		<span class="token key atrule">virtualHost</span><span class="token punctuation">:</span> order
</code></pre></div><p>一个简单的消费者，订阅队列&quot;<code>rabbitmq_queue&quot;</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Consumer</span> <span class="token punctuation">{</span>
	<span class="token annotation punctuation">@RabbitHandler</span>
	<span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>queuesToDeclare <span class="token operator">=</span> <span class="token annotation punctuation">@Queue</span><span class="token punctuation">(</span><span class="token string">&quot;rabbitmq_queue&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;消费者消费消息: &quot;</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>一个简单的生产者</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Producer</span> <span class="token punctuation">{</span>
	<span class="token annotation punctuation">@Autowired</span>
	<span class="token keyword">private</span> <span class="token class-name">RabbitTemplate</span> rabbitTemplate<span class="token punctuation">;</span>
	
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">produce</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">String</span> message <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;Beijing&quot;</span><span class="token punctuation">;</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;生产者产生消息: &quot;</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
		rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">&quot;rabbitmq_queue&quot;</span><span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这里传输的是简单字符串，我们尝试传输一个实体对象 User，需要进行序列化，即继承<code>Serializable</code>类</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
	<span class="token keyword">public</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span>
	<span class="token comment">// 省略get和set方法</span>
<span class="token punctuation">}</span>
</code></pre></div><p>仍然通过<code>convertAndSend</code>方法进行传输</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Producer</span> <span class="token punctuation">{</span>
	<span class="token annotation punctuation">@Autowired</span>
	<span class="token keyword">private</span> <span class="token class-name">RabbitTemplate</span> rabbitTemplate<span class="token punctuation">;</span>
	
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">produce</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>	
		<span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">&quot;nmsl&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;wdnmd&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;生产者生产消息: &quot;</span> <span class="token operator">+</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>
		
		rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">&quot;rabbitmq_queue_object&quot;</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>convertAndSend() 方法支持 String、Integer、Object 等基础的数据类型</p> <h3 id="确保可靠传输"><a href="#确保可靠传输" class="header-anchor">#</a> 确保可靠传输</h3> <p>在使用消息队列时，因为生产者和消费者不直接交互，所以面临下面几个问题</p> <ol><li>要把消息添加到队列中，怎么保证消息成功添加？</li> <li>如何保证消息发送出去时一定会被消费者正常消费？</li> <li>消费者正常消费了，生产者或者队列如何知道消费者已经成功消费了消息？</li></ol> <p>那么，如何保证消息 100% 可靠性发送？我们可以采用 ack 应答 + 日志记录 + 定时任务来实现</p> <p>假设有一个创建订单业务，后端收到请求后，将该业务通过消息队列发送到具体的业务模块，我们这样保证消息的可靠传输</p> <ol><li>完成订单业务处理后，生产者发送一条消息到消息队列，同时记录这条操作日志（发送中）</li> <li>消费者收到消息后处理进行</li> <li>消费者处理成功后给消息队列发送 ack 应答</li> <li>消息队列收到 ack 应答后，给生成者的 Confirm Listener 发送确认</li> <li>生产者对消息日志表进行操作，修改之前的日志状态（发送成功）</li> <li>在消费端返回应答的过程中，可能发生网络异常，导致生产者未收到应答消息，因此需要一个定时任务去提取其状态为“发送中”并已经超时的消息集合</li> <li>使用定时任务判断为消息事先设置的最大重发次数，大于最大重发次数就判断消息发送失败，更新日志记录状态为发送失败</li></ol> <p>流程图如下</p> <img src="data:image/png;base64,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"> <p>具体实现</p> <p>1️⃣ 创建生产者</p> <p>定义应答方法<code>final RabbitTemplate.ConfirmCallback confirmCallback = new RabbitTemplate.ConfirmCallback() {}</code>，即定义收到消费者发回的 ack 应答后的处理：更新日志记录，修改订单状态为成功</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RabbitOrderSender</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Logger</span> logger <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">RabbitOrderSender</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RabbitTemplate</span> rabbitTemplate<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">MessageLogMapper</span> messageLogMapper<span class="token punctuation">;</span>

    <span class="token comment">/**
     * Broker应答后，会调用该方法区获取应答结果
     */</span>
    <span class="token keyword">final</span> <span class="token class-name">RabbitTemplate<span class="token punctuation">.</span>ConfirmCallback</span> confirmCallback <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RabbitTemplate<span class="token punctuation">.</span>ConfirmCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">confirm</span><span class="token punctuation">(</span><span class="token class-name">CorrelationData</span> correlationData<span class="token punctuation">,</span> <span class="token keyword">boolean</span> ack<span class="token punctuation">,</span> <span class="token class-name">String</span> cause<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;correlationData：&quot;</span><span class="token operator">+</span>correlationData<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> messageId <span class="token operator">=</span> correlationData<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;消息确认返回值：&quot;</span><span class="token operator">+</span>ack<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>ack<span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token comment">//如果返回成功，则进行更新</span>
                messageLogMapper<span class="token punctuation">.</span><span class="token function">changeMessageLogStatus</span><span class="token punctuation">(</span>messageId<span class="token punctuation">,</span> <span class="token class-name">Constans</span><span class="token punctuation">.</span><span class="token constant">ORDER_SEND_SUCCESS</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token comment">//失败进行操作：根据具体失败原因选择重试或补偿等手段</span>
                logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;异常处理,返回结果：&quot;</span><span class="token operator">+</span>cause<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * 发送消息方法调用: 构建自定义对象消息
     * @param order
     * @throws Exception
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span>  <span class="token function">sendOrder</span><span class="token punctuation">(</span><span class="token class-name">OrderInfo</span> order<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// 通过实现 ConfirmCallback 接口，消息发送到 Broker 后触发回调，确认消息是否到达 Broker 服务器，也就是只确认是否正确到达 Exchange 中</span>
        rabbitTemplate<span class="token punctuation">.</span><span class="token function">setConfirmCallback</span><span class="token punctuation">(</span>confirmCallback<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//消息唯一ID</span>
        <span class="token class-name">CorrelationData</span> correlationData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CorrelationData</span><span class="token punctuation">(</span>order<span class="token punctuation">.</span><span class="token function">getMessageId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">&quot;order.exchange&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;order.message&quot;</span><span class="token punctuation">,</span> order<span class="token punctuation">,</span> correlationData<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>当生产者调用<code>ConfirmCallback()</code>，说明当前请求已被消费者消费</p> <p>2️⃣ 定义消息定时重发任务</p> <p>定期去数据库中找状态为 0 的数据项，进行消息重发</p> <ul><li>通过<code>@Compoent</code>和<code>@Scheduled(initialDelay = 5000, fixedDelay = 10000)</code>注解将定时任务注入 Spring，初始 5 s 后开始执行，往后每 10s 执行一次</li> <li>判断逻辑为：当重发大于两次，认为任务失败，不再执行，否则通过 RabbitOrderSender 进行重发</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RetryMessageTasker</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Logger</span> logger <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">RetryMessageTasker</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RabbitOrderSender</span> rabbitOrderSender<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">MessageLogMapper</span> messageLogMapper<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 定时任务
     */</span>
    <span class="token annotation punctuation">@Scheduled</span><span class="token punctuation">(</span>initialDelay <span class="token operator">=</span> <span class="token number">5000</span><span class="token punctuation">,</span> fixedDelay <span class="token operator">=</span> <span class="token number">10000</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">reSend</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;-----------定时任务开始-----------&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//抽取消息状态为0且已经超时的消息集合</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MessageLog</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> messageLogMapper<span class="token punctuation">.</span><span class="token function">query4StatusAndTimeoutMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        list<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>messageLog <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">//投递三次以上的消息</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>messageLog<span class="token punctuation">.</span><span class="token function">getTryCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token comment">//更新失败的消息</span>
                messageLogMapper<span class="token punctuation">.</span><span class="token function">changeMessageLogStatus</span><span class="token punctuation">(</span>messageLog<span class="token punctuation">.</span><span class="token function">getMessageId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Constans</span><span class="token punctuation">.</span><span class="token constant">ORDER_SEND_FAILURE</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token comment">// 重试投递消息，将重试次数递增</span>
                messageLogMapper<span class="token punctuation">.</span><span class="token function">update4ReSend</span><span class="token punctuation">(</span>messageLog<span class="token punctuation">.</span><span class="token function">getMessageId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">OrderInfo</span> reSendOrder <span class="token operator">=</span> <span class="token class-name">JsonUtil</span><span class="token punctuation">.</span><span class="token function">jsonToObject</span><span class="token punctuation">(</span>messageLog<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">OrderInfo</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    rabbitOrderSender<span class="token punctuation">.</span><span class="token function">sendOrder</span><span class="token punctuation">(</span>reSendOrder<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;-----------异常处理-----------&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>3️⃣ 运行测试</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MqApplicationTests</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">OrderService</span> orderService<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 测试订单创建
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">createOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">OrderInfo</span> order <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        order<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token string">&quot;201901236&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        order<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;测试订单6&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        order<span class="token punctuation">.</span><span class="token function">setMessageId</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;$&quot;</span> <span class="token operator">+</span> <span class="token constant">UUID</span><span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            orderService<span class="token punctuation">.</span><span class="token function">createOrder</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h2 id="kafka"><a href="#kafka" class="header-anchor">#</a> Kafka</h2> <p>日志处理</p> <h2 id="消息队列的选择"><a href="#消息队列的选择" class="header-anchor">#</a> 消息队列的选择</h2> <h3 id="kafka-vs-rabbitmq"><a href="#kafka-vs-rabbitmq" class="header-anchor">#</a> Kafka VS RabbitMQ</h3> <p>Kafka 设计之初是用于处理大批量的日志，基于自定义的二进制协议，专注于高吞吐量，其特点如下</p> <p>而 RabbitMQ 的设计目标是<strong>低延迟</strong>和<strong>可靠传递</strong>，它的消息确认机制和重试机制可以确保任务被正确处理，适合高并发的任务，常用于业务的解耦、异步处理</p> <table><thead><tr><th>消息队列</th> <th>协议</th> <th>消息传输</th> <th>实时性</th> <th>扩展性</th> <th>持久化</th></tr></thead> <tbody><tr><td>Kafka</td> <td>基于自定义的二进制协议，专注于高吞吐量</td> <td>消息以<strong>日志</strong>的形式持久化存储，支持高吞吐量的消息流；不支持消息确认（ACK）和重试机制，但可以通过消费者偏移量（Offset）实现消息重放</td> <td>延迟较高，适合批量处理</td> <td>支持分布式集群，可以轻松扩展到数百个节点，处理海量数据</td> <td>消息持久化到磁盘，支持长期存储和回溯</td></tr> <tr><td>RabbitMQ</td> <td>基于 AMQP（Advanced Message Queuing Protocol），支持多种消息模式（如点对点、发布/订阅）</td> <td>支持消息确认（ACK）和重试机制，确保消息可靠传递；支持消息优先级、延迟队列、死信队列等高级特性</td> <td>适合低延迟的消息传递</td> <td>支持复杂的路由规则（如 direct、topic、fanout 等交换器）</td> <td>可以通过集群实现高可用性，但扩展性相对有限</td></tr></tbody></table> <p>什么是 AMQP（Advanced Message Queuing Protocol）</p> <p>RabbitMQ 的适用场景</p> <ul><li>任务队列：适合需要<strong>实时处理</strong>的任务，例如 Web 应用中的异步任务（如发送邮件、处理订单）</li> <li>低延迟场景：需要<strong>快速响应</strong>的场景，例如实时通知、即时消息</li> <li>复杂路由：需要根据消息内容或规则将消息路由到不同消费者的场景</li> <li>可靠传递：需要确保<strong>每条消息都被正确处理</strong>，适合对消息丢失敏感的场景</li></ul> <p>Kafka 使用场景</p> <ul><li>日志收集：适合收集和存储大量日志数据，例如应用程序日志、系统日志</li> <li>流处理：适合实时<strong>流处理场景</strong>，例如用户行为分析、实时推荐系统</li> <li>大数据管道：适合作为<strong>大数据</strong>生态系统的数据传输管道，例如将数据从生产系统传输到 Hadoop 或 Spark</li> <li>事件溯源：适合需要<strong>记录事件历史</strong>的场景，例如金融交易记录、审计日志（因为数据会写入磁盘进行持久化）</li></ul> <p>选择 RabbitMQ 的场景</p> <ul><li>你需要低延迟的消息传递</li> <li>你需要复杂的路由规则（如根据消息内容路由到不同消费者）</li> <li>你需要确保每条消息都被正确处理（如金融交易、订单处理）</li> <li>你的系统规模较小或中等，不需要处理海量数据</li></ul> <p>选择 Kafka 的场景</p> <ul><li>你需要高吞吐量的消息处理（如日志收集、用户行为分析）</li> <li>你需要持久化存储消息，并且可能需要回溯历史消息</li> <li>你需要流处理能力（如实时推荐、实时监控）</li> <li>你的系统规模较大，需要处理海量数据。</li></ul> <p>RabbitMQ 为什么 RabbitMQ 并发能力强于 Kafka 而 Kafka 吞吐量大于 RabbitMQ？</p> <p>首先回答吞吐量的问题</p> <ol><li>Kafka 的吞吐量高很大原因来自于其<strong>批处理</strong>设计，将多个消息打包成一个批次来减少网络和磁盘 I/O 的开销，相应的，这样处理的延迟会变大</li> <li>另外，Kafka 不仅仅是一个消息队列，它还提供了 Kafka Streams 和 Kafka Connect 等工具，用于实现<strong>流处理</strong>，从而大大提高数据处理速度</li></ol> <p>什么是批处理，什么是流处理？</p> <ul><li>批处理是指对<strong>静态的、有限的数据集</strong>进行处理。数据通常以文件或数据库表的形式存储，处理过程是周期性的（如每天、每小时）</li> <li>流处理是指对<strong>连续的、无限的数据流</strong>进行实时或近实时的处理。数据通常是动态生成的（如日志、传感器数据、用户行为数据）</li></ul> <p>💤 PS：流处理让我想到 Java Stream 流，虽然都叫“流”，但 Java Stream 实际上是一个用于对集合（Collection）数据进行函数式操作（如过滤、映射、排序、聚合等）的 API，提供一种更简洁、更高效的方式来处理集合数据（所谓函数式编程）</p> <p>而 RabbitMQ 的高并发显著强于 Kafka，首先我们要明确到底什么是并发能力强，并发能力强并不是只 QPS（Queries Per Second）高，1s 在计算机系统其实是一个比较大的时间跨度，以至于他反应的实际上是吞吐量而并非并发量</p> <p>所以，这里说 RabbitMQ 的高并发能力其实指的是低延迟的处理，进行快速的实时反馈</p> <h3 id="其他"><a href="#其他" class="header-anchor">#</a> 其他</h3> <p>现有一些开源 MQ 的对比</p> <table><thead><tr><th>特性\消息队列</th> <th>Kafka</th> <th>RocketMQ</th> <th>RabbitMQ</th> <th>ActiveMQ</th></tr></thead> <tbody><tr><td>单机吞吐量</td> <td>10万级</td> <td>10万级</td> <td>万级</td> <td>10万级</td></tr> <tr><td>开发语言</td> <td>Scala</td> <td>Java</td> <td>Erlang</td> <td>Java</td></tr> <tr><td>高可用</td> <td>分布式</td> <td>分布式</td> <td>主从</td> <td>分布式</td></tr> <tr><td>消息延迟</td> <td>ms级</td> <td>ms级</td> <td>us级</td> <td>ms级</td></tr> <tr><td>消息丢失</td> <td>理论上不会丢失</td> <td>理论上不会丢失</td> <td>低</td> <td>低</td></tr> <tr><td>消费模式</td> <td>拉取</td> <td>推拉</td> <td>推拉</td> <td></td></tr> <tr><td>持久化</td> <td></td> <td>文件</td> <td>内存，文件</td> <td>内存，文件，数据库</td></tr> <tr><td>支持协议</td> <td>自定义协议</td> <td>自定义协议</td> <td>AMQP，XMPP, SMTP,STOMP</td> <td>AMQP,MQTT,OpenWire,STOMP</td></tr> <tr><td>社区活跃度</td> <td>高</td> <td>中</td> <td>高</td> <td>高</td></tr> <tr><td>管理界面</td> <td></td> <td>web console</td> <td>好</td> <td>一般</td></tr> <tr><td>部署难度</td> <td>中</td> <td></td> <td>低</td> <td></td></tr> <tr><td>部署方式</td> <td>独立</td> <td>独立</td> <td>独立</td> <td>独立，嵌入</td></tr> <tr><td>成熟度</td> <td>成熟</td> <td>比较成熟</td> <td>成熟</td> <td>成熟</td></tr> <tr><td>综合评价</td> <td>优点：拥有强大的性能及吞吐量，兼容性很好。 缺点：由于支持消息堆积，导致延迟比较高</td> <td>优点：性能好，稳定可靠，有活跃的中文社区，特点响应快。 缺点：兼容性较差，但随着影响力的扩大，该问题会有改善</td> <td>优点：产品成熟，容易部署和使用，拥有灵活的路由配置。 缺点：性能和吞吐量较差，不易进行二次开发</td> <td>优点：产品成熟，支持协议多，支持多种语言的客户端。 缺点：社区不活跃，存在消息丢失的可能</td></tr></tbody></table></div></div> <!----> <div class="page-edit"><!----> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2025/07/21, 19:44:39</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/0d525f/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">MySQL 和 Redis</div></a> <a href="/pages/49af8b/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">H2 和 PostgreSQL</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/0d525f/" class="prev">MySQL 和 Redis</a></span> <span class="next"><a href="/pages/49af8b/">H2 和 PostgreSQL</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/49af8b/"><div>
            H2 和 PostgreSQL
            <!----></div></a> <span class="date">07-19</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/3e5274/"><div>
            Java 白盒测试和安全编码
            <!----></div></a> <span class="date">7-17</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/aecc6a/"><div>
            基于 MCP 的审计 Agent 实现
            <!----></div></a> <span class="date">6-24</span></dt></dl> <dl><dd></dd> <dt><a href="/archives" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:northboat@163.com" title="邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/northboat" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/#/my/m/music/playlist?id=5123040741" title="音乐" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2021-2025
    <span>Northboat | <a href="https://github.com/Northboat/Northboat.github.io/blob/main/LICENSE" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <div class="body-bg" style="background:url() center center / cover no-repeat;opacity:0.5;"></div> <!----> <!----></div><div class="global-ui"><div class="reco-bgm-panel" data-v-b1d3339e><audio id="bgm" src="/song/The Sun Also Rises.mp3" data-v-b1d3339e></audio> <div class="reco-float-box" style="bottom:10px;z-index:999999;background-color:blackcadetblue;display:none;" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><img src="/img/logo.png" data-v-b1d3339e></div> <div class="reco-bgm-box" style="left:10px;bottom:10px;z-index:999999;" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><div class="reco-bgm-cover" style="background-image:url(/img/logo.png);" data-v-b1d3339e><div class="mini-operation" style="display:none;" data-v-b1d3339e><i class="reco-bgm reco-bgm-pause" style="display:none;" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-play" style="display:none;" data-v-b1d3339e></i></div> <div class="falut-message" style="display:none;" data-v-b1d3339e>
          播放失败
        </div></div> <div class="reco-bgm-info" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><div class="info-box" data-v-b1d3339e><i class="reco-bgm reco-bgm-music music" data-v-b1d3339e></i>太阳照常升起</div> <div class="info-box" data-v-b1d3339e><i class="reco-bgm reco-bgm-artist" data-v-b1d3339e></i>久石譲</div> <div class="reco-bgm-progress" data-v-b1d3339e><div class="progress-bar" data-v-b1d3339e><div class="bar" data-v-b1d3339e></div></div></div> <div class="reco-bgm-operation" data-v-b1d3339e><i class="reco-bgm reco-bgm-last last" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-pause pause" style="display:none;" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-play play" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-next next" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-volume1 volume" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-mute mute" style="display:none;" data-v-b1d3339e></i> <div class="volume-bar" data-v-b1d3339e><div class="bar" data-v-b1d3339e></div></div></div></div> <div class="reco-bgm-left-box" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><i class="reco-bgm reco-bgm-left" data-v-b1d3339e></i></div></div></div></div></div>
    <script src="/assets/js/app.d665c284.js" defer></script><script src="/assets/js/3.e0c187c4.js" defer></script><script src="/assets/js/40.f0fb9086.js" defer></script><script src="/assets/js/71.b6d585a6.js" defer></script>
  </body>
</html>
