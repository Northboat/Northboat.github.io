<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>集成电路设计基础 | Arkrypto</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="https://at.alicdn.com/t/font_3129839_xft6cqs5gc.css">
    <noscript><meta http-equiv="refresh" content="0; url=https://www.youngkbt.cn/noscript/"><style>.theme-vdoing-content { display:none }</noscript>
    <meta name="description" content="My Wiki">
    <meta name="keywords" content="Arkrypto, ComputerScience, DevOps, Crypto">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.0235893d.css" as="style"><link rel="preload" href="/assets/js/app.ba90bb8b.js" as="script"><link rel="preload" href="/assets/js/3.a94f18cb.js" as="script"><link rel="preload" href="/assets/js/37.75de189e.js" as="script"><link rel="preload" href="/assets/js/29.94ccb989.js" as="script"><link rel="prefetch" href="/assets/js/10.5823af28.js"><link rel="prefetch" href="/assets/js/100.1a5d6e59.js"><link rel="prefetch" href="/assets/js/101.7d50a0b2.js"><link rel="prefetch" href="/assets/js/102.66d2cc7e.js"><link rel="prefetch" href="/assets/js/103.fc4420a1.js"><link rel="prefetch" href="/assets/js/104.205aa3c0.js"><link rel="prefetch" href="/assets/js/105.dce8fdd7.js"><link rel="prefetch" href="/assets/js/106.23c978cd.js"><link rel="prefetch" href="/assets/js/107.55204f3a.js"><link rel="prefetch" href="/assets/js/108.833c0494.js"><link rel="prefetch" href="/assets/js/109.45cb8f96.js"><link rel="prefetch" href="/assets/js/11.5ccd73c1.js"><link rel="prefetch" href="/assets/js/110.74ffcbd4.js"><link rel="prefetch" href="/assets/js/111.e4d40f97.js"><link rel="prefetch" href="/assets/js/112.32fddec7.js"><link rel="prefetch" href="/assets/js/113.85a8afe3.js"><link rel="prefetch" href="/assets/js/114.980d5971.js"><link rel="prefetch" href="/assets/js/115.e17d9d17.js"><link rel="prefetch" href="/assets/js/116.4291aaa1.js"><link rel="prefetch" href="/assets/js/117.361a18f7.js"><link rel="prefetch" href="/assets/js/118.080ae515.js"><link rel="prefetch" href="/assets/js/119.4c74f273.js"><link rel="prefetch" href="/assets/js/12.0917bcfd.js"><link rel="prefetch" href="/assets/js/120.2a9148bd.js"><link rel="prefetch" href="/assets/js/121.efbc8f99.js"><link rel="prefetch" href="/assets/js/122.bf801322.js"><link rel="prefetch" href="/assets/js/123.0bdf6223.js"><link rel="prefetch" href="/assets/js/124.65759c8e.js"><link rel="prefetch" href="/assets/js/125.79c6590c.js"><link rel="prefetch" href="/assets/js/126.aebbe4b6.js"><link rel="prefetch" href="/assets/js/127.6158fdc9.js"><link rel="prefetch" href="/assets/js/128.22ef1ffc.js"><link rel="prefetch" href="/assets/js/129.a2c947b9.js"><link rel="prefetch" href="/assets/js/13.79991dac.js"><link rel="prefetch" href="/assets/js/130.098882eb.js"><link rel="prefetch" href="/assets/js/131.c111a39f.js"><link rel="prefetch" href="/assets/js/132.f5a5afa6.js"><link rel="prefetch" href="/assets/js/133.74b29371.js"><link rel="prefetch" href="/assets/js/134.d003ed07.js"><link rel="prefetch" href="/assets/js/135.3e6301b4.js"><link rel="prefetch" href="/assets/js/136.69d67f46.js"><link rel="prefetch" href="/assets/js/137.e6cefd7f.js"><link rel="prefetch" href="/assets/js/138.3a57ea7f.js"><link rel="prefetch" href="/assets/js/139.297f14fa.js"><link rel="prefetch" href="/assets/js/14.518f2c21.js"><link rel="prefetch" href="/assets/js/140.b5ab78db.js"><link rel="prefetch" href="/assets/js/141.d6be93b9.js"><link rel="prefetch" href="/assets/js/142.b4c50deb.js"><link rel="prefetch" href="/assets/js/143.3a2aa3a6.js"><link rel="prefetch" href="/assets/js/144.18a94f62.js"><link rel="prefetch" href="/assets/js/145.f4bae853.js"><link rel="prefetch" href="/assets/js/146.42f6b2d9.js"><link rel="prefetch" href="/assets/js/147.bc48b0d9.js"><link rel="prefetch" href="/assets/js/148.6272922d.js"><link rel="prefetch" href="/assets/js/149.a6a91069.js"><link rel="prefetch" href="/assets/js/15.9b744db5.js"><link rel="prefetch" href="/assets/js/150.95bfe2fc.js"><link rel="prefetch" href="/assets/js/151.de058615.js"><link rel="prefetch" href="/assets/js/152.a0d8927a.js"><link rel="prefetch" href="/assets/js/153.9b3f1ca8.js"><link rel="prefetch" href="/assets/js/154.9705df4f.js"><link rel="prefetch" href="/assets/js/155.47f014c9.js"><link rel="prefetch" href="/assets/js/156.d6c316ce.js"><link rel="prefetch" href="/assets/js/157.5f351759.js"><link rel="prefetch" href="/assets/js/158.7af904b7.js"><link rel="prefetch" href="/assets/js/159.f11c56f2.js"><link rel="prefetch" href="/assets/js/16.1c5cfeed.js"><link rel="prefetch" href="/assets/js/160.532fa016.js"><link rel="prefetch" href="/assets/js/161.3ef3d7f7.js"><link rel="prefetch" href="/assets/js/162.d7e2766d.js"><link rel="prefetch" href="/assets/js/163.eb05962f.js"><link rel="prefetch" href="/assets/js/164.97f15acd.js"><link rel="prefetch" href="/assets/js/165.d6bc911a.js"><link rel="prefetch" href="/assets/js/166.a9025716.js"><link rel="prefetch" href="/assets/js/167.712b38b9.js"><link rel="prefetch" href="/assets/js/168.5e5fbd12.js"><link rel="prefetch" href="/assets/js/169.c4328328.js"><link rel="prefetch" href="/assets/js/17.3dde341d.js"><link rel="prefetch" href="/assets/js/170.49131b04.js"><link rel="prefetch" href="/assets/js/18.c31129da.js"><link rel="prefetch" href="/assets/js/19.ea3286eb.js"><link rel="prefetch" href="/assets/js/2.dfff5e2b.js"><link rel="prefetch" href="/assets/js/20.99813f4c.js"><link rel="prefetch" href="/assets/js/21.b4c74136.js"><link rel="prefetch" href="/assets/js/22.15865a0e.js"><link rel="prefetch" href="/assets/js/23.3cf67982.js"><link rel="prefetch" href="/assets/js/24.9049d940.js"><link rel="prefetch" href="/assets/js/25.053352a3.js"><link rel="prefetch" href="/assets/js/26.8657d498.js"><link rel="prefetch" href="/assets/js/27.935a3bea.js"><link rel="prefetch" href="/assets/js/28.9756ca4d.js"><link rel="prefetch" href="/assets/js/30.b6e5c164.js"><link rel="prefetch" href="/assets/js/31.24310373.js"><link rel="prefetch" href="/assets/js/32.9c266caa.js"><link rel="prefetch" href="/assets/js/33.21f85fa9.js"><link rel="prefetch" href="/assets/js/34.b68ed29e.js"><link rel="prefetch" href="/assets/js/35.4225e8c7.js"><link rel="prefetch" href="/assets/js/36.750893dd.js"><link rel="prefetch" href="/assets/js/38.f41decf8.js"><link rel="prefetch" href="/assets/js/39.be1dc675.js"><link rel="prefetch" href="/assets/js/4.3effffa5.js"><link rel="prefetch" href="/assets/js/40.801a9633.js"><link rel="prefetch" href="/assets/js/41.2e5e1b8e.js"><link rel="prefetch" href="/assets/js/42.108017ef.js"><link rel="prefetch" href="/assets/js/43.3fd17956.js"><link rel="prefetch" href="/assets/js/44.e837fd24.js"><link rel="prefetch" href="/assets/js/45.7147eeef.js"><link rel="prefetch" href="/assets/js/46.b60e8e7b.js"><link rel="prefetch" href="/assets/js/47.cdfd9177.js"><link rel="prefetch" href="/assets/js/48.926444e6.js"><link rel="prefetch" href="/assets/js/49.c1138007.js"><link rel="prefetch" href="/assets/js/5.98e793fe.js"><link rel="prefetch" href="/assets/js/50.3b6b1e12.js"><link rel="prefetch" href="/assets/js/51.0b29cea5.js"><link rel="prefetch" href="/assets/js/52.f23a8e3d.js"><link rel="prefetch" href="/assets/js/53.1480c3a5.js"><link rel="prefetch" href="/assets/js/54.a82366ee.js"><link rel="prefetch" href="/assets/js/55.77152d87.js"><link rel="prefetch" href="/assets/js/56.f5267add.js"><link rel="prefetch" href="/assets/js/57.a07016cf.js"><link rel="prefetch" href="/assets/js/58.1ff6af32.js"><link rel="prefetch" href="/assets/js/59.d2f8ba39.js"><link rel="prefetch" href="/assets/js/6.9936493c.js"><link rel="prefetch" href="/assets/js/60.0e7c7f9d.js"><link rel="prefetch" href="/assets/js/61.e38dd8f4.js"><link rel="prefetch" href="/assets/js/62.095adc15.js"><link rel="prefetch" href="/assets/js/63.6217b44f.js"><link rel="prefetch" href="/assets/js/64.442d48b7.js"><link rel="prefetch" href="/assets/js/65.7897685f.js"><link rel="prefetch" href="/assets/js/66.cd4097ab.js"><link rel="prefetch" href="/assets/js/67.2bd562eb.js"><link rel="prefetch" href="/assets/js/68.c8df2193.js"><link rel="prefetch" href="/assets/js/69.643fb43e.js"><link rel="prefetch" href="/assets/js/7.24c4aade.js"><link rel="prefetch" href="/assets/js/70.033c18af.js"><link rel="prefetch" href="/assets/js/71.05c89619.js"><link rel="prefetch" href="/assets/js/72.6ef87545.js"><link rel="prefetch" href="/assets/js/73.e39a774c.js"><link rel="prefetch" href="/assets/js/74.c1bfcdf1.js"><link rel="prefetch" href="/assets/js/75.33202a43.js"><link rel="prefetch" href="/assets/js/76.88201cef.js"><link rel="prefetch" href="/assets/js/77.7937d441.js"><link rel="prefetch" href="/assets/js/78.77f6a2e9.js"><link rel="prefetch" href="/assets/js/79.17bbd721.js"><link rel="prefetch" href="/assets/js/8.26359142.js"><link rel="prefetch" href="/assets/js/80.47d9c4fd.js"><link rel="prefetch" href="/assets/js/81.072a3979.js"><link rel="prefetch" href="/assets/js/82.3259ebfd.js"><link rel="prefetch" href="/assets/js/83.270310b5.js"><link rel="prefetch" href="/assets/js/84.590eb4d5.js"><link rel="prefetch" href="/assets/js/85.80a90e65.js"><link rel="prefetch" href="/assets/js/86.0fb1c1e8.js"><link rel="prefetch" href="/assets/js/87.180d1a07.js"><link rel="prefetch" href="/assets/js/88.430a1b80.js"><link rel="prefetch" href="/assets/js/89.d0f5629b.js"><link rel="prefetch" href="/assets/js/9.e80c6815.js"><link rel="prefetch" href="/assets/js/90.34aad011.js"><link rel="prefetch" href="/assets/js/91.99bfa2df.js"><link rel="prefetch" href="/assets/js/92.8ce25845.js"><link rel="prefetch" href="/assets/js/93.00cb9e82.js"><link rel="prefetch" href="/assets/js/94.ddf4a775.js"><link rel="prefetch" href="/assets/js/95.57d199b1.js"><link rel="prefetch" href="/assets/js/96.a7997eb8.js"><link rel="prefetch" href="/assets/js/97.a3cb5d37.js"><link rel="prefetch" href="/assets/js/98.caad23c5.js"><link rel="prefetch" href="/assets/js/99.3704a8c0.js">
    <link rel="stylesheet" href="/assets/css/0.styles.0235893d.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu have-body-img"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="Arkrypto" class="logo"> <span class="site-name can-hide">Arkrypto</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/cs/" class="nav-link">计算机科学与技术</a></div><div class="nav-item"><a href="/dev/" class="nav-link">开发与运维</a></div><div class="nav-item"><a href="/sec/" class="nav-link">网络与信息安全</a></div><div class="nav-item"><a href="/mine/" class="nav-link">我的</a></div><div class="nav-item"><a href="/archives/" class="nav-link">归档</a></div> <a href="https://github.com/Arkrypto" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/img/avatar.png"> <div class="blogger-info"><h3>Arkrypto</h3> <span>就在坚冰还盖着北海的时候，我看到了怒放的梅花</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/cs/" class="nav-link">计算机科学与技术</a></div><div class="nav-item"><a href="/dev/" class="nav-link">开发与运维</a></div><div class="nav-item"><a href="/sec/" class="nav-link">网络与信息安全</a></div><div class="nav-item"><a href="/mine/" class="nav-link">我的</a></div><div class="nav-item"><a href="/archives/" class="nav-link">归档</a></div> <a href="https://github.com/Arkrypto" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据结构与算法</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>组成原理</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>组成原理基础</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/8e621c/" class="sidebar-link">组成原理概述和总线系统</a></li><li><a href="/pages/10e829/" class="sidebar-link">主存储器</a></li><li><a href="/pages/8a084c/" class="sidebar-link">输入输出系统</a></li><li><a href="/pages/533409/" class="sidebar-link">数值系统</a></li><li><a href="/pages/5e414d/" class="sidebar-link">指令系统</a></li><li><a href="/pages/2e3aff/" class="sidebar-link">CPU 系统</a></li><li><a href="/pages/c12c8a/" aria-current="page" class="active sidebar-link">集成电路设计基础</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/c12c8a/#vivado-基础" class="sidebar-link">Vivado 基础</a></li><li class="sidebar-sub-header level2"><a href="/pages/c12c8a/#组合逻辑电路" class="sidebar-link">组合逻辑电路</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/c12c8a/#编码器" class="sidebar-link">编码器</a></li><li class="sidebar-sub-header level3"><a href="/pages/c12c8a/#解码器" class="sidebar-link">解码器</a></li><li class="sidebar-sub-header level3"><a href="/pages/c12c8a/#选择器" class="sidebar-link">选择器</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/c12c8a/#时序逻辑电路" class="sidebar-link">时序逻辑电路</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/c12c8a/#d-触发器" class="sidebar-link">D 触发器</a></li><li class="sidebar-sub-header level3"><a href="/pages/c12c8a/#带同步复位信号的-dff" class="sidebar-link">带同步复位信号的 dff</a></li><li class="sidebar-sub-header level3"><a href="/pages/c12c8a/#带异步复位信号的-dff" class="sidebar-link">带异步复位信号的 dff</a></li><li class="sidebar-sub-header level3"><a href="/pages/c12c8a/#带使能端的-dff" class="sidebar-link">带使能端的 dff</a></li><li class="sidebar-sub-header level3"><a href="/pages/c12c8a/#_32-位除法器" class="sidebar-link">32 位除法器</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/c12c8a/#寄存器设计" class="sidebar-link">寄存器设计</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/c12c8a/#程序计数器-pc" class="sidebar-link">程序计数器 pc</a></li><li class="sidebar-sub-header level3"><a href="/pages/c12c8a/#宏定义" class="sidebar-link">宏定义</a></li><li class="sidebar-sub-header level3"><a href="/pages/c12c8a/#mips-寄存器堆-regfile" class="sidebar-link">MIPS 寄存器堆 regfile</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/c12c8a/#指令存-取" class="sidebar-link">指令存 / 取</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/c12c8a/#指令存储器-inst-rom" class="sidebar-link">指令存储器 inst_rom</a></li><li class="sidebar-sub-header level3"><a href="/pages/c12c8a/#取值模块-inst-fetch" class="sidebar-link">取值模块 inst_fetch</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/c12c8a/#译码器与运算器" class="sidebar-link">译码器与运算器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/c12c8a/#译码器-id" class="sidebar-link">译码器 ID</a></li><li class="sidebar-sub-header level3"><a href="/pages/c12c8a/#运算器-alu" class="sidebar-link">运算器 ALU</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/c12c8a/#单周期-cpu" class="sidebar-link">单周期 CPU</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/c12c8a/#single-cycle-cpu" class="sidebar-link">singlecyclecpu</a></li><li class="sidebar-sub-header level3"><a href="/pages/c12c8a/#sopc" class="sidebar-link">SOPC</a></li></ul></li></ul></li><li><a href="/pages/566a23/" class="sidebar-link">五级流水 CPU 设计与实现</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>电子技术基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>计算机体系结构及接口</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>计网与操作系统</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06970110><div class="articleInfo" data-v-06970110><ul class="breadcrumbs" data-v-06970110><li data-v-06970110><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06970110></a></li> <li data-v-06970110><a href="/cs/#计算机科学与技术" data-v-06970110>计算机科学与技术</a></li><li data-v-06970110><a href="/cs/#组成原理" data-v-06970110>组成原理</a></li><li data-v-06970110><a href="/cs/#组成原理基础" data-v-06970110>组成原理基础</a></li></ul> <div class="info" data-v-06970110><div title="作者" class="author iconfont icon-touxiang" data-v-06970110><a href="https://github.com/Arkrypto" target="_blank" title="作者" class="beLink" data-v-06970110>Arkrypto</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06970110><a href="javascript:;" data-v-06970110>2022-12-29</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">集成电路设计基础<!----></h1> <!----> <div class="theme-vdoing-content content__default"><p>IC（Integrated Circuit），集成电路，芯片</p> <p>常用工具和语言</p> <ul><li>编程语言：C/C++（用于单片机），Verilog / VHDL（用于 FPGA）</li> <li>工具链：Keil、IAR、Vivado、Quartus、ST-Link、JTAG调试器等</li></ul> <h2 id="vivado-基础"><a href="#vivado-基础" class="header-anchor">#</a> Vivado 基础</h2> <p>1️⃣ 安装</p> <p><a href="https://www.xilinx.com/support/download.html" target="_blank" rel="nofollow noopener noreferrer">Downloads (xilinx.com)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>官网下载安装包，需要登陆注册 AMD 账号（密码要求大小写、特殊字符以及数字）</p> <p>这里老师强烈推荐版本 2019.2，不知为何，下载安装包后双击安装包运行</p> <p>一路 continue / next，途中需要输入一次 AMD 账号，选择产品时勾选 VIVADO，Devices 默认即可，安装路径可自定义</p> <p>总共大小二十多 GB，约需下载安装两个多小时</p> <p>2️⃣ 新建项目</p> <p>新建项目或打开项目（.xpr 文件）</p> <p>新建文件</p> <ul><li>设计代码</li> <li>测试代码</li></ul> <p>仿真：将需要仿真的测试代码 set as top 后 Run Simulation</p> <p>仿真设置：设置仿真时间和 log_all_signals</p> <p>停止仿真：右键 Run Simulation 或叉掉正上方 Simulation 的提示框停止仿真</p> <h2 id="组合逻辑电路"><a href="#组合逻辑电路" class="header-anchor">#</a> 组合逻辑电路</h2> <h3 id="编码器"><a href="#编码器" class="header-anchor">#</a> 编码器</h3> <p>将输入的二进制数编为独热码，如 38 编码器，将<code>000</code>编码为<code>00000001</code>，<code>001</code>编为<code>00000010</code>，<code>011</code>编为<code>00001000</code>，<code>111</code>编为<code>10000000</code></p> <img src="/assets/img/38.9df796fd.png"> <img src="/assets/img/38table.afdc8b9b.png"> <p>decoder_3_8</p> <div class="language-verilog line-numbers-mode"><pre class="language-verilog"><code><span class="token comment">// 时间精度 timescale</span>
<span class="token constant">`timescale</span> <span class="token number">1</span>ns <span class="token operator">/</span> <span class="token number">1</span>ps

<span class="token keyword">module</span> <span class="token function">decoder_3_8</span><span class="token punctuation">(</span>
    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> in<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> out
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 定义输入输出关系</span>
    <span class="token keyword">assign</span> out<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>in<span class="token operator">==</span><span class="token number">3'd0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> out<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>in<span class="token operator">==</span><span class="token number">3'd1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> out<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>in<span class="token operator">==</span><span class="token number">3'd2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> out<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>in<span class="token operator">==</span><span class="token number">3'd3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> out<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>in<span class="token operator">==</span><span class="token number">3'd4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> out<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>in<span class="token operator">==</span><span class="token number">3'd5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> out<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>in<span class="token operator">==</span><span class="token number">3'd6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> out<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>in<span class="token operator">==</span><span class="token number">3'd7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">endmodule</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>decoder_5_32</p> <div class="language-verilog line-numbers-mode"><pre class="language-verilog"><code><span class="token constant">`timescale</span> <span class="token number">1</span>ns <span class="token operator">/</span> <span class="token number">1</span>ps

<span class="token keyword">module</span> <span class="token function">decoder_5_32</span><span class="token punctuation">(</span>
    <span class="token keyword">input</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> in<span class="token punctuation">,</span>
    <span class="token keyword">output</span><span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> out
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> out<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>in<span class="token operator">==</span><span class="token number">5'd0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> out<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>in<span class="token operator">==</span><span class="token number">5'd1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> out<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>in<span class="token operator">==</span><span class="token number">5'd2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> out<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>in<span class="token operator">==</span><span class="token number">5'd3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> out<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>in<span class="token operator">==</span><span class="token number">5'd4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> out<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>in<span class="token operator">==</span><span class="token number">5'd5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> out<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>in<span class="token operator">==</span><span class="token number">5'd6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> out<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>in<span class="token operator">==</span><span class="token number">5'd7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> out<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>in<span class="token operator">==</span><span class="token number">5'd8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> out<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>in<span class="token operator">==</span><span class="token number">5'd9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> out<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>in<span class="token operator">==</span><span class="token number">5'd10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> out<span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>in<span class="token operator">==</span><span class="token number">5'd11</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> out<span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>in<span class="token operator">==</span><span class="token number">5'd12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> out<span class="token punctuation">[</span><span class="token number">13</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>in<span class="token operator">==</span><span class="token number">5'd13</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> out<span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>in<span class="token operator">==</span><span class="token number">5'd14</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> out<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>in<span class="token operator">==</span><span class="token number">5'd15</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> out<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>in<span class="token operator">==</span><span class="token number">5'd16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> out<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>in<span class="token operator">==</span><span class="token number">5'd17</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> out<span class="token punctuation">[</span><span class="token number">18</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>in<span class="token operator">==</span><span class="token number">5'd18</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> out<span class="token punctuation">[</span><span class="token number">19</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>in<span class="token operator">==</span><span class="token number">5'd19</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> out<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>in<span class="token operator">==</span><span class="token number">5'd20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> out<span class="token punctuation">[</span><span class="token number">21</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>in<span class="token operator">==</span><span class="token number">5'd21</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> out<span class="token punctuation">[</span><span class="token number">22</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>in<span class="token operator">==</span><span class="token number">5'd22</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> out<span class="token punctuation">[</span><span class="token number">23</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>in<span class="token operator">==</span><span class="token number">5'd23</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> out<span class="token punctuation">[</span><span class="token number">24</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>in<span class="token operator">==</span><span class="token number">5'd24</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> out<span class="token punctuation">[</span><span class="token number">25</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>in<span class="token operator">==</span><span class="token number">5'd25</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> out<span class="token punctuation">[</span><span class="token number">26</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>in<span class="token operator">==</span><span class="token number">5'd26</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> out<span class="token punctuation">[</span><span class="token number">27</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>in<span class="token operator">==</span><span class="token number">5'd27</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> out<span class="token punctuation">[</span><span class="token number">28</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>in<span class="token operator">==</span><span class="token number">5'd28</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> out<span class="token punctuation">[</span><span class="token number">29</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>in<span class="token operator">==</span><span class="token number">5'd29</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> out<span class="token punctuation">[</span><span class="token number">30</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>in<span class="token operator">==</span><span class="token number">5'd30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> out<span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>in<span class="token operator">==</span><span class="token number">5'd31</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">endmodule</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><h3 id="解码器"><a href="#解码器" class="header-anchor">#</a> 解码器</h3> <p>编码器的反向操作，将独热码解为一个个对应数字，如<code>10000000</code>解为<code>111</code></p> <ul><li>三目运算符，优先级逐级下降，若<code>in[i] == 1</code>则<code>out = 3'di</code></li> <li><code>3'd1</code>表示 3 位的十进制数 1</li> <li><code>3'b010</code>表示 3 位二进制数 010，也就是十进制 2</li></ul> <div class="language-verilog line-numbers-mode"><pre class="language-verilog"><code><span class="token constant">`timescale</span> <span class="token number">1</span>ns <span class="token operator">/</span> <span class="token number">1</span>ps

<span class="token keyword">module</span> <span class="token function">encoder_8_3</span><span class="token punctuation">(</span>
    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> in<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> out
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">assign</span> out <span class="token operator">=</span> in<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">?</span><span class="token number">3'd0</span><span class="token punctuation">:</span>
             in<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">?</span><span class="token number">3'd1</span><span class="token punctuation">:</span>
             in<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">?</span><span class="token number">3'd2</span><span class="token punctuation">:</span>
             in<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">?</span><span class="token number">3'd3</span><span class="token punctuation">:</span>
             in<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token operator">?</span><span class="token number">3'd4</span><span class="token punctuation">:</span>
             in<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token operator">?</span><span class="token number">3'd5</span><span class="token punctuation">:</span>
             in<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token operator">?</span><span class="token number">3'd6</span><span class="token punctuation">:</span>
             <span class="token number">3'd7</span><span class="token punctuation">;</span>
<span class="token keyword">endmodule</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="选择器"><a href="#选择器" class="header-anchor">#</a> 选择器</h3> <p>五路选择器：根据输入信号<code>select</code>在输入信号<code>in0,in1,in2,in3,in4</code>中选择一个作为输出</p> <ul><li><code>sel == 000</code>则选择<code>in0</code>，<code>sel == 001</code>则选择<code>in1</code></li></ul> <div class="language-verilog line-numbers-mode"><pre class="language-verilog"><code><span class="token constant">`timescale</span> <span class="token number">1</span>ns <span class="token operator">/</span> <span class="token number">1</span>ps

<span class="token keyword">module</span> <span class="token function">mux5_8a</span><span class="token punctuation">(</span>
    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> in0 <span class="token punctuation">,</span> in1 <span class="token punctuation">,</span> in2 <span class="token punctuation">,</span> in3 <span class="token punctuation">,</span> in4 <span class="token punctuation">,</span>
    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> sel<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> out
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> out <span class="token operator">=</span> <span class="token punctuation">(</span>sel <span class="token operator">==</span> <span class="token number">3'd0</span><span class="token punctuation">)</span><span class="token operator">?</span>in0<span class="token punctuation">:</span><span class="token punctuation">(</span>sel <span class="token operator">==</span> <span class="token number">3'd1</span><span class="token punctuation">)</span><span class="token operator">?</span>in1<span class="token punctuation">:</span>
                 <span class="token punctuation">(</span>sel <span class="token operator">==</span> <span class="token number">3'd2</span><span class="token punctuation">)</span><span class="token operator">?</span>in2<span class="token punctuation">:</span><span class="token punctuation">(</span>sel <span class="token operator">==</span> <span class="token number">3'd3</span><span class="token punctuation">)</span><span class="token operator">?</span>in3<span class="token punctuation">:</span>
                 <span class="token punctuation">(</span>sel <span class="token operator">==</span> <span class="token number">3'd4</span><span class="token punctuation">)</span><span class="token operator">?</span>in4<span class="token punctuation">:</span><span class="token number">7'd0</span><span class="token punctuation">;</span>
<span class="token keyword">endmodule</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="时序逻辑电路"><a href="#时序逻辑电路" class="header-anchor">#</a> 时序逻辑电路</h2> <h3 id="d-触发器"><a href="#d-触发器" class="header-anchor">#</a> D 触发器</h3> <p>在时钟信号的上升沿触发，使输出等于输入，其余时刻均保持输出不变</p> <img src="data:image/jpeg;base64,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"> <p>使用 always 关键字捕捉时钟信号 clk 的上升沿 posedge（下降沿为 negedge）</p> <ul><li><code>&lt;=</code>为非阻塞赋值，在 always 中通常使用该种赋值方法，需要统一</li></ul> <div class="language-verilog line-numbers-mode"><pre class="language-verilog"><code><span class="token constant">`timescale</span> <span class="token number">1</span>ns <span class="token operator">/</span> <span class="token number">1</span>ps

<span class="token comment">// D 触发器（反相器）</span>
<span class="token keyword">module</span> <span class="token function">dff</span><span class="token punctuation">(</span>
    <span class="token keyword">input</span> <span class="token keyword">wire</span> d<span class="token punctuation">,</span>
    <span class="token keyword">input</span> <span class="token keyword">wire</span> clk<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token keyword">reg</span> q
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token important">always@</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk<span class="token punctuation">)</span><span class="token keyword">begin</span>
        q <span class="token operator">&lt;=</span> d<span class="token punctuation">;</span>
    <span class="token keyword">end</span>
<span class="token keyword">endmodule</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>测试代码</p> <ul><li>forever begin end：表示死循环执行</li> <li><code>#10</code> 表示延迟 10ns 执行</li> <li><code>$finish;</code> 调用内置函数结束本次仿真</li></ul> <div class="language-verilog line-numbers-mode"><pre class="language-verilog"><code><span class="token constant">`timescale</span> <span class="token number">1</span>ns <span class="token operator">/</span> <span class="token number">1</span>ps
<span class="token keyword">module</span> <span class="token function">dff_tb</span><span class="token punctuation">(</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">reg</span> clk<span class="token punctuation">;</span>
    <span class="token keyword">reg</span> d<span class="token punctuation">;</span>
    <span class="token keyword">wire</span> q<span class="token punctuation">;</span>
    dff <span class="token function">dff1</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">clk</span><span class="token punctuation">(</span>clk<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token function">q</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">initial</span> <span class="token keyword">begin</span>
        clk <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">forever</span> <span class="token keyword">begin</span>
            <span class="token number">#10</span> clk<span class="token operator">=~</span>clk<span class="token punctuation">;</span>
        <span class="token keyword">end</span>
    <span class="token keyword">end</span>
    <span class="token keyword">initial</span> <span class="token keyword">begin</span>
        d <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">forever</span> <span class="token keyword">begin</span>
            <span class="token number">#15</span> d<span class="token operator">=~</span>d<span class="token punctuation">;</span>
        <span class="token keyword">end</span>
    <span class="token keyword">end</span>
    <span class="token keyword">initial</span> <span class="token keyword">begin</span>
        <span class="token number">#200</span> <span class="token kernel-function property">$finish</span><span class="token punctuation">;</span>
    <span class="token keyword">end</span>
<span class="token keyword">endmodule</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h3 id="带同步复位信号的-dff"><a href="#带同步复位信号的-dff" class="header-anchor">#</a> 带同步复位信号的 dff</h3> <p>多一个输入：复位信号 rst，rst 为 0 时有效，复位信号有效时，D 触发器失效，输出始终为 0</p> <p>同步指复位信号 rst 的生效时刻和时钟信号同步，均在 clk 的上升沿进行判断并对输出赋值</p> <div class="language-verilog line-numbers-mode"><pre class="language-verilog"><code><span class="token constant">`timescale</span> <span class="token number">1</span>ns <span class="token operator">/</span> <span class="token number">1</span>ps
<span class="token keyword">module</span> <span class="token function">dffSyn</span><span class="token punctuation">(</span>
    <span class="token keyword">input</span> <span class="token keyword">wire</span> d<span class="token punctuation">,</span>
    <span class="token keyword">input</span> <span class="token keyword">wire</span> clk<span class="token punctuation">,</span>
    <span class="token keyword">input</span> <span class="token keyword">wire</span> reset<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token keyword">reg</span> q
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk<span class="token punctuation">)</span><span class="token keyword">begin</span>
        <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>reset<span class="token punctuation">)</span><span class="token keyword">begin</span> <span class="token comment">// 低电平生效，将输出置零</span>
            q<span class="token operator">&lt;=</span><span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">end</span>
        <span class="token keyword">else</span> <span class="token keyword">begin</span>
            q<span class="token operator">&lt;=</span>d<span class="token punctuation">;</span>
        <span class="token keyword">end</span>
    <span class="token keyword">end</span>
<span class="token keyword">endmodule</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>测试代码</p> <div class="language-verilog line-numbers-mode"><pre class="language-verilog"><code><span class="token constant">`timescale</span> <span class="token number">1</span>ns <span class="token operator">/</span> <span class="token number">1</span>ps
<span class="token keyword">module</span> <span class="token function">dffSyn_tb</span><span class="token punctuation">(</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">reg</span> clk<span class="token punctuation">;</span>
    <span class="token keyword">reg</span> d<span class="token punctuation">;</span>
    <span class="token keyword">reg</span> reset<span class="token punctuation">;</span>
    <span class="token keyword">wire</span> q<span class="token punctuation">;</span>
    dffSyn <span class="token function">dffSyn1</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">clk</span><span class="token punctuation">(</span>clk<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span>reset<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token function">q</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">initial</span> <span class="token keyword">begin</span>
        clk <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">forever</span> <span class="token keyword">begin</span>
            <span class="token number">#10</span> clk<span class="token operator">=~</span>clk<span class="token punctuation">;</span>
        <span class="token keyword">end</span>
    <span class="token keyword">end</span>
    <span class="token keyword">initial</span> <span class="token keyword">begin</span>
        d <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">forever</span> <span class="token keyword">begin</span>
            <span class="token number">#15</span> d<span class="token operator">=~</span>d<span class="token punctuation">;</span>
        <span class="token keyword">end</span>
    <span class="token keyword">end</span>
    <span class="token keyword">initial</span> <span class="token keyword">begin</span>
        reset <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token number">#5</span>
        reset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token number">#25</span>
        reset <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">end</span>
    <span class="token keyword">initial</span> <span class="token keyword">begin</span>
        <span class="token number">#200</span> <span class="token kernel-function property">$finish</span><span class="token punctuation">;</span>
    <span class="token keyword">end</span>
<span class="token keyword">endmodule</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><h3 id="带异步复位信号的-dff"><a href="#带异步复位信号的-dff" class="header-anchor">#</a> 带异步复位信号的 dff</h3> <p>复位信号工作在其自身的下降沿，即一旦 rst 从 1 变为 0，此时触发对输出 q 的赋值（赋值为 0）</p> <p>同时也工作在时钟信号 clk 的上升沿，rst 为 0 时 q 始终为 0，只有当 clk 的上升沿同时 rst = 1 时，输出 q 等于输入 d</p> <div class="language-verilog line-numbers-mode"><pre class="language-verilog"><code><span class="token constant">`timescale</span> <span class="token number">1</span>ns <span class="token operator">/</span> <span class="token number">1</span>ps
<span class="token keyword">module</span> <span class="token function">dffAsyn</span><span class="token punctuation">(</span>
    <span class="token keyword">input</span> <span class="token keyword">wire</span> d<span class="token punctuation">,</span>
    <span class="token keyword">input</span> <span class="token keyword">wire</span> clk<span class="token punctuation">,</span>
    <span class="token keyword">input</span> <span class="token keyword">wire</span> reset<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token keyword">reg</span> q
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk <span class="token keyword">or</span> <span class="token keyword">negedge</span> reset<span class="token punctuation">)</span><span class="token keyword">begin</span>
        <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>reset<span class="token punctuation">)</span><span class="token keyword">begin</span>
            q<span class="token operator">&lt;=</span><span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">end</span>
        <span class="token keyword">else</span> <span class="token keyword">begin</span>
            q<span class="token operator">&lt;=</span>d<span class="token punctuation">;</span>
        <span class="token keyword">end</span>
    <span class="token keyword">end</span>
<span class="token keyword">endmodule</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="带使能端的-dff"><a href="#带使能端的-dff" class="header-anchor">#</a> 带使能端的 dff</h3> <p>没有复位信号，但多了一个使能信号，只有当使能信号为 1（即使能时），D 触发器正常工作，否则不做处理</p> <div class="language-verilog line-numbers-mode"><pre class="language-verilog"><code><span class="token constant">`timescale</span> <span class="token number">1</span>ns <span class="token operator">/</span> <span class="token number">1</span>ps
<span class="token keyword">module</span> <span class="token function">dffEn</span><span class="token punctuation">(</span>
    <span class="token keyword">input</span> <span class="token keyword">wire</span> d<span class="token punctuation">,</span>
    <span class="token keyword">input</span> <span class="token keyword">wire</span> clk<span class="token punctuation">,</span>
    <span class="token keyword">input</span> <span class="token keyword">wire</span> en<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token keyword">reg</span> q
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk<span class="token punctuation">)</span><span class="token keyword">begin</span>
        <span class="token function">if</span><span class="token punctuation">(</span>en<span class="token punctuation">)</span><span class="token keyword">begin</span>
            q <span class="token operator">&lt;=</span> d<span class="token punctuation">;</span>
        <span class="token keyword">end</span>
     <span class="token keyword">end</span>
<span class="token keyword">endmodule</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="_32-位除法器"><a href="#_32-位除法器" class="header-anchor">#</a> 32 位除法器</h3> <img src="/assets/img/div.36833387.png"> <p>设计代码：div32.v</p> <ul><li>temp_a 为被除数的两倍扩展，为了合拍同理要把除数扩展</li> <li>temp_a 高 32 位存的余数，低 32 位存的商，运算过程如上图</li> <li>当 temp_a &gt;= temp_b 时，商 1，填补到 temp_a[0]，再整体左移一位，进行下一轮运算，当小于时，商 0 再左移</li></ul> <div class="language-verilog line-numbers-mode"><pre class="language-verilog"><code><span class="token constant">`timescale</span> <span class="token number">1</span>ns <span class="token operator">/</span> <span class="token number">1</span>ps

<span class="token keyword">module</span> <span class="token function">div32</span><span class="token punctuation">(</span>
    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> a<span class="token punctuation">,</span>
    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> b<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> result<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> remainder
    <span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token keyword">reg</span><span class="token punctuation">[</span><span class="token number">63</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> temp_a<span class="token punctuation">;</span>
    <span class="token keyword">reg</span><span class="token punctuation">[</span><span class="token number">63</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> temp_b<span class="token punctuation">;</span>
        
    <span class="token keyword">integer</span> i<span class="token punctuation">;</span>
    <span class="token important">always @</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">begin</span>
        temp_a <span class="token operator">=</span> <span class="token operator">{</span><span class="token number">32'd0</span><span class="token punctuation">,</span> a<span class="token operator">}</span><span class="token punctuation">;</span>
        temp_b <span class="token operator">=</span> <span class="token operator">{</span>b<span class="token punctuation">,</span> <span class="token number">32'd0</span><span class="token operator">}</span><span class="token punctuation">;</span>
        <span class="token function">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">32</span><span class="token punctuation">;</span> i <span class="token operator">=</span> i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">begin</span>
            temp_a <span class="token operator">=</span> temp_a <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token function">if</span><span class="token punctuation">(</span>temp_a <span class="token operator">&gt;=</span> temp_b<span class="token punctuation">)</span> <span class="token keyword">begin</span>
                temp_a <span class="token operator">=</span> temp_a <span class="token operator">-</span> temp_b <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token keyword">end</span>
        <span class="token keyword">end</span>
    <span class="token keyword">end</span>
    <span class="token keyword">assign</span> result <span class="token operator">=</span> temp_a<span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> remainder <span class="token operator">=</span> temp_a<span class="token punctuation">[</span><span class="token number">63</span><span class="token punctuation">:</span><span class="token number">32</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">endmodule</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>测试代码：div32_tb.v</p> <div class="language-verilog line-numbers-mode"><pre class="language-verilog"><code><span class="token constant">`timescale</span> <span class="token number">1</span>ns <span class="token operator">/</span> <span class="token number">1</span>ps

<span class="token keyword">module</span> <span class="token function">div32_tb</span><span class="token punctuation">(</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> a<span class="token punctuation">;</span>
    <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> b<span class="token punctuation">;</span>
    <span class="token keyword">wire</span> <span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> result<span class="token punctuation">;</span>
    <span class="token keyword">wire</span> <span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> remainder<span class="token punctuation">;</span>
    
    div32 <span class="token function">div320</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> result<span class="token punctuation">,</span> remainder<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">integer</span> i<span class="token punctuation">;</span>
    <span class="token keyword">initial</span> <span class="token keyword">begin</span>
        b <span class="token operator">=</span> <span class="token number">32'd7</span><span class="token punctuation">;</span>
        <span class="token function">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">102</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">152</span><span class="token punctuation">;</span> i <span class="token operator">=</span> i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">begin</span>
            <span class="token number">#20</span>
            a <span class="token operator">=</span> i<span class="token punctuation">;</span>
        <span class="token keyword">end</span>
        <span class="token number">#1000</span> <span class="token kernel-function property">$finish</span><span class="token punctuation">;</span>
    <span class="token keyword">end</span>
<span class="token keyword">endmodule</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h2 id="寄存器设计"><a href="#寄存器设计" class="header-anchor">#</a> 寄存器设计</h2> <h3 id="程序计数器-pc"><a href="#程序计数器-pc" class="header-anchor">#</a> 程序计数器 pc</h3> <p>就是一个指向指令地址的指针，</p> <img src="data:image/png;base64,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"> <table><thead><tr><th>序号</th> <th>接口名</th> <th>宽度（bit）</th> <th>输入/输出</th> <th>作用</th></tr></thead> <tbody><tr><td>1</td> <td>rst</td> <td>1</td> <td>输入</td> <td>复位信号</td></tr> <tr><td>2</td> <td>clk</td> <td>1</td> <td>输入</td> <td>时钟信号</td></tr> <tr><td>3</td> <td>pc</td> <td>32</td> <td>输出</td> <td>要读取的指令地址</td></tr> <tr><td>4</td> <td>ce</td> <td>1</td> <td>输出</td> <td>指令存储器使能信号</td></tr></tbody></table> <p>根据时钟信号复位信号<strong>输出当前指令的地址以及使能信号</strong>，将送往取值模块作为取值模块的输入，取值模块根据这个指令地址将指令和使能信号取出指令，作为取值模块的输出</p> <div class="language-verilog line-numbers-mode"><pre class="language-verilog"><code><span class="token constant">`timescale</span> <span class="token number">1</span>ns <span class="token operator">/</span> <span class="token number">1</span>ps

<span class="token keyword">module</span> <span class="token function">pc</span><span class="token punctuation">(</span>
    <span class="token keyword">input</span> <span class="token keyword">wire</span> clk<span class="token punctuation">,</span> <span class="token comment">// 时钟信号</span>
    <span class="token keyword">input</span> <span class="token keyword">wire</span> rst<span class="token punctuation">,</span> <span class="token comment">// 复位信号</span>
    <span class="token keyword">output</span> <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> pc<span class="token punctuation">,</span> <span class="token comment">// 要读的指令地址</span>
    <span class="token keyword">output</span> <span class="token keyword">reg</span> ce <span class="token comment">// 使能信号</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token important">always@</span> <span class="token punctuation">(</span><span class="token keyword">posedge</span> clk<span class="token punctuation">)</span> <span class="token keyword">begin</span>
        <span class="token function">if</span><span class="token punctuation">(</span>rst <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token keyword">begin</span>
            ce <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">end</span> <span class="token keyword">else</span> <span class="token keyword">begin</span>
            ce <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">end</span>
    <span class="token keyword">end</span>
    
    <span class="token comment">// 只有当复位信号无效时，使能信号有效，才给地址赋值，否则为 0</span>
    <span class="token important">always@</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk<span class="token punctuation">)</span><span class="token keyword">begin</span>
        <span class="token function">if</span><span class="token punctuation">(</span>ce <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token keyword">begin</span>
            pc <span class="token operator">&lt;=</span> <span class="token number">32'b0</span><span class="token punctuation">;</span>
        <span class="token keyword">end</span> <span class="token keyword">else</span> <span class="token keyword">begin</span> 
            pc <span class="token operator">&lt;=</span> pc <span class="token operator">+</span> <span class="token number">4</span><span class="token punctuation">;</span>
        <span class="token keyword">end</span>
    <span class="token keyword">end</span>
<span class="token keyword">endmodule</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h3 id="宏定义"><a href="#宏定义" class="header-anchor">#</a> 宏定义</h3> <p>宏定义：提高代码可读性</p> <ul><li>定义变量：``define a 31:0`</li> <li>引用文件：``include &quot;./defines.v&quot;`</li></ul> <p>defines.v</p> <div class="language-verilog line-numbers-mode"><pre class="language-verilog"><code><span class="token comment">// 寄存器读写</span>
<span class="token constant">`define</span> RegAddrBus <span class="token number">4</span><span class="token punctuation">:</span><span class="token number">0</span>
<span class="token constant">`define</span> RegDataBus <span class="token number">31</span><span class="token punctuation">:</span><span class="token number">0</span>
<span class="token constant">`define</span> RegNum <span class="token number">31</span><span class="token punctuation">:</span><span class="token number">0</span>
<span class="token constant">`define</span> RstDisable <span class="token number">0</span>
<span class="token constant">`define</span> RstEnable <span class="token number">1</span>
<span class="token constant">`define</span> ZeroWord <span class="token number">32'h0</span>

<span class="token constant">`define</span> ReadEnable <span class="token number">1</span>
<span class="token constant">`define</span> ReadDisable <span class="token number">0</span>
<span class="token constant">`define</span> WriteEnable <span class="token number">1</span>
<span class="token constant">`define</span> WriteDisable <span class="token number">0</span>

<span class="token comment">// 取值模块 inst 地址线长度和使能信号</span>
<span class="token constant">`define</span> InstAddrBus <span class="token number">31</span><span class="token punctuation">:</span><span class="token number">0</span>
<span class="token constant">`define</span> InstBus <span class="token number">31</span><span class="token punctuation">:</span><span class="token number">0</span>
<span class="token constant">`define</span> CeDisable <span class="token number">0</span>

<span class="token constant">`define</span> ZeroRegAddr <span class="token number">5'd0</span>

<span class="token comment">// 指令 5:0 编号</span>
<span class="token constant">`define</span> FuncAdd  <span class="token number">6'b100000</span>
<span class="token constant">`define</span> FuncAddu <span class="token number">6'b100001</span>
<span class="token constant">`define</span> FuncSub  <span class="token number">6'b100010</span>
<span class="token constant">`define</span> FuncSubu <span class="token number">6'b100011</span>
<span class="token constant">`define</span> FuncSlt  <span class="token number">6'b101010</span>
<span class="token constant">`define</span> FuncSltu <span class="token number">6'b101011</span>
<span class="token constant">`define</span> FuncAnd  <span class="token number">6'b100100</span>
<span class="token constant">`define</span> FuncOr   <span class="token number">6'b100101</span>
<span class="token constant">`define</span> FuncXor  <span class="token number">6'b100110</span>
<span class="token constant">`define</span> FuncNor  <span class="token number">6'b100111</span>
<span class="token constant">`define</span> FuncZero <span class="token number">6'b000000</span>
<span class="token constant">`define</span> FuncSll  <span class="token number">6'b000000</span>
<span class="token constant">`define</span> FuncSrl  <span class="token number">6'b000010</span>
<span class="token constant">`define</span> FuncSra  <span class="token number">6'b000011</span>
<span class="token comment">// 算数、逻辑运算</span>
<span class="token constant">`define</span> OpZero   <span class="token number">6'b000000</span>
<span class="token constant">`define</span> Op1Zero  <span class="token number">5'b00000</span>
<span class="token constant">`define</span> SaZero   <span class="token number">5'b00000</span>
<span class="token constant">`define</span> OpLui    <span class="token number">6'b001111</span>

<span class="token comment">// 操作符地址长度</span>
<span class="token constant">`define</span> Aluop_OnehotBus <span class="token number">13</span><span class="token punctuation">:</span><span class="token number">0</span>
<span class="token comment">// 译码结果，操作符</span>
<span class="token constant">`define</span> AluopAdd  <span class="token number">14'b10_0000_0000_0000</span>
<span class="token constant">`define</span> AluopAddu <span class="token number">14'b01_0000_0000_0000</span>
<span class="token constant">`define</span> AluopSub  <span class="token number">14'b00_1000_0000_0000</span>
<span class="token constant">`define</span> AluopSubu <span class="token number">14'b00_0100_0000_0000</span>
<span class="token constant">`define</span> AluopSlt  <span class="token number">14'b00_0010_0000_0000</span>
<span class="token constant">`define</span> AluopSltu <span class="token number">14'b00_0001_0000_0000</span>
<span class="token constant">`define</span> AluopAnd  <span class="token number">14'b00_0000_1000_0000</span>
<span class="token constant">`define</span> AluopOr   <span class="token number">14'b00_0000_0100_0000</span>
<span class="token constant">`define</span> AluopXor  <span class="token number">14'b00_0000_0010_0000</span>
<span class="token constant">`define</span> AluopNor  <span class="token number">14'b00_0000_0001_0000</span>
<span class="token constant">`define</span> AluopSll  <span class="token number">14'b00_0000_0000_1000</span>
<span class="token constant">`define</span> AluopSrl  <span class="token number">14'b00_0000_0000_0100</span>
<span class="token constant">`define</span> AluopSra  <span class="token number">14'b00_0000_0000_0010</span>
<span class="token constant">`define</span> AluopLui  <span class="token number">14'b00_0000_0000_0001</span>
<span class="token constant">`define</span> AluopZero <span class="token number">14'b00_0000_0000_0000</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br></div></div><h3 id="mips-寄存器堆-regfile"><a href="#mips-寄存器堆-regfile" class="header-anchor">#</a> MIPS 寄存器堆 regfile</h3> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAVkAAAFlCAYAAABBSpsNAAAgAElEQVR4nO3db0xb1+E+8Kc/dcmtColLlBZrroXDogjjgLRLyGJnvSaxB5qmurOiLtLEwrQCGhn58wJtUhRDsLo3eVEc701JNMjSSdPEHLxlkpmC0kwikmmvRDNINaLUk+UOqmq2I1LpNnnB7wVf38YBEv742A48H6lSweeec24MD+eee3zPC/Pz8/MgIiIh/l+hO0BEtJExZImIBGLIEhEJxJAlIhKIIUtEJBBDlohIIIYsEZFADFkiIoEYskREAjFkiYgEYsgSEQnEkCUiEoghS0QkEEOWiEgghiwRkUAMWSIigRiyREQCMWSJiARiyBIRCcSQJSISiCFLRCTQi4XuAK2PLMuF7gKtgKqqhe4CFQhHskREAnEku0FwpFSceKVBHMkSEQnEkCUiEoghS0QkEEOWiEgghiwRkUAMWSIigRiyREQCMWSJiARiyBIRCcSQJSISiCFLRCQQQ5aISCCGLBGRQAxZIiKBGLJERAIxZImIBGLIEhEJxJAlIhKIIUtEJBBDlohIIIYsEZFADFkiIoEYskREAjFkiYgEYsgSEQnEkCUiEoghS0QkEEOWiEgghiwRkUAMWSIigRiyRSCVShW6C0QkyIuF7gABHR0dsFqtsFqtsNls2LNnT6G7REQ5wpBdBU3T8N577+Ho0aOwWCw5q3d6ehrT09MYHh5GaWmpHriyLOPAgQM5a4eI8o8hu0KxWAydnZ0AgKNHjwprZ25uDtFoFNFoFAMDAzCbzbBarbDb7XC5XNi6dauwtoko9zgnuwKqqqKnpwe/+93vsGvXrry2HY/HEYlE4PP5oCgKfvGLX+DKlSuYmZnJaz+IaG2Ej2RlWRbdxKqMjY3B7/ejoaEBV65cAQAEAgFIkgS/349IJAIAaGlp0Ueusizj8uXLSKfTi+rL5/k9evQIExMTmJiYQF9fX97aJaK127Qj2StXriAQCODy5ct6wJaXl0NVVYyNjWF2dhbhcLjQ3SSi55zwkayqqqKbWBVN0wAAXq8XBoMBADA1NYVEIoGuri4AgCRJqK+vRzwef2Z9uTi/1Y6GnU4n3G43XC4X9u/fv+72iUicTXvjy2QyZX09OTmJw4cPZ32vqakJmqZBkqR8dm1JdXV1OHToENxuN8rKygrdHSJaoU0bsk+y2WwIBAL66LYYVFVVQVEUuN1uVFRUFLo7RLQGDFkAlZWVAICbN2/C4/EAAMLhMEwmU95v3JnNZiiKgoaGBtTW1ua1bSLKPYYsAIPBgEAggJMnT6K3txcA4PP58hawO3bsgKIoUBQFBw8ezEubRJQfL8zPz88XuhOb3cOHD7Fly5Y1HZv5Q1BsNxhpAd8f2rRLuIrJWgOWiIofQ5aISCCGLBGRQAxZIiKBGLJERAIxZImIBGLIEhEJxJAlIhKIIUtEJBBDlohIIIYsEZFADFkiIoEYskREAjFkiYgEYsgSEQnEkCUiEoghWwCpVKrQXSCiPOH2MwXQ0dEBq9UKq9UKm82GPXv2FLpLRCTIpg3ZdDoNn8+H06dPw2KxLFkmGAzCbDbrmys+TTAYhN1uX9G+YNPT05iensbw8DBKS0v1wJVlGQcOHFj1uRBR8dq0IZsr6XQaJ0+exOTkJOx2+6qPn5ubQzQaRTQaxcDAAMxmM6xWK+x2O1wuF7Zu3Sqg10SULwzZdYjFYuju7sZvfvMb/PGPf8xJnfF4HPF4HJFIBH6/H9XV1XA6nXC5XDAajTlpg4jyR1jIitxOe3R0FD6fD2+++Sb6+vpQW1uLs2fPYmZmBp2dnZiZmQEA9Pf36/3QNA1+vx+RSAQAcPz48UX1hsNhfUvwpqYmlJSU6K+pqopQKIS9e/fi/Pnz8Pl88Hg8+MMf/gBN0xbVlYvzf/ToESYmJjAxMYG+vj79+1euXIHVal13/UQk3nM7kr1//z5u3LiBoaEhSJIETdMQjUb1r8PhMC5cuIBAIABJkuD3+1FeXq5vzRwMBvHZZ5/p9YXDYYRCIYyOjsJgMEBVVbS1tcHn8+llIpEI6uvrC769czqdLmj7RLRywkJWZBBlQsbr9UKSJACAJEk4evSoXqampgajo6MAgJmZGczNzaGrq0t/vbm5GXfv3gWwMModHx/HiRMnYDAYACyMRFtaWrLatdlsUBRlRX182vmvdpTrdDrhdrvhcrnw4ovP7d9Fok3puf2N3b59O8rKyvSvn5wOAACj0YhUKoVkMonS0lI9kJ+kaRrm5uay6luKyWRato5cq6urw6FDh+B2u5/ZLyIqXs9tyD5pZGQEADA2NgZJkvSbUhmJRAKapukhmUqlsi6779+/j2QyqS/n0jQNs7OzMJvNeTuHqqoqKIoCt9uNioqKvLVLROJsmJB90rVr15BMJgEAlZWVAICbN2/C4/FA0zRcunRJf91gMKCurg6hUAjV1dWQJAkjIyP6HKxIZrMZiqKgoaEBtbW1QtsiovzbMB+rbWxsBAA4HA7IsoydO3fql9kGgwE9PT24ePEiZFmGw+FAQ0MDdu3apR/f2tqadXw8Hl80J5srO3bsgNfrRSAQwNWrV3Hq1CkGLNEG9cL8/Px8oTux2Tx8+BBbtmzJSV2Zm2iFXvFAS+P7QxtmJPs8yVXAElHxY8gSEQnEkCUiEoghS0QkEEOWiEgghiwRkUAMWSIigRiyREQCMWSJiARiyBIRCcSQJSISiCFLRCQQQ5aISCCGLBGRQAxZIiKBGLJERAIxZImIBGLIEhEJxJAlIhKIIUtEJBBDtgikUqlCd4GIBHmx0B0odqqqoq2tTf/a5/PB4/HktI2Ojg5YrVZYrVbYbDbs2bMnp/UTUeEID9nMlsiF1tbWhvb29lUdk06ncevWLYyNjUGSJMRiMXR2dsJkMuX0vKanpzE9PY3h4WGUlpbqgSvLMg4cOJCzdogo/ziSfQqDwYDOzk79a4vFgsbGRiQSCWF/PObm5hCNRhGNRjEwMACz2Qyr1Qq73Q6Xy4WtW7cKaZdoIxkfH8fevXvx0ksvFbor4kNWVVXRTayYqqoIhULYu3cvzp8/r1/6Pz4lYDQaEQwGYbFYFh2vaRpmZ2dhNpvz1ud4PI54PI5IJAK/34/q6mo4nU64XC4Yjca89YPoefLLX/5SvyK0Wq2oq6vDt7/97YL0ZdONZCORCOrr6/XwV1UV3d3dGBoagsVigaqq6OnpQSAQgMFgyDp2ZGQEiUQCXV1deP/999Hf35/Xvj969AgTExOYmJhAX19fXtumzSUcDiMej2ddyeVaLBbDn/70J5w+fRqSJOW8/jt37uDOnTsAgFdeeUUPXIfDgb179+a8veVsutUFNpsNiqIAWBiZhkIhtLa26iPXyspKbN++fdEd/2AwiIsXL6Knp2dR+BJtZuFwGGfOnIGmaas65siRI3jw4IHAnn0jlUphbGwMFy9eREtLC95++2309PTgn//8p/C2N91I1mQyLfqr2dvbi97e3qzvHTt2DBaLBel0GidPnoTJZMLQ0JB+bHt7+6pvpC1ntfO7TqcTbrcbLpcL+/fvz0kfSKzbt28Xugt47bXX8NprrxW6GwgGgwCA/v5+hEIh/ftffPEFvvjii7z04d69e7h37x7+9re/QZIkfOc738G+ffuwb98+vPTSS6ipqclZW5suZJey3LIsTdNw/vx5eL3enC/bWq26ujocOnQIbrcbZWVlBe0Lrd7Pf/7zQncBbW1tqKure+Z9icev9jIyK2tmZmYALASkLMsIBoMYHBwEsDAVl6lvufIA9CmIJ+/XDA8P530KDlj4PZ+cnMTk5CQGBgYAAMePH4fL5crJ/ZdNHbKSJKG+vh6hUAiKosBgMCCdTuPKlStobW3F1NSUPgdbCFVVVVAUBW63GxUVFQXpAxVWLkdUmVHss+5LZAKysbERwEIIRaNR/UouHA7jwoULCAQC6OzshNlsxvj4OM6ePQtJkp5a/mlTba+99lrOzne9Vw4/+clP8PLLL+ekL5s6ZAHoI9TDhw8DWPgrHggE9GmByclJ/bWMpqYm/Qcq18xmMxRFQUNDA2pra3NePxVGsayyUVV10Uj11q1bWfclLBYLWltbEY/HASwMRo4ePaqXr6mpwejo6LJtrLZ8xltvvYW33npr1ee0lNVMwdlsNrhcLmErdjZVyMqyvOQ/vsfjWXI6QJblvPxy7NixA4qiQFEUHDx4UHh7tLk9fl8isyzRbrcvW17TNPj9fkQiEf17RqMRqVRqyZHpassXgsViQUNDA1wul/BPWG6qkC1W165dw5YtWwrdDdrEnvyATWYUCywsXQSQ9cnH7u7uZetabfl8efXVV6EoCg4fPox9+/blrV2GbBFgwFKhLHVfQlVVDA4OoqWlZcljrl27hmQyueI2Vls+l15++WUoigKn07lo2i9fGLJEm5zH40E8HtdDqKmpCV1dXfjyyy8BAI2NjRgfH4fD4QAAdHV1Za1wURQFoVAIDocDPp/vmeXzIROsDQ0NKC0tzWvbT3phfn5+vqA9oHXJXOIVy40Vysb3hzbdJ76IiPKJIUtEJBBDlohIIIYsEZFADFkiIoEYskREAjFkiYgEYsgSEQnEkCUiEoghS0QkEEOWiEgghiwRkUAMWSIigRiyREQCMWSJiARiyBIRCcSQJSISiCFLRCQQQ5aISCCGLBGRQAxZIiKBGLJERAIxZImIBGLIEhEJxJAlIhKIIVsEUqlUobtARIK8WOgOENDR0QGr1Qqr1QqbzYY9e/YUuktElCMM2cek02n4fD6cPn0aFotlyTLBYBBmsxkej2fZeoLBIAYHBwEARqMRwWBw2foAYHp6GtPT0xgeHkZpaakeuLIs48CBA+s7KSIqKIZsjqmqCrPZDFVVAQDhcBg9PT0IBAIwGAzPPH5ubg7RaBTRaBQDAwMwm82wWq2w2+1wuVzYunWr6FMgohxiyOaYLMuQZVn/WlEUjI6OIpVKrShknxSPxxGPxxGJROD3+1FdXQ2n0wmXywWj0ZjLrhORAHkP2ccDKJdGR0fh8/nw5ptvoq+vD7W1tTh79ixmZmbQ2dmJmZkZAEB/f7/eB03T4Pf7EYlEAADHjx9fVG84HEZvby8AoKmpCSUlJfprqqoiFAph7969OH/+PHw+36JphFQqhXQ6DWD95/7o0SNMTExgYmICfX1966qLiPJjQ41k79+/jxs3bmBoaAiSJEHTNESjUf3rcDiMCxcuIBAIQJIk+P1+lJeX65f2wWAQn332mV5fOBxGKBTC6OgoDAYDVFVFW1sbfD6fXiYSiaC+vl6v43GapuHSpUvYt2/fU+dkiWjjynvILhVGuZAZLXq9XkiSBACQJAlHjx7Vy9TU1GB0dBQAMDMzg7m5OXR1demvNzc34+7duwAWAnJ8fBwnTpzQL/NlWUZLS0tWuzabDYqiLNmfkydPwmQyobW1FcDy577aEa7T6YTb7YbL5cL+/ftXdSwR5deGGslu374dZWVl+tdPTgcAC3f7U6kUkskkSktL9UB+kqZpmJuby6pvKSaTaVEdj494n7YKYTXq6upw6NAhuN3uZ/aJiIrHhgrZJ42MjAAAxsbGIEkSYrEYuru79dcTiQQ0TdND8vH5U2Bh+iGZTOqX+pqmYXZ2Fmazedk2Y7EYAoEAhoaG1j1FUFVVBUVR4Ha7UVFRsa66iKgwNnTIPunatWtIJpMAgMrKSgDAzZs34fF49PnTzOsGgwF1dXUIhUKorq6GJEkYGRnR52Cf1sZ65mDNZjMURUFDQwNqa2vXVAcRFY8N/bHaxsZGAIDD4YAsy9i5c6d+qW0wGNDT04OLFy9ClmU4HA40NDRg165d+vGZudTM8fF4fNGc7FIGBwf1pVyZ/8Lh8LLld+zYAa/Xi0AggKtXr+LUqVMMWKIN4oX5+fn5Qndis3v48CG2bNmypmMzN81E3VCk9eH7Qxt6JPu8WGvAElHxY8hS0dM0DWfOnNGnXlRVRTgcXjQNo6rqM6dmiPKNIUtFballeETPk021uoCeP1NTU4hEImhqasLZs2f15XayLOdsDTKRSBzJ0nOhvr5+2Q+OEBUzhiwRkUAMWXqmdDqNY8eO4cyZM5idncWxY8cW3WDKlHl8bfByy5YyN6gy/wWDwaw2NE1DLBbDj370I7S1tQEAent7Icuy/vpqb3JlbpRl/svUQyQaQ5ZWbG5uDr/97W8xOTmZ9X1VVXH48OFF329ra1sUguFwWA/OjMHBQZw/f15InzMrEzKPq8yIRCJob2/P+hg1kQgMWVqxsbExlJaWYmxsDKqqwuPxIJ1O48KFCwAWntWrqipUVcXo6ChsNhtCoZAeZLFYDBcvXlyybCKRyAppi8WCa9euob+/HwDg8/mgqirefffdVc3NZj4K3dTUpPdbVVX4fD5MTk7i5s2bufrnIVoSQ5ZWzGg04p133skKuXv37mFychI+ny/rkY0GgwEnTpzA5OQk7t27BwC4ffs2ZmZmliwbCARgs9ly2t/M4yptNhu6urqy+t3Y2IimpiaMj49z2oCE4hIuWrHa2tpFW94kEgkAC3OmT16SP14m8+wHo9GImpoa4X0FFkI2M0I+fPjwkmVsNlvWk9iIco0jWSIigTiSpZx4fO+0p5mZmcl6Rm9GKpXC//73P5hMppz37ckPMhDlE0eytC41NTUwGo3o7u5GLBbLek1V1aylUna7HQAWlY3FYlmbXeZK5pnAkUhEv+GWkVl1wKdjkWgcydK6WCwWtLa2ore3F0eOHFn0elNTk/7/mT3SBgcHF5U9fvy4kDv9zc3N+PjjjzE4OIjBwcFFr3u93py3SfQ4jmRp3TweD4aGhhbdFGtpaVm05KqzszNrt19gYapBVNgZDAZcvnx50cPWjUYjhoaGhG1RT5TBh3Y/5zbKQ6EzUwa1tbUbav50o7w/tHYcyVJRyKyhLS8v3zABSwQwZCmPMs8neHJUFw6H9TW2mZtjRBsFb3wVgVQqhVdeeaXQ3cibJ59dkPHkJ8GINgKOZItAR0cH/H4//vKXv+Df//53obsjjMFgwPvvv5+14gD45iYUH8JNGxFvfK1COp2Gz+fD6dOnFy2mzwgGgzCbzasKjMdHb6WlpbBarbBarZBlGQcOHFjRsbyxUpz4/hCnC4rM3NwcotEootEoBgYGYDabYbVaYbfb4XK5sHXr1kJ3kYhWgSFb5OLxOOLxOCKRCPx+P6qrq+F0OuFyuRatSyWi4lPQkBVxk+Ptt9/G1NQUzp07B4vFgnQ6jZMnT8Lr9eqX8I9f0j/5kc7HP4P/5E6px48fX9Te43fGm5qaUFJSor+mqipCoRD27t2L8+fPQ1GUdX2q6dGjR5iYmMDExAT6+vrWXA8R5c+Gu/FVUlKC119/HclkEsDCnftt27bhzp070DQN6XQad+/eRU1NDTRNQzQaxdDQkP4g5wsXLiCdTusBW15erj/o+auvvsJnn32mtxUOhxEKhTA6OgpVVeH1ejE0NJTVn0gkgpdeegmqqmLPnj15/bcgosIr6EhW1M2AcDiMW7duQZZl3L59Gx6PBzdu3ICmaUilUjAajTAajZAkCUePHtWPq6mpwejoKICFp0XNzc2hq6tLf725uRl3794F8M0DoU+cOAGDwQDgm8/mP85ms0FRFABAe3s72tvbF/V3tSN6p9MJt9sNl8uF/fv3r+pYIsqvDTknazKZEAqFMDs7i3g8jubmZnz66ae4d+8eEokESkpKIEnSoukAYGE5USqVQjKZRGlp6bKfPtI0DXNzcygrK3tmX3LxCaa6ujocOnQIbrf7mW0SUfHYkCFbWVmJ7du34/PPPwcASJIEu92ORCKBeDyuf6poZGQEwMLeVZIkIRaLobu7W68nkUhkPTU/lUplbbx3//79rGejapqG2dlZmM3mnJxHVVUVFEWB2+1GRUVFTuokovzacHOywMKi9927d2NwcBBmsxmSJKGsrAzXr1/H3bt3UVlZueRx165d0+dyM2UyN6o0TcOlS5f01zPPKg2FQvrzUjOb9q2H2WxGc3Mzfv/73+ODDz5Aa2srA5boObYhQxZY+Ax8LBbT95MyGo3Ytm0bdu/erc+hNjY2AgAcDgdkWcbOnTv1S3GDwYCenh5cvHgRsizD4XCgoaEBu3bt0ttobW3NOj4ejy+ak12JHTt2wOv1IhAI4OrVqzh16hRqa2vXdf5EVBz4ia8i8PDhQ2zZsmVNx/ITRcWN7w9t2JHs82StAUtExY8hS0QkEEOWiEgghiwRkUAMWSIigRiyREQCMWSJiARiyBIRCcSQJSISiCFLRCQQQ5aISCCGLBGRQAxZIiKBGLJERAIxZImIBGLIEhEJxJAlIhKIIVsEUqlUobtAtKHIsoxf//rX+Mc//oGvv/66oH3ZkLvVPm86OjpgtVphtVphs9mwZ8+eQneJNrlwOIx4PI7Ozs6c1x2LxdDZ2YmZmRkAQEtLi5B2rl+/juvXrwMAKioq4HK58MYbb6C6ujrnbT0NQ7YITE9PY3p6GsPDwygtLdUDV5ZlHDhwoNDdI3qqcDiM8fFxnD17FpIkPbWspmm4du0aPvjgAxgMBqTTaZw8eRLhcBgej0dYH//zn//g0qVLuHTpEgDA6XTijTfegN1ux86dO4W1CzBki87c3Byi0Sii0SgGBgZgNpthtVpht9vhcrmwdevWQneR1mB2drbQXUBJSQlKSkoK2gdJkrJGrQaDAV6vF/F4HA8ePMCDBw/y0o8PP/wQH374IYCFnazr6+tRV1eH7373uwCA8vLynLXF3WqLQGZH02f51re+herqajidTrhcLhiNRu6GWuRW+t7mQ1tbG+rq6hAKhbB3716cP38ePp8PHo8Hqqqira0NAGCz2aAoCr766is9EJ+8xO/v74csywgGgxgcHNTbyNS3XPmlBINBAAsbivb39ws7/9U4deoU7HY7Kisr111XUYxkC/mD2N/fjwsXLiAQCMBgMOg/HOfOnYMsy9A0DX6/H16vF7IsZ/0wGo1GBINBWCyWvJzDo0ePMDExgYmJCfT19Qlvj4rXWkZamVFsJBJBfX29/odZVVV0d3djaGgIFotF/x1obGwEsHCJH41GMTQ0BEmSEA6H9d+Zzs5OmM3mrOmCp5U3GAxZfVJVFSMjIwgGg7h169aazkvEVUJjYyNeffXVnNRVFCFbSJWVldi+fTtSqRQMBgOSySQsFgtu3boFWZYxMzODubk5VFZWLvphVFUVPT09CAQChT4NKnLFcqWhqqo+Us24desWWltbYbFYAAAWiwWtra2Ix+MAFi7xjx49qpevqanB6Ojosm2stHw4HEZvby/6+/thsVhgsVjw05/+dN3nCKxu4Pa9730PdrsdDocDFRUVOWn/cUURsoX+Ady9ezdu374Ni8WCTz75BB6PBx999BE0TUMymcTu3bshSRJCoVDWD+PjAb2ec1jtKNjpdMLtdsPlcmH//v1rbpc2J5PJpN+g0jQNs7OzsNvty5bPXM1FIhH9e0ajUR+YrLZ85vVEIoHR0dEl6xDNarXijTfegMPhgNVqFdpWUYRsoWUud/bv34+vvvoKdXV1+OijjzAzM4Nbt27BbDbrZXt7e9Hb25t1/LFjx/TgFaWurg6HDh2C2+1GWVmZ0LZo80kkEll/7DOjWAAYGRkBAIyNjUGSJMRiMXR3dy9b17PKX7x4EeXl5Xj33XdzfRpPZTKZ0NDQAIfDgX379uWtXYYsvrmc+fzzz/Hyyy/DYDDAarXiv//9Lx48eICamhq9bGZiPx+qqqqgKArcbreQyxgiSZJQX1+PUCgERVFgMBigqioGBwfR0tKy5DHXrl1DMplccRuPl4/FYvjoo49w7ty5nPT/WbZt24aGhgYoigKHw4EXX8x/5DFksXApU1pamvWDZTKZEAgEUFVVBaPRuOQPYzqdxpUrV9Da2vrM9YErZTaboSgKGhoaUFtbm5M6iZ7G4/EgHo/j8OHDAICmpiZ0dXXhyy+/BLBwE2h8fBwOhwMA0NXVlXU1pSgKQqEQHA4HfD7fM8snk0kcOXIkqw82m23JG2Nr1dDQoK+F3bZtW07qXCsu4fo/4XAYoVBIf6Mzi6S9Xm/WyDUzWQ/k7gfjBz/4ARRFgaIoOHjw4KqO5RKu4sb3hxiyReDhw4fYsmXLmo7lL3Fx4/tDfEBMEVhrwBJR8WPIEhEJxJAlIhKIIUtEJBBDlohIIIYsEZFADFkiIoEYskREAjFkiYgEYsgSEQnEkCUiEoghS0QkEEOWiEgghiwRkUAMWSIigRiyRSCVShW6C0QkCLefKQIdHR2wWq2wWq2w2WzYs2dPobtERDnCkP0/sVgM7733Hnp7e/O+RfH09DSmp6cxPDyM0tJSPXBlWcaBAwfy2hciyi1OF6xBLBbDz372M8RisZzXPTc3h2g0ioGBAfzqV7/Cj3/8Y5w5cwZ///vf8fXXX+e8PSISiyPZIhePxxGPxxGJROD3+1FdXQ2n0wmXywWj0Vjo7hHRM+QtZDMbyony9ttvY2pqCufOnYPFYllyt9lgMAiz2QyPx6O/Pjk5CWBh2+InBYNBDA4OAljYJvns2bOYmppCW1sbAODIkSP69yVJWrL85cuX0d/fn5NzfPToESYmJjAxMYG+vr6c1ElEYm2Y6YKSkhK8/vrrSCaTABbu2G/btg137tyBpmlIp9O4e/cuampqsgJYVVWMjY3hX//6F+7fv6/Xp6oq7HY7VFXF6OgoEokERkZGIMsyhoaGUF1djaGhIbz77ruQJGnZ8kS0ueVtJJuPLZHD4TBu3boFWZZx+/ZteDwe3LhxA5qmIZVKwWg0wmg0YmpqCiaTCY2NjQAASZLwzjvv4L333tPrenzkbTAYUFdX99S2lyvf3t6O9vb2FR+7Ek6nE263Gy6XC/v371/VsUSUXxtqTtZkMiEUCmF2dhbxeBzNzc349NNPce/ePSQSCZSUlECSJCQSCZSXl0OSpGXrUlVVnxbIaCByaDoAAAZSSURBVGlpyVn51aqrq8OhQ4fgdrtRVlaWs3qJSKwNFbKVlZXYvn07Pv/8cwALI1S73Y5EIoF4PA673a6XnZ2dhaZpetAmk0l9uiCdTuPChQvo7+/XR5nBYHDZdldbfqWqqqqgKArcbjcqKirWXR8R5d+GmZMFFi7Td+/ejcHBQZjNZkiShLKyMly/fh13795FZWUlAKCmpgaffPIJpqamAHwTksuJxWKrml9dbfnHmc1mNDc34/e//z0++OADtLa2MmCJnmMbaiQLAHa7HSMjI6ipqQEAGI1GbNu2DeXl5fqHDCwWC86dO6df3huNRpw6dQp//etfASyE9YkTJ/TXm5qa4HA49DYsFgv27duXtbrgaeWfZceOHVAUBYqi4ODBg+v/RyCiovHC/Pz8fKE7sdk9fPgQW7ZsWdOxmemJfNxYpNXj+0MbarrgebXWgCWi4seQJSISiCFLRCQQQ5aISCCGLBGRQAxZIiKBGLJERAIxZImIBGLIEhEJxJAlIhKIIUtEJBBDlohIIIYsEZFADNkikEqlCt0FIhJkwz1P9nnU0dEBq9UKq9UKm82GPXv2FLpLRJQjDNkiMD09jenpaQwPD6O0tFQPXFmWceDAgUJ3j4jWgSGbB+FwGOPj4zh79uxTN28EgLm5OUSjUUSjUQwMDMBsNsNqtcJut8PlcmHr1q156jUR5QJDtsjF43HE43FEIhH4/X5UV1fD6XTC5XLBaDQWuntE9AybYvuZzBYguTI2Nga/34+GhgZcuXIFABAIBHDv3j19n6+WlhZ0dnYiGAxicHBQP9bn86G3tzen/QG4vUmx4vYzxJHsOly5cgWBQAAGgwGxWAyBQABDQ0OwWCy4c+cOYrEYOjs7YTabs6YLRIQsERWnTRGyuR5FaJoGAPB6vfoOuACQTCaRTCZhsVhgtVpX3J/VjrSdTifcbjdcLhf279+/qmOJKL82RciKYjKZ9P9/cptxn88Hj8eTs7bq6upw6NAhuN1ulJWV5axeIhKLIZtDsixDVVV9msBkMq1rPriqqgqKosDtdqOioiKHPSWifGHI5khmCkCWZRiNRtTW1q6pHrPZDEVR0NDQsOY6iKh48GO1OVJdXY1QKARZluFwOFBeXq6PYhVFQSKRgMPhQDgcXnTsjh074PV6EQgEcPXqVZw6dYoBS7RBbIolXMXu4cOH2LJly5qO5RKh4sb3hziSLQJrDVgiKn4MWSIigRiyREQCMWSJiARiyBIRCcSQJSISiCFLRCQQQ5aISCCGLBGRQAzZIsDdaok2Lj4gpghwt1qijYshm0OapsHv98Pr9eqPPQyFQs/cQJG71RJtXAzZIsPdaok2FoZskeNutUTPt00RsrncrbatrQ3t7e367gczMzOw2WwIBAJPnRIAgGAwiJGREXz/+9/Hn//851W3/ejRI0xMTGBiYgJ9fX1rPQUiyiOuLlgDVVVx5MgRnDt3DqqqIhAIYGpq6qnHBINBzM7OYmhoKGvzRSLa2DbFSDbXD0wOBoPw+Xz6CNlgMMDhcOi72D5peHgYH3/8sT7abW9vR3t7u/46d6sl2rg2RcjmkqZpmJ2dhd1uX1H5SCSCSCSC/v7+dY1guVst0fOJIbtGiURiRSPQpqYm/PCHP0R3dzeCwSAsFsuK2+ButUTPP4bsKkmSBK/Xi+7ubtTU1MBisSCdTmNqamrZ0JVlGa2trejs7Hxm0HK3WqKNhSG7BrIs49y5czhy5AgA6KsLnsbj8QAAjhw5gv7+/qxA3rFjBxRFgaIoOHjwoLiOE1HecbfaIsDdajcuvj/EJVxFgLvVEm1cDFkiIoEYskREAjFkiYgEYsgSEQnEkCUiEoghS0QkEEOWiEgghiwRkUAMWSIigRiyREQCMWSJiARiyBIRCcSQJSISiCFLRCQQQ5aISCCGLBGRQAxZIiKBGLJERAIxZImIBGLIEhEJxJAlIhKIIUtEJBBDlohIIIYsEZFALxa6A5QbsiwXugtEtASOZImIBHphfn5+vtCdICLaqDiSJSISiCFLRCQQQ5aISCCGLBGRQAxZIiKBGLJERAIxZImIBGLIEhEJxJAlIhKIIUtEJBBDlohIIIYsEZFADFkiIoEYskREAjFkiYgEYsgSEQnEkCUiEoghS0QkEEOWiEgghiwRkUD/H7JcqFQDp1X1AAAAAElFTkSuQmCC"> <img src="/assets/img/regfile1.4700e503.png"> <img src="/assets/img/regfile2.1530a190.png"> <p>寄存器具有<strong>读/写</strong>两个功能：根据<strong>复位信号</strong>和<strong>时钟信号</strong>开展工作</p> <ul><li>写需要输入写地址、写数据、写使能，共三个端口</li> <li>读需要读地址、读使能，共四个端口</li> <li>寄存器的输出为读出的具体数据，共两个端口</li></ul> <p>共输入端口 9 个，输出端口 2 个，只有在读的时候，输出端口才有读数据</p> <p>数据为 32 位，所以需要 5 位地址线进行寻址，于是读写地址均为 5 位，读写数据均为 32 位，使能信号、复位信号以及时钟信号均为 1 位</p> <p>regfile.v</p> <div class="language-verilog line-numbers-mode"><pre class="language-verilog"><code><span class="token constant">`timescale</span> <span class="token number">1</span>ns <span class="token operator">/</span> <span class="token number">1</span>ps
<span class="token constant">`include</span> <span class="token string">&quot;./defines.v&quot;</span>

<span class="token keyword">module</span> <span class="token function">regfile</span><span class="token punctuation">(</span>
    <span class="token keyword">input</span> <span class="token keyword">wire</span> rst<span class="token punctuation">,</span>
    <span class="token keyword">input</span> <span class="token keyword">wire</span> clk<span class="token punctuation">,</span>
    
    <span class="token comment">// 一个写</span>
    <span class="token keyword">input</span> <span class="token keyword">wire</span><span class="token punctuation">[</span><span class="token constant">`RegAddrBus</span><span class="token punctuation">]</span> waddr<span class="token punctuation">,</span>
    <span class="token keyword">input</span> <span class="token keyword">wire</span><span class="token punctuation">[</span><span class="token constant">`RegDataBus</span><span class="token punctuation">]</span> wdata<span class="token punctuation">,</span>
    <span class="token keyword">input</span> <span class="token keyword">wire</span> we<span class="token punctuation">,</span>
    
    <span class="token comment">// 两个读</span>
    <span class="token comment">// 读 1</span>
    <span class="token keyword">input</span> <span class="token keyword">wire</span><span class="token punctuation">[</span><span class="token constant">`RegAddrBus</span><span class="token punctuation">]</span> raddr1<span class="token punctuation">,</span>
    <span class="token keyword">input</span> <span class="token keyword">wire</span> re1<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token keyword">reg</span><span class="token punctuation">[</span><span class="token constant">`RegDataBus</span><span class="token punctuation">]</span> rdata1<span class="token punctuation">,</span>
    <span class="token comment">// 读 2</span>
    <span class="token keyword">input</span> <span class="token keyword">wire</span><span class="token punctuation">[</span><span class="token constant">`RegAddrBus</span><span class="token punctuation">]</span> raddr2<span class="token punctuation">,</span>
    <span class="token keyword">input</span> <span class="token keyword">wire</span> re2<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token keyword">reg</span><span class="token punctuation">[</span><span class="token constant">`RegDataBus</span><span class="token punctuation">]</span> rdata2
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">reg</span><span class="token punctuation">[</span><span class="token constant">`RegDataBus</span><span class="token punctuation">]</span> regs<span class="token punctuation">[</span><span class="token constant">`RegNum</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// 写端口</span>
    <span class="token important">always@</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk<span class="token punctuation">)</span> <span class="token keyword">begin</span>
        <span class="token function">if</span><span class="token punctuation">(</span>rst <span class="token operator">==</span><span class="token constant">`RstDisable</span><span class="token punctuation">)</span> <span class="token keyword">begin</span> <span class="token comment">// 当置零端无效时，读写端口才生效</span>
            <span class="token function">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>we <span class="token operator">==</span> <span class="token constant">`WriteEnable</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>waddr <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">begin</span> <span class="token comment">// 当写端口开启且写地址合法，写入数据</span>
                regs<span class="token punctuation">[</span>waddr<span class="token punctuation">]</span> <span class="token operator">&lt;=</span> wdata<span class="token punctuation">;</span>
            <span class="token keyword">end</span>
        <span class="token keyword">end</span> 
    <span class="token keyword">end</span>
    <span class="token comment">// 读端口 1</span>
    <span class="token important">always@</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">begin</span>
         <span class="token function">if</span><span class="token punctuation">(</span>rst <span class="token operator">==</span> <span class="token constant">`RstEnable</span><span class="token punctuation">)</span> <span class="token keyword">begin</span> <span class="token comment">// 当置零端无效时，读写端口才生效</span>
            rdata1 <span class="token operator">&lt;=</span> <span class="token constant">`ZeroWord</span><span class="token punctuation">;</span>
         <span class="token keyword">end</span> <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>re1 <span class="token operator">==</span> <span class="token constant">`ReadEnable</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>raddr1 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">begin</span> <span class="token comment">// 当读地址为 0，返回空数据</span>
            rdata1 <span class="token operator">&lt;=</span> <span class="token number">32'h0</span><span class="token punctuation">;</span>
         <span class="token keyword">end</span> <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>re1 <span class="token operator">==</span> <span class="token constant">`ReadEnable</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>raddr1 <span class="token operator">==</span> waddr<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>we <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">begin</span> <span class="token comment">// 当读到正在写的端口，直接返回要写入的数据</span>
            rdata1 <span class="token operator">&lt;=</span> wdata<span class="token punctuation">;</span>
         <span class="token keyword">end</span> <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>re1 <span class="token operator">==</span> <span class="token constant">`ReadEnable</span><span class="token punctuation">)</span> <span class="token keyword">begin</span> <span class="token comment">// 当正常读数据，直接返回读地址的数据即可</span>
            rdata1 <span class="token operator">&lt;=</span> regs<span class="token punctuation">[</span>raddr1<span class="token punctuation">]</span><span class="token punctuation">;</span>
         <span class="token keyword">end</span> <span class="token keyword">else</span> <span class="token keyword">begin</span>
            rdata1 <span class="token operator">&lt;=</span> <span class="token number">32'h 0</span><span class="token punctuation">;</span>
         <span class="token keyword">end</span>
    <span class="token keyword">end</span>
    <span class="token comment">// 读端口 2</span>
    <span class="token important">always@</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">begin</span>
         <span class="token function">if</span><span class="token punctuation">(</span>rst <span class="token operator">==</span> <span class="token constant">`RstEnable</span><span class="token punctuation">)</span> <span class="token keyword">begin</span>
            rdata2 <span class="token operator">&lt;=</span> <span class="token constant">`ZeroWord</span><span class="token punctuation">;</span>
         <span class="token keyword">end</span> <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>re2 <span class="token operator">==</span> <span class="token constant">`ReadEnable</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>raddr2 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">begin</span>
            rdata2 <span class="token operator">&lt;=</span> <span class="token number">32'h0</span><span class="token punctuation">;</span>
         <span class="token keyword">end</span> <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>re2 <span class="token operator">==</span> <span class="token constant">`ReadEnable</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>raddr2 <span class="token operator">==</span> waddr<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>we <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">begin</span>
            rdata2 <span class="token operator">&lt;=</span> wdata<span class="token punctuation">;</span>
         <span class="token keyword">end</span> <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>re2 <span class="token operator">==</span> <span class="token constant">`ReadEnable</span><span class="token punctuation">)</span> <span class="token keyword">begin</span>
            rdata2 <span class="token operator">&lt;=</span> regs<span class="token punctuation">[</span>raddr2<span class="token punctuation">]</span><span class="token punctuation">;</span>
         <span class="token keyword">end</span> <span class="token keyword">else</span> <span class="token keyword">begin</span>
            rdata2 <span class="token operator">&lt;=</span> <span class="token number">32'h 0</span><span class="token punctuation">;</span>
         <span class="token keyword">end</span>
    <span class="token keyword">end</span>
<span class="token keyword">endmodule</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br></div></div><h2 id="指令存-取"><a href="#指令存-取" class="header-anchor">#</a> 指令存 / 取</h2> <h3 id="指令存储器-inst-rom"><a href="#指令存储器-inst-rom" class="header-anchor">#</a> 指令存储器 inst_rom</h3> <p>指令存储器，指令将存在这个模块的<code>reg [31:0] inst_mem[0:127]</code>中，这是一个长度为 128 的指令数组，每个指令长度为 32 位，最多可以存 128 条指令</p> <p>存储器接受取值地址和一个使能信号，返回（输出）地址下标处对应的指令</p> <table><thead><tr><th>序号</th> <th>接口名</th> <th>宽度（bit）</th> <th>输入/输出</th> <th>作用</th></tr></thead> <tbody><tr><td>1</td> <td>ce</td> <td>1</td> <td>输入</td> <td>使能信号</td></tr> <tr><td>2</td> <td>addr</td> <td>32</td> <td>输入</td> <td>要读取的指令地址</td></tr> <tr><td>3</td> <td>inst</td> <td>32</td> <td>输出</td> <td>读出的指令</td></tr></tbody></table> <p>inst_rom.v</p> <ul><li>通过<code>$readmemh(path, reg)</code>函数将路径 path 的文件内容读入信号 reg 中，以此来初始化存储器指令内容</li> <li>只有当使能信号为 1 时，能够正常取值，即令输出<code>inst = inst_mem[addr[31:2]]</code></li></ul> <div class="language-verilog line-numbers-mode"><pre class="language-verilog"><code><span class="token constant">`timescale</span> <span class="token number">1</span>ns <span class="token operator">/</span> <span class="token number">1</span>ps
<span class="token constant">`include</span> <span class="token string">&quot;./defines.v&quot;</span>

<span class="token keyword">module</span> <span class="token function">inst_rom</span><span class="token punctuation">(</span>
    <span class="token keyword">input</span> <span class="token keyword">wire</span> ce<span class="token punctuation">,</span>
    <span class="token keyword">input</span> <span class="token keyword">wire</span> <span class="token punctuation">[</span><span class="token constant">`InstAddrBus</span><span class="token punctuation">]</span> addr<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token constant">`InstBus</span><span class="token punctuation">]</span> inst
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token constant">`InstBus</span><span class="token punctuation">]</span> inst_mem<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">127</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    
    <span class="token keyword">initial</span> <span class="token keyword">begin</span>
        <span class="token kernel-function property">$readmemh</span><span class="token punctuation">(</span><span class="token string">&quot;C:/File/vivado/inst_rom.data&quot;</span><span class="token punctuation">,</span> inst_mem<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">end</span>
    
    <span class="token important">always@</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">begin</span>
        <span class="token function">if</span><span class="token punctuation">(</span>ce <span class="token operator">==</span> <span class="token constant">`CeDisable</span><span class="token punctuation">)</span> <span class="token keyword">begin</span>
            inst <span class="token operator">&lt;=</span> <span class="token constant">`ZeroWord</span><span class="token punctuation">;</span>
        <span class="token keyword">end</span> <span class="token keyword">else</span> <span class="token keyword">begin</span>
            inst <span class="token operator">&lt;=</span> inst_mem<span class="token punctuation">[</span>addr<span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">end</span>
    <span class="token keyword">end</span>
<span class="token keyword">endmodule</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h3 id="取值模块-inst-fetch"><a href="#取值模块-inst-fetch" class="header-anchor">#</a> 取值模块 inst_fetch</h3> <p>将 pc 和指令存储器 inst_rom 耦合，即把 pc 的输出（取值地址和使能信号）作为 inst_rom 的输入（取值地址和使能信号），统一输出一条 pc 从 inst_rom 取出来的 32 位指令 inst_o</p> <img src="/assets/img/fetch.9098a8a5.jpg"> <p>inst_fetch.v：通过内部实例化将 pc 和 inst_rom 耦合在一起</p> <div class="language-verilog line-numbers-mode"><pre class="language-verilog"><code><span class="token constant">`timescale</span> <span class="token number">1</span>ns <span class="token operator">/</span> <span class="token number">1</span>ps
<span class="token constant">`include</span> <span class="token string">&quot;defines.v&quot;</span>

<span class="token comment">// 将 pc 模块和 inst_mem 通过内部实例化相连接。形成大的 inst_fetch 模块</span>
<span class="token keyword">module</span> <span class="token function">inst_fetch</span><span class="token punctuation">(</span>
    <span class="token keyword">input</span> <span class="token keyword">wire</span> clk<span class="token punctuation">,</span>
    <span class="token keyword">input</span> <span class="token keyword">wire</span> rst<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token keyword">wire</span> <span class="token punctuation">[</span><span class="token constant">`InstBus</span><span class="token punctuation">]</span> inst_o
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 内部信号通过pc的输出，inst_rom的输入相连接</span>
    <span class="token keyword">wire</span> <span class="token punctuation">[</span><span class="token constant">`InstAddrBus</span><span class="token punctuation">]</span>pc<span class="token punctuation">;</span>
    <span class="token keyword">wire</span> ce<span class="token punctuation">;</span>
    pc <span class="token function">pc0</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">ce</span><span class="token punctuation">(</span>ce<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token function">clk</span><span class="token punctuation">(</span>clk<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token function">pc</span><span class="token punctuation">(</span>pc<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token function">rst</span><span class="token punctuation">(</span>rst<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    inst_rom <span class="token function">inst_rom0</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">ce</span><span class="token punctuation">(</span>ce<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token function">addr</span><span class="token punctuation">(</span>pc<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token function">inst</span><span class="token punctuation">(</span>inst_o<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">endmodule</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>测试代码：inst_fetch_tb.v</p> <div class="language-verilog line-numbers-mode"><pre class="language-verilog"><code><span class="token constant">`timescale</span> <span class="token number">1</span>ns <span class="token operator">/</span> <span class="token number">1</span>ps

<span class="token keyword">module</span> <span class="token function">inst_fetch_tb</span><span class="token punctuation">(</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">reg</span> rst<span class="token punctuation">;</span>
    <span class="token keyword">reg</span> clk<span class="token punctuation">;</span>
    <span class="token keyword">wire</span> <span class="token punctuation">[</span><span class="token constant">`InstBus</span><span class="token punctuation">]</span> inst_o<span class="token punctuation">;</span>
    inst_fetch <span class="token function">inst_fetch0</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">rst</span><span class="token punctuation">(</span>rst<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token function">clk</span><span class="token punctuation">(</span>clk<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token function">inst_o</span><span class="token punctuation">(</span>inst_o<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">initial</span> <span class="token keyword">begin</span>
        clk <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">forever</span>  <span class="token number">#10</span> clk <span class="token operator">=</span> <span class="token operator">~</span>clk<span class="token punctuation">;</span>
    <span class="token keyword">end</span>
    
    <span class="token keyword">initial</span> <span class="token keyword">begin</span>
        rst <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token number">#10</span> rst <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token number">#100</span> rst <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token number">#500</span> <span class="token kernel-function property">$finish</span><span class="token punctuation">;</span>
    <span class="token keyword">end</span>
<span class="token keyword">endmodule</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h2 id="译码器与运算器"><a href="#译码器与运算器" class="header-anchor">#</a> 译码器与运算器</h2> <h3 id="译码器-id"><a href="#译码器-id" class="header-anchor">#</a> 译码器 ID</h3> <p>译码器，也叫 id，负责<strong>进一步处理取值模块和寄存器的输出</strong>，接收取值模块输出的指令和寄存器两个读出的数据，处理成供运算器 alu 处理的多个信号数据</p> <img src="/assets/img/id.6a59a874.png"> <p>其中</p> <ul><li>输入 inst_i 即为取值模块 inst_fetch 的输出，即从存储器取出的一条指令</li> <li>reg1_data_i 和 reg2_data_i 为寄存器 regfile 的两个输出，为从寄存器里读出的两个数据</li></ul> <p>译码器 id 将处理这条从取值模块传来的指令 inst_i，解析出</p> <ul><li>第一个寄存器地址 reg1_addr_o 及其读使能信号 reg1_read_o</li> <li>第二个寄存器地址 reg2_addr_o 及其读使能信号 reg2_read_o</li> <li>目的寄存器地址 wd_o 及其写使能信号 wreg_o</li> <li>指令算术运算类型 aluop_o</li></ul> <p>同时 id 处理从寄存器传来的读数据 reg1_data_i 和 reg2_data_i，令 id 的操作数输出 reg1_o 和 reg2_o 分别等于这两个读数据（将送入运算器进行算术操作），此外，译码器的工作受复位信号 rst 影响</p> <p>译码器的输出一部分将送到运算器 alu（操作数、操作符、写地址和写使能），另一部分送往寄存器 regfile（读地址和读使能）</p> <p>id.v</p> <ul><li>运算类型 aluop_o 以独热码的形式存储，共 14 条指令，所以需要 14 位信号进行存储</li> <li>这里用到 6-64 位和 5-32 位编码器（decoder）对指令 inst_i 中的各个分段进行解析</li></ul> <div class="language-verilog line-numbers-mode"><pre class="language-verilog"><code><span class="token constant">`timescale</span> <span class="token number">1</span>ns <span class="token operator">/</span> <span class="token number">1</span>ps
<span class="token constant">`include</span><span class="token string">&quot;./defines.v&quot;</span>

<span class="token keyword">module</span> <span class="token function">id</span><span class="token punctuation">(</span>
    <span class="token keyword">input</span> <span class="token keyword">wire</span> rst<span class="token punctuation">,</span>
    <span class="token keyword">input</span> <span class="token keyword">wire</span><span class="token punctuation">[</span><span class="token constant">`InstBus</span><span class="token punctuation">]</span> inst_i<span class="token punctuation">,</span>        <span class="token comment">// 指令  </span>
    <span class="token keyword">input</span> <span class="token keyword">wire</span><span class="token punctuation">[</span><span class="token constant">`RegDataBus</span><span class="token punctuation">]</span>reg1_data_i<span class="token punctuation">,</span> <span class="token comment">// 输入操作码1</span>
    <span class="token keyword">input</span> <span class="token keyword">wire</span><span class="token punctuation">[</span><span class="token constant">`RegDataBus</span><span class="token punctuation">]</span>reg2_data_i<span class="token punctuation">,</span> <span class="token comment">// 输入操作码2</span>
    <span class="token keyword">output</span> <span class="token keyword">wire</span><span class="token punctuation">[</span><span class="token constant">`Aluop_OnehotBus</span><span class="token punctuation">]</span>aluop_o<span class="token punctuation">,</span> <span class="token comment">// 指令类别，用独热码存</span>
    <span class="token keyword">output</span> <span class="token keyword">wire</span><span class="token punctuation">[</span><span class="token constant">`RegDataBus</span><span class="token punctuation">]</span>reg1_o<span class="token punctuation">,</span> <span class="token comment">// 就是输入的 reg1_data_i</span>
    <span class="token keyword">output</span> <span class="token keyword">wire</span><span class="token punctuation">[</span><span class="token constant">`RegDataBus</span><span class="token punctuation">]</span>reg2_o<span class="token punctuation">,</span> <span class="token comment">// 输入的 reg2_data_i</span>
    <span class="token keyword">output</span> <span class="token keyword">wire</span><span class="token punctuation">[</span><span class="token constant">`RegAddrBus</span><span class="token punctuation">]</span>wd_o<span class="token punctuation">,</span>   <span class="token comment">// 目的写寄存器地址</span>
    <span class="token keyword">output</span> <span class="token keyword">wire</span> wreg_o<span class="token punctuation">,</span>             <span class="token comment">// 写权限</span>
    <span class="token keyword">output</span> <span class="token keyword">wire</span><span class="token punctuation">[</span><span class="token constant">`RegAddrBus</span><span class="token punctuation">]</span>reg1_addr_o<span class="token punctuation">,</span>    <span class="token comment">// 读寄存器地址1</span>
    <span class="token keyword">output</span> <span class="token keyword">wire</span><span class="token punctuation">[</span><span class="token constant">`RegAddrBus</span><span class="token punctuation">]</span>reg2_addr_o<span class="token punctuation">,</span>    <span class="token comment">// 读寄存器地址2</span>
    <span class="token keyword">output</span> <span class="token keyword">wire</span> reg1_read_o<span class="token punctuation">,</span>        <span class="token comment">// 读权限1</span>
    <span class="token keyword">output</span> <span class="token keyword">wire</span> reg2_read_o         <span class="token comment">// 读权限2</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 先用四个解码器解析 32 位指令，获取操作数、指令以及目的地址</span>
    <span class="token keyword">wire</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> op<span class="token punctuation">;</span>
    <span class="token keyword">wire</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> op1<span class="token punctuation">;</span>
    <span class="token keyword">wire</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> sa<span class="token punctuation">;</span>
    <span class="token keyword">wire</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> func<span class="token punctuation">;</span>
    <span class="token keyword">wire</span><span class="token punctuation">[</span><span class="token number">63</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> op_d<span class="token punctuation">;</span>
    <span class="token keyword">wire</span><span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> op1_d<span class="token punctuation">;</span>
    <span class="token keyword">wire</span><span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> sa_d<span class="token punctuation">;</span>
    <span class="token keyword">wire</span><span class="token punctuation">[</span><span class="token number">63</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> func_d<span class="token punctuation">;</span>
    <span class="token keyword">assign</span> op <span class="token operator">=</span> inst_i<span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">26</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 运算数 1</span>
    <span class="token keyword">assign</span> op1 <span class="token operator">=</span> inst_i<span class="token punctuation">[</span><span class="token number">25</span><span class="token punctuation">:</span><span class="token number">21</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 运算数 2</span>
    <span class="token keyword">assign</span> sa <span class="token operator">=</span> inst_i<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> func <span class="token operator">=</span> inst_i<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 运算类型</span>
    decoder_6_64 <span class="token function">dec0</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">in</span><span class="token punctuation">(</span>op<span class="token punctuation">)</span> <span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token function">out</span><span class="token punctuation">(</span>op_d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    decoder_5_32 <span class="token function">dec1</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">in</span><span class="token punctuation">(</span>op1<span class="token punctuation">)</span> <span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token function">out</span><span class="token punctuation">(</span>op1_d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    decoder_6_64 <span class="token function">dec2</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">in</span><span class="token punctuation">(</span>sa<span class="token punctuation">)</span> <span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token function">out</span><span class="token punctuation">(</span>sa_d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    decoder_5_32 <span class="token function">dec3</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">in</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span> <span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token function">out</span><span class="token punctuation">(</span>func_d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 独热码分辨 14 种不同指令</span>
    <span class="token keyword">wire</span> inst_add<span class="token punctuation">;</span>
    <span class="token keyword">wire</span> inst_addu<span class="token punctuation">;</span>
    <span class="token keyword">wire</span> inst_sub<span class="token punctuation">;</span>
    <span class="token keyword">wire</span> inst_subu<span class="token punctuation">;</span>
    <span class="token keyword">wire</span> inst_slt<span class="token punctuation">;</span>
    <span class="token keyword">wire</span> inst_sltu<span class="token punctuation">;</span>
    <span class="token keyword">wire</span> inst_and<span class="token punctuation">;</span>
    <span class="token keyword">wire</span> inst_or<span class="token punctuation">;</span>
    <span class="token keyword">wire</span> inst_xor<span class="token punctuation">;</span>
    <span class="token keyword">wire</span> inst_nor<span class="token punctuation">;</span>
    <span class="token keyword">wire</span> inst_sll<span class="token punctuation">;</span>
    <span class="token keyword">wire</span> inst_srl<span class="token punctuation">;</span>
    <span class="token keyword">wire</span> inst_sra<span class="token punctuation">;</span>
    <span class="token keyword">wire</span> inst_lui<span class="token punctuation">;</span>
    <span class="token keyword">assign</span> inst_add <span class="token operator">=</span> op_d<span class="token punctuation">[</span><span class="token constant">`OpZero</span><span class="token punctuation">]</span><span class="token operator">&amp;&amp;</span>sa_d<span class="token punctuation">[</span><span class="token constant">`SaZero</span><span class="token punctuation">]</span><span class="token operator">&amp;&amp;</span>func_d<span class="token punctuation">[</span><span class="token constant">`FuncAdd</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> inst_addu <span class="token operator">=</span> op_d<span class="token punctuation">[</span><span class="token constant">`OpZero</span><span class="token punctuation">]</span><span class="token operator">&amp;&amp;</span>sa_d<span class="token punctuation">[</span><span class="token constant">`SaZero</span><span class="token punctuation">]</span><span class="token operator">&amp;&amp;</span>func_d<span class="token punctuation">[</span><span class="token constant">`FuncAddu</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> inst_sub <span class="token operator">=</span> op_d<span class="token punctuation">[</span><span class="token constant">`OpZero</span><span class="token punctuation">]</span><span class="token operator">&amp;&amp;</span>sa_d<span class="token punctuation">[</span><span class="token constant">`SaZero</span><span class="token punctuation">]</span><span class="token operator">&amp;&amp;</span>func_d<span class="token punctuation">[</span><span class="token constant">`FuncSub</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> inst_subu <span class="token operator">=</span> op_d<span class="token punctuation">[</span><span class="token constant">`OpZero</span><span class="token punctuation">]</span><span class="token operator">&amp;&amp;</span>sa_d<span class="token punctuation">[</span><span class="token constant">`SaZero</span><span class="token punctuation">]</span><span class="token operator">&amp;&amp;</span>func_d<span class="token punctuation">[</span><span class="token constant">`FuncSubu</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> inst_slt <span class="token operator">=</span> op_d<span class="token punctuation">[</span><span class="token constant">`OpZero</span><span class="token punctuation">]</span><span class="token operator">&amp;&amp;</span>sa_d<span class="token punctuation">[</span><span class="token constant">`SaZero</span><span class="token punctuation">]</span><span class="token operator">&amp;&amp;</span>func_d<span class="token punctuation">[</span><span class="token constant">`FuncSlt</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> inst_sltu <span class="token operator">=</span> op_d<span class="token punctuation">[</span><span class="token constant">`OpZero</span><span class="token punctuation">]</span><span class="token operator">&amp;&amp;</span>sa_d<span class="token punctuation">[</span><span class="token constant">`SaZero</span><span class="token punctuation">]</span><span class="token operator">&amp;&amp;</span>func_d<span class="token punctuation">[</span><span class="token constant">`FuncSltu</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> inst_and <span class="token operator">=</span> op_d<span class="token punctuation">[</span><span class="token constant">`OpZero</span><span class="token punctuation">]</span><span class="token operator">&amp;&amp;</span>sa_d<span class="token punctuation">[</span><span class="token constant">`SaZero</span><span class="token punctuation">]</span><span class="token operator">&amp;&amp;</span>func_d<span class="token punctuation">[</span><span class="token constant">`FuncAnd</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> inst_or <span class="token operator">=</span> op_d<span class="token punctuation">[</span><span class="token constant">`OpZero</span><span class="token punctuation">]</span><span class="token operator">&amp;&amp;</span>sa_d<span class="token punctuation">[</span><span class="token constant">`SaZero</span><span class="token punctuation">]</span><span class="token operator">&amp;&amp;</span>func_d<span class="token punctuation">[</span><span class="token constant">`FuncOr</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> inst_xor <span class="token operator">=</span> op_d<span class="token punctuation">[</span><span class="token constant">`OpZero</span><span class="token punctuation">]</span><span class="token operator">&amp;&amp;</span>sa_d<span class="token punctuation">[</span><span class="token constant">`SaZero</span><span class="token punctuation">]</span><span class="token operator">&amp;&amp;</span>func_d<span class="token punctuation">[</span><span class="token constant">`FuncXor</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> inst_nor <span class="token operator">=</span> op_d<span class="token punctuation">[</span><span class="token constant">`OpZero</span><span class="token punctuation">]</span><span class="token operator">&amp;&amp;</span>sa_d<span class="token punctuation">[</span><span class="token constant">`SaZero</span><span class="token punctuation">]</span><span class="token operator">&amp;&amp;</span>func_d<span class="token punctuation">[</span><span class="token constant">`FuncNor</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> inst_sll <span class="token operator">=</span> op_d<span class="token punctuation">[</span><span class="token constant">`OpZero</span><span class="token punctuation">]</span><span class="token operator">&amp;&amp;</span>op1_d<span class="token punctuation">[</span><span class="token constant">`Op1Zero</span><span class="token punctuation">]</span><span class="token operator">&amp;&amp;</span>func_d<span class="token punctuation">[</span><span class="token constant">`FuncSll</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> inst_srl <span class="token operator">=</span> op_d<span class="token punctuation">[</span><span class="token constant">`OpZero</span><span class="token punctuation">]</span><span class="token operator">&amp;&amp;</span>op1_d<span class="token punctuation">[</span><span class="token constant">`Op1Zero</span><span class="token punctuation">]</span><span class="token operator">&amp;&amp;</span>func_d<span class="token punctuation">[</span><span class="token constant">`FuncSrl</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> inst_sra <span class="token operator">=</span> op_d<span class="token punctuation">[</span><span class="token constant">`OpZero</span><span class="token punctuation">]</span><span class="token operator">&amp;&amp;</span>op1_d<span class="token punctuation">[</span><span class="token constant">`Op1Zero</span><span class="token punctuation">]</span><span class="token operator">&amp;&amp;</span>func_d<span class="token punctuation">[</span><span class="token constant">`FuncSra</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> inst_lui <span class="token operator">=</span> op_d<span class="token punctuation">[</span><span class="token constant">`OpZero</span><span class="token punctuation">]</span><span class="token operator">&amp;&amp;</span>op1_d<span class="token punctuation">[</span><span class="token constant">`Op1Zero</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> aluop_o <span class="token operator">=</span> <span class="token punctuation">(</span>rst <span class="token operator">==</span> <span class="token constant">`RstEnable</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">14'b0</span> <span class="token punctuation">:</span>
        <span class="token operator">{</span>
            inst_add<span class="token punctuation">,</span>
            inst_addu<span class="token punctuation">,</span>
            inst_sub<span class="token punctuation">,</span>
            inst_subu<span class="token punctuation">,</span>
            inst_slt<span class="token punctuation">,</span>
            inst_sltu<span class="token punctuation">,</span>
            inst_and<span class="token punctuation">,</span>
            inst_or<span class="token punctuation">,</span>
            inst_xor<span class="token punctuation">,</span>
            inst_nor<span class="token punctuation">,</span>
            inst_sll<span class="token punctuation">,</span>
            inst_srl<span class="token punctuation">,</span>
            inst_sra<span class="token punctuation">,</span>
            inst_lui
         <span class="token operator">}</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> reg1_addr_o <span class="token operator">=</span> <span class="token punctuation">(</span>rst <span class="token operator">==</span> <span class="token constant">`RstEnable</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token constant">`ZeroRegAddr</span> <span class="token punctuation">:</span> inst_i<span class="token punctuation">[</span><span class="token number">25</span><span class="token punctuation">:</span><span class="token number">21</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> reg2_addr_o <span class="token operator">=</span> <span class="token punctuation">(</span>rst <span class="token operator">==</span> <span class="token constant">`RstEnable</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token constant">`ZeroRegAddr</span> <span class="token punctuation">:</span> inst_i<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> reg1_read_o <span class="token operator">=</span> <span class="token punctuation">(</span>rst <span class="token operator">==</span> <span class="token constant">`RstEnable</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token constant">`ReadDisable</span> <span class="token punctuation">:</span> <span class="token operator">!</span><span class="token punctuation">(</span>inst_sll <span class="token operator">||</span> inst_srl <span class="token operator">||</span> inst_sra <span class="token operator">||</span> inst_lui<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> reg2_read_o <span class="token operator">=</span> <span class="token punctuation">(</span>rst <span class="token operator">==</span> <span class="token constant">`RstEnable</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token constant">`ReadDisable</span> <span class="token punctuation">:</span> <span class="token operator">!</span><span class="token punctuation">(</span>inst_lui<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">wire</span><span class="token punctuation">[</span><span class="token constant">`RegDataBus</span><span class="token punctuation">]</span>imm<span class="token punctuation">;</span>
    <span class="token keyword">assign</span> imm <span class="token operator">=</span> rst <span class="token operator">?</span> <span class="token constant">`ZeroWord</span> <span class="token punctuation">:</span> 
        <span class="token punctuation">(</span>inst_lui <span class="token operator">?</span> <span class="token operator">{</span>inst_i<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">16'b0</span><span class="token operator">}</span> <span class="token punctuation">:</span> <span class="token operator">{</span><span class="token number">27'b0</span><span class="token punctuation">,</span>inst_i<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token operator">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> reg1_o <span class="token operator">=</span> rst <span class="token operator">?</span> <span class="token constant">`ZeroWord</span> <span class="token punctuation">:</span>
        <span class="token punctuation">(</span>reg1_read_o <span class="token operator">?</span> reg1_data_i <span class="token punctuation">:</span> imm<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> reg2_o <span class="token operator">=</span> rst <span class="token operator">?</span> <span class="token constant">`ZeroWord</span> <span class="token punctuation">:</span> 
        <span class="token punctuation">(</span>reg2_read_o <span class="token operator">?</span> reg2_data_i <span class="token punctuation">:</span> imm<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> wd_o <span class="token operator">=</span> rst <span class="token operator">?</span> <span class="token constant">`ZeroRegAddr</span> <span class="token punctuation">:</span> 
        <span class="token punctuation">(</span>inst_lui <span class="token operator">?</span> inst_i<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">16</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> inst_i<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">:</span><span class="token number">11</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> wreg_o <span class="token operator">=</span> rst <span class="token operator">?</span> <span class="token constant">`WriteDisable</span> <span class="token punctuation">:</span> <span class="token constant">`WriteEnable</span><span class="token punctuation">;</span>
<span class="token keyword">endmodule</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br></div></div><p>测试代码：id_tb.v</p> <div class="language-verilog line-numbers-mode"><pre class="language-verilog"><code><span class="token constant">`timescale</span> <span class="token number">1</span>ns <span class="token operator">/</span> <span class="token number">1</span>ps

<span class="token keyword">module</span> <span class="token function">id_tb</span><span class="token punctuation">(</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">reg</span> rst<span class="token punctuation">;</span>
    <span class="token keyword">reg</span><span class="token punctuation">[</span><span class="token constant">`InstBus</span><span class="token punctuation">]</span>inst_i<span class="token punctuation">;</span>
    <span class="token keyword">reg</span><span class="token punctuation">[</span><span class="token constant">`RegDataBus</span><span class="token punctuation">]</span>reg1_data_i<span class="token punctuation">;</span>
    <span class="token keyword">reg</span><span class="token punctuation">[</span><span class="token constant">`RegDataBus</span><span class="token punctuation">]</span>reg2_data_i<span class="token punctuation">;</span>
    <span class="token keyword">wire</span><span class="token punctuation">[</span><span class="token constant">`Aluop_OnehotBus</span><span class="token punctuation">]</span>aluop_o<span class="token punctuation">;</span>
    <span class="token keyword">wire</span><span class="token punctuation">[</span><span class="token constant">`RegDataBus</span><span class="token punctuation">]</span>reg1_o<span class="token punctuation">;</span>
    <span class="token keyword">wire</span><span class="token punctuation">[</span><span class="token constant">`RegDataBus</span><span class="token punctuation">]</span>reg2_o<span class="token punctuation">;</span>
    <span class="token keyword">wire</span><span class="token punctuation">[</span><span class="token constant">`RegAddrBus</span><span class="token punctuation">]</span>wd_o<span class="token punctuation">;</span>
    <span class="token keyword">wire</span> wreg_o<span class="token punctuation">;</span>
    <span class="token keyword">wire</span><span class="token punctuation">[</span><span class="token constant">`RegAddrBus</span><span class="token punctuation">]</span>reg1_addr_o<span class="token punctuation">;</span>
    <span class="token keyword">wire</span><span class="token punctuation">[</span><span class="token constant">`RegAddrBus</span><span class="token punctuation">]</span>reg2_addr_o<span class="token punctuation">;</span>
    <span class="token keyword">wire</span> reg1_read_o<span class="token punctuation">;</span>
    <span class="token keyword">wire</span> reg2_read_o<span class="token punctuation">;</span>
    id <span class="token function">id0</span><span class="token punctuation">(</span>rst<span class="token punctuation">,</span>inst_i<span class="token punctuation">,</span>reg1_data_i<span class="token punctuation">,</span>reg2_data_i<span class="token punctuation">,</span>aluop_o<span class="token punctuation">,</span>reg1_o<span class="token punctuation">,</span>reg2_o<span class="token punctuation">,</span>wd_o<span class="token punctuation">,</span>wreg_o<span class="token punctuation">,</span>reg1_addr_o<span class="token punctuation">,</span>reg2_addr_o<span class="token punctuation">,</span>reg1_read_o<span class="token punctuation">,</span>reg2_read_o<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">reg</span><span class="token punctuation">[</span><span class="token constant">`InstBus</span><span class="token punctuation">]</span>inst_mem<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">127</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">initial</span> <span class="token keyword">begin</span>
        <span class="token kernel-function property">$readmemh</span><span class="token punctuation">(</span><span class="token string">&quot;C:/File/vivado/inst_rom.data&quot;</span> <span class="token punctuation">,</span> inst_mem<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">end</span>
    <span class="token keyword">integer</span> i<span class="token punctuation">;</span>
    <span class="token keyword">initial</span> <span class="token keyword">begin</span>
        rst <span class="token operator">=</span> <span class="token constant">`RstEnable</span><span class="token punctuation">;</span>
        <span class="token number">#50</span><span class="token punctuation">;</span>
        rst <span class="token operator">=</span> <span class="token constant">`RstDisable</span><span class="token punctuation">;</span>
        reg1_data_i <span class="token operator">=</span> <span class="token number">32'h12345678</span><span class="token punctuation">;</span>
        reg2_data_i <span class="token operator">=</span> <span class="token number">32'h87654321</span><span class="token punctuation">;</span>
        <span class="token function">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">20</span> <span class="token punctuation">;</span> i <span class="token operator">=</span> i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token keyword">begin</span>
            inst_i <span class="token operator">=</span> inst_mem<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token number">#20</span><span class="token punctuation">;</span>
        <span class="token keyword">end</span>
        <span class="token number">#50</span> <span class="token kernel-function property">$finish</span><span class="token punctuation">;</span>
    <span class="token keyword">end</span>
<span class="token keyword">endmodule</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><h3 id="运算器-alu"><a href="#运算器-alu" class="header-anchor">#</a> 运算器 ALU</h3> <img src="/assets/img/alu.8c53bcd0.jpg"> <p>运算器接受从译码器传过来的两个操作数和操作符，计算出结果 alu_result，同时接收译码器传来的写地址和写使能，最终将输出计算结果、写地址以及写使能，送往寄存器 regfile，作为其输入</p> <div class="language-verilog line-numbers-mode"><pre class="language-verilog"><code><span class="token constant">`timescale</span> <span class="token number">1</span>ns <span class="token operator">/</span> <span class="token number">1</span>ps
<span class="token constant">`include</span><span class="token string">&quot;defines.v&quot;</span>

<span class="token keyword">module</span> <span class="token function">alu</span><span class="token punctuation">(</span>
    <span class="token keyword">input</span> <span class="token keyword">wire</span><span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span>alu_src1<span class="token punctuation">,</span> <span class="token comment">// 第一个操作数</span>
    <span class="token keyword">input</span> <span class="token keyword">wire</span><span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span>alu_src2<span class="token punctuation">,</span> <span class="token comment">// 第二个操作数</span>
    <span class="token keyword">input</span> <span class="token keyword">wire</span><span class="token punctuation">[</span><span class="token number">13</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span>alu_control<span class="token punctuation">,</span>    <span class="token comment">// 操作码</span>
    <span class="token keyword">input</span> <span class="token keyword">wire</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span>wd_i<span class="token punctuation">,</span> <span class="token comment">//写地址</span>
    <span class="token keyword">input</span> <span class="token keyword">wire</span> wreg_i<span class="token punctuation">,</span>  <span class="token comment">//写使能</span>
    <span class="token keyword">output</span> <span class="token keyword">reg</span><span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span>alu_result<span class="token punctuation">,</span> <span class="token comment">// 运算结果</span>
    <span class="token keyword">output</span> <span class="token keyword">wire</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span>wd_o<span class="token punctuation">,</span> <span class="token comment">// 写地址</span>
    <span class="token keyword">output</span> <span class="token keyword">wire</span> wreg_o <span class="token comment">// 写使能</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> wd_o <span class="token operator">=</span> wd_i<span class="token punctuation">;</span>
    <span class="token keyword">assign</span> wreg_o <span class="token operator">=</span> wreg_i<span class="token punctuation">;</span>
    <span class="token keyword">wire</span><span class="token punctuation">[</span><span class="token constant">`RegDataBus</span><span class="token punctuation">]</span>alu_src2_mux<span class="token punctuation">;</span>
    <span class="token keyword">wire</span><span class="token punctuation">[</span><span class="token constant">`RegDataBus</span><span class="token punctuation">]</span>result_sum<span class="token punctuation">;</span>
    <span class="token keyword">wire</span><span class="token punctuation">[</span><span class="token constant">`RegDataBus</span><span class="token punctuation">]</span>result_slt<span class="token punctuation">;</span>
    <span class="token keyword">assign</span> alu_src2_mux <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>alu_control <span class="token operator">==</span> <span class="token constant">`AluopSub</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>alu_control <span class="token operator">==</span> <span class="token constant">`AluopSubu</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>alu_control <span class="token operator">==</span> <span class="token constant">`AluopSlt</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">?</span>
                            <span class="token punctuation">(</span><span class="token operator">~</span>alu_src2 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> alu_src2<span class="token punctuation">;</span>
    <span class="token keyword">assign</span> result_sum <span class="token operator">=</span> alu_src1 <span class="token operator">+</span> alu_src2_mux<span class="token punctuation">;</span>
    <span class="token keyword">assign</span> result_slt <span class="token operator">=</span> <span class="token punctuation">(</span>alu_src1<span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>alu_src2<span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">||</span>
                        <span class="token punctuation">(</span><span class="token operator">!</span>alu_src1<span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>alu_src2<span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> result_sum<span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">||</span>
                        <span class="token punctuation">(</span>alu_src1<span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> alu_src2<span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> result_sum<span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token keyword">begin</span>
        <span class="token function">case</span><span class="token punctuation">(</span>alu_control<span class="token punctuation">)</span>
            <span class="token constant">`AluopAdd</span><span class="token punctuation">,</span><span class="token constant">`AluopAddu</span><span class="token punctuation">,</span><span class="token constant">`AluopSub</span><span class="token punctuation">,</span><span class="token constant">`AluopSubu</span><span class="token punctuation">:</span><span class="token keyword">begin</span>
                alu_result <span class="token operator">=</span> result_sum<span class="token punctuation">;</span>
            <span class="token keyword">end</span>
            <span class="token constant">`AluopSlt</span><span class="token punctuation">:</span><span class="token keyword">begin</span>
                alu_result <span class="token operator">=</span> result_slt<span class="token punctuation">;</span>
            <span class="token keyword">end</span>
            <span class="token constant">`AluopSltu</span><span class="token punctuation">:</span><span class="token keyword">begin</span>
                alu_result <span class="token operator">=</span> <span class="token punctuation">(</span>alu_src1 <span class="token operator">&lt;</span> alu_src2<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">end</span>
            <span class="token constant">`AluopAnd</span><span class="token punctuation">:</span><span class="token keyword">begin</span>
                alu_result <span class="token operator">=</span> alu_src1 <span class="token operator">&amp;</span> alu_src2<span class="token punctuation">;</span>
            <span class="token keyword">end</span>
            <span class="token constant">`AluopOr</span><span class="token punctuation">:</span>
                alu_result <span class="token operator">=</span> alu_src1 <span class="token operator">|</span> alu_src2<span class="token punctuation">;</span>
            <span class="token constant">`AluopXor</span><span class="token punctuation">:</span>
                alu_result <span class="token operator">=</span> alu_src1<span class="token operator">^</span>alu_src2<span class="token punctuation">;</span>
            <span class="token constant">`AluopNor</span><span class="token punctuation">:</span>
                alu_result <span class="token operator">=</span> <span class="token operator">~</span><span class="token punctuation">(</span>alu_src1<span class="token operator">^</span>alu_src2<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token constant">`AluopSll</span><span class="token punctuation">:</span>
                alu_result <span class="token operator">=</span> alu_src2 <span class="token operator">&lt;&lt;</span> alu_src1<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token constant">`AluopSrl</span><span class="token punctuation">:</span>
                alu_result <span class="token operator">=</span> alu_src2 <span class="token operator">&gt;&gt;</span> alu_src1<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token constant">`AluopSra</span><span class="token punctuation">:</span>
                alu_result <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">{</span><span class="token number">32</span><span class="token operator">{</span>alu_src2<span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">]</span><span class="token operator">}}</span> <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span><span class="token number">6'd32</span> <span class="token operator">-</span> <span class="token operator">{</span><span class="token number">1'b0</span><span class="token punctuation">,</span>alu_src1<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">|</span> 
                <span class="token punctuation">(</span>alu_src2 <span class="token operator">&gt;&gt;</span> alu_src1<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token constant">`AluopLui</span><span class="token punctuation">:</span>
                alu_result <span class="token operator">=</span> alu_src2<span class="token punctuation">;</span>
            <span class="token keyword">default</span><span class="token punctuation">:</span>
                alu_result <span class="token operator">=</span> <span class="token constant">`ZeroWord</span><span class="token punctuation">;</span>
        <span class="token keyword">endcase</span>
    <span class="token keyword">end</span>
<span class="token keyword">endmodule</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br></div></div><p>测试代码</p> <div class="language-verilog line-numbers-mode"><pre class="language-verilog"><code><span class="token constant">`timescale</span> <span class="token number">1</span>ns <span class="token operator">/</span> <span class="token number">1</span>ps
<span class="token keyword">module</span> <span class="token function">alu_tb</span><span class="token punctuation">(</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span>alu_src1<span class="token punctuation">;</span>
    <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span>alu_src2<span class="token punctuation">;</span>
    <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">13</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span>alu_control<span class="token punctuation">;</span>
    <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span>wd_i<span class="token punctuation">;</span>
    <span class="token keyword">reg</span> wreg_i<span class="token punctuation">;</span>
    <span class="token keyword">wire</span> <span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span>alu_result<span class="token punctuation">;</span>
    <span class="token keyword">wire</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span>wd_o<span class="token punctuation">;</span>
    <span class="token keyword">wire</span> wreg_o<span class="token punctuation">;</span>
    alu <span class="token function">alu0</span><span class="token punctuation">(</span>alu_src1<span class="token punctuation">,</span>alu_src2<span class="token punctuation">,</span>alu_control<span class="token punctuation">,</span>wd_i<span class="token punctuation">,</span>wreg_i<span class="token punctuation">,</span>alu_result<span class="token punctuation">,</span>wd_o<span class="token punctuation">,</span>wreg_o<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">integer</span> i<span class="token punctuation">;</span>
    <span class="token keyword">integer</span> j<span class="token punctuation">;</span>
    <span class="token keyword">initial</span> <span class="token keyword">begin</span>
        alu_control <span class="token operator">=</span> <span class="token number">14'b00_0000_0000_0001</span><span class="token punctuation">;</span>
        alu_src1 <span class="token operator">=</span> <span class="token number">32'h0101_0101</span><span class="token punctuation">;</span>
        alu_src2 <span class="token operator">=</span> <span class="token number">32'h1010_1010</span><span class="token punctuation">;</span>
        wreg_i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        wd_i <span class="token operator">=</span> <span class="token number">5'd10</span><span class="token punctuation">;</span>
        <span class="token function">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">14</span> <span class="token punctuation">;</span> i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token keyword">begin</span>
            <span class="token kernel-function property">$monitor</span><span class="token punctuation">(</span><span class="token string">&quot;alu_control = %b,alu_src1 = %h,alu_src2 = %h,alu_result = %h&quot;</span><span class="token punctuation">,</span>
            alu_control<span class="token punctuation">,</span>alu_src1<span class="token punctuation">,</span>alu_src2<span class="token punctuation">,</span>alu_result<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token number">#20</span><span class="token punctuation">;</span>
            alu_control <span class="token operator">=</span> alu_control <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">end</span>
        <span class="token kernel-function property">$finish</span><span class="token punctuation">;</span>
    <span class="token keyword">end</span>
<span class="token keyword">endmodule</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><h2 id="单周期-cpu"><a href="#单周期-cpu" class="header-anchor">#</a> 单周期 CPU</h2> <h3 id="single-cycle-cpu"><a href="#single-cycle-cpu" class="header-anchor">#</a> single_cycle_cpu</h3> <p>在这里的 singlecycle_cpu 实际上并没有包含 inst_rom，下图只是展示了单周期 CPU 的工作流程，在实际操作时，指令寄存器以外接的方式接入 singlecycle_cpu，如之后的 SOPC</p> <img src="/assets/img/singlecycle_cpu.363a46f5.jpg"> <p>singlecycle_cpu.v</p> <div class="language-verilog line-numbers-mode"><pre class="language-verilog"><code><span class="token constant">`timescale</span> <span class="token number">1</span>ns <span class="token operator">/</span> <span class="token number">1</span>ps
<span class="token constant">`include</span> <span class="token string">&quot;./defines.v&quot;</span>

<span class="token keyword">module</span> <span class="token function">singlecycle_cpu</span><span class="token punctuation">(</span>
    <span class="token keyword">input</span> <span class="token keyword">wire</span> rst<span class="token punctuation">,</span>
    <span class="token keyword">input</span> <span class="token keyword">wire</span> clk<span class="token punctuation">,</span>
    <span class="token keyword">input</span> <span class="token keyword">wire</span><span class="token punctuation">[</span><span class="token constant">`InstBus</span><span class="token punctuation">]</span> inst_i<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token keyword">wire</span> rom_ce_o<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token keyword">wire</span><span class="token punctuation">[</span><span class="token constant">`InstAddrBus</span><span class="token punctuation">]</span>rom_addr_o
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    pc <span class="token function">pc0</span><span class="token punctuation">(</span>rst<span class="token punctuation">,</span>clk<span class="token punctuation">,</span>rom_addr_o<span class="token punctuation">,</span>rom_ce_o<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">wire</span><span class="token punctuation">[</span><span class="token constant">`RegDataBus</span><span class="token punctuation">]</span>reg1_data<span class="token punctuation">;</span>
    <span class="token keyword">wire</span><span class="token punctuation">[</span><span class="token constant">`RegDataBus</span><span class="token punctuation">]</span>reg2_data<span class="token punctuation">;</span>
    <span class="token keyword">wire</span><span class="token punctuation">[</span><span class="token constant">`Aluop_OnehotBus</span><span class="token punctuation">]</span>id_aluop_o<span class="token punctuation">;</span>
    <span class="token keyword">wire</span><span class="token punctuation">[</span><span class="token constant">`RegDataBus</span><span class="token punctuation">]</span>id_reg1_o<span class="token punctuation">;</span>
    <span class="token keyword">wire</span><span class="token punctuation">[</span><span class="token constant">`RegDataBus</span><span class="token punctuation">]</span>id_reg2_o<span class="token punctuation">;</span>
    <span class="token keyword">wire</span><span class="token punctuation">[</span><span class="token constant">`RegAddrBus</span><span class="token punctuation">]</span>id_wd_o<span class="token punctuation">;</span>
    <span class="token keyword">wire</span> id_wreg_o<span class="token punctuation">;</span>
    <span class="token keyword">wire</span><span class="token punctuation">[</span><span class="token constant">`RegAddrBus</span><span class="token punctuation">]</span>reg1_addr<span class="token punctuation">;</span>
    <span class="token keyword">wire</span><span class="token punctuation">[</span><span class="token constant">`RegAddrBus</span><span class="token punctuation">]</span>reg2_addr<span class="token punctuation">;</span>
    <span class="token keyword">wire</span> reg1_read<span class="token punctuation">;</span>
    <span class="token keyword">wire</span> reg2_read<span class="token punctuation">;</span>
    id <span class="token function">id0</span><span class="token punctuation">(</span>rst<span class="token punctuation">,</span>inst_i<span class="token punctuation">,</span>reg1_data<span class="token punctuation">,</span>reg2_data<span class="token punctuation">,</span>id_aluop_o<span class="token punctuation">,</span>id_reg1_o<span class="token punctuation">,</span>id_reg2_o<span class="token punctuation">,</span>
            id_wd_o<span class="token punctuation">,</span>id_wreg_o<span class="token punctuation">,</span>reg1_addr<span class="token punctuation">,</span>reg2_addr<span class="token punctuation">,</span>reg1_read<span class="token punctuation">,</span>reg2_read<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">wire</span><span class="token punctuation">[</span><span class="token constant">`RegAddrBus</span><span class="token punctuation">]</span>ex_wd<span class="token punctuation">;</span>
    <span class="token keyword">wire</span><span class="token punctuation">[</span><span class="token constant">`RegDataBus</span><span class="token punctuation">]</span>ex_wdata_o<span class="token punctuation">;</span>
    <span class="token keyword">wire</span> ex_wreg<span class="token punctuation">;</span>
    regfile <span class="token function">regfile0</span><span class="token punctuation">(</span>rst<span class="token punctuation">,</span>clk<span class="token punctuation">,</span>ex_wd<span class="token punctuation">,</span>ex_wdata_o<span class="token punctuation">,</span>ex_wreg<span class="token punctuation">,</span>reg1_addr<span class="token punctuation">,</span>reg1_read<span class="token punctuation">,</span>reg1_data<span class="token punctuation">,</span>
                        reg2_addr<span class="token punctuation">,</span>reg2_read<span class="token punctuation">,</span>reg2_data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    alu <span class="token function">alu0</span><span class="token punctuation">(</span>id_reg1_o<span class="token punctuation">,</span>id_reg2_o<span class="token punctuation">,</span>id_aluop_o<span class="token punctuation">,</span>id_wd_o<span class="token punctuation">,</span>id_wreg_o<span class="token punctuation">,</span>ex_wdata_o<span class="token punctuation">,</span>ex_wd<span class="token punctuation">,</span>ex_wreg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
<span class="token keyword">endmodule</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><h3 id="sopc"><a href="#sopc" class="header-anchor">#</a> SOPC</h3> <p>SOPC：System on programmable chip</p> <img src="/assets/img/SOPC.b7f63278.jpg"> <p>将 inst_rom 接入单周期 CPU，完成闭环</p> <p>mips_sopc.v</p> <div class="language-verilog line-numbers-mode"><pre class="language-verilog"><code><span class="token constant">`timescale</span> <span class="token number">1</span>ns <span class="token operator">/</span> <span class="token number">1</span>ps
<span class="token constant">`include</span> <span class="token string">&quot;./defines.v&quot;</span>

<span class="token keyword">module</span> <span class="token function">mips_sopc</span><span class="token punctuation">(</span>
    <span class="token keyword">input</span> <span class="token keyword">wire</span> clk<span class="token punctuation">,</span>
    <span class="token keyword">input</span> <span class="token keyword">wire</span> rst
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">wire</span> rom_ce<span class="token punctuation">;</span>
    <span class="token keyword">wire</span><span class="token punctuation">[</span><span class="token constant">`InstAddrBus</span><span class="token punctuation">]</span>inst_addr<span class="token punctuation">;</span>
    <span class="token keyword">wire</span><span class="token punctuation">[</span><span class="token constant">`InstBus</span><span class="token punctuation">]</span>inst<span class="token punctuation">;</span>
    singlecycle_cpu <span class="token function">singlecycle_cpu0</span><span class="token punctuation">(</span>rst<span class="token punctuation">,</span>clk<span class="token punctuation">,</span>inst<span class="token punctuation">,</span>rom_ce<span class="token punctuation">,</span>inst_addr<span class="token punctuation">)</span><span class="token punctuation">;</span>
    inst_rom <span class="token function">inst_rom0</span><span class="token punctuation">(</span>rom_ce<span class="token punctuation">,</span>inst_addr<span class="token punctuation">,</span>inst<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">endmodule</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>测试代码：mips_sopc_tb.v</p> <div class="language-verilog line-numbers-mode"><pre class="language-verilog"><code><span class="token constant">`timescale</span> <span class="token number">1</span>ns <span class="token operator">/</span> <span class="token number">1</span>ps
<span class="token keyword">module</span> <span class="token function">mips_sopc_tb</span><span class="token punctuation">(</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">reg</span> clk<span class="token punctuation">;</span>
    <span class="token keyword">reg</span> rst<span class="token punctuation">;</span>
    mips_sopc <span class="token function">mips_sopc0</span><span class="token punctuation">(</span>clk<span class="token punctuation">,</span>rst<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">initial</span> <span class="token keyword">begin</span>
        rst <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token number">#100</span><span class="token punctuation">;</span>
        rst <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token number">#1000</span> <span class="token kernel-function property">$finish</span><span class="token punctuation">;</span>
    <span class="token keyword">end</span>
    <span class="token keyword">initial</span> <span class="token keyword">begin</span>
        clk <span class="token operator">=</span> <span class="token number">1'b0</span><span class="token punctuation">;</span>
        <span class="token keyword">forever</span> <span class="token number">#10</span> clk <span class="token operator">=</span> <span class="token operator">~</span>clk<span class="token punctuation">;</span>
    <span class="token keyword">end</span>
    
<span class="token keyword">endmodule</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div></div></div> <!----> <div class="page-edit"><!----> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2025/05/30, 18:13:44</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/2e3aff/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">CPU 系统</div></a> <a href="/pages/566a23/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">五级流水 CPU 设计与实现</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/2e3aff/" class="prev">CPU 系统</a></span> <span class="next"><a href="/pages/566a23/">五级流水 CPU 设计与实现</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/706b77/"><div>
            先进数据库技术（二）
            <!----></div></a> <span class="date">6-20</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/aecc6a/"><div>
            Java 静态代码分析
            <!----></div></a> <span class="date">6-19</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/2ce9d5/"><div>
            基于可擦除签名的权限切换协议
            <!----></div></a> <span class="date">6-5</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:Arkrypto@qq.com" title="邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/Arkrypto" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/#/my/m/music/playlist?id=5123040741" title="音乐" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2021-2025
    <span>Arkrypto | <a href="https://github.com/Arkrypto/Arkrypto.github.io/blob/main/LICENSE" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <div class="body-bg" style="background:url() center center / cover no-repeat;opacity:0.5;"></div> <!----> <!----></div><div class="global-ui"><div class="reco-bgm-panel" data-v-b1d3339e><audio id="bgm" src="/song/The Sun Also Rises.mp3" data-v-b1d3339e></audio> <div class="reco-float-box" style="bottom:10px;z-index:999999;background-color:blackcadetblue;display:none;" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><img src="/img/logo.png" data-v-b1d3339e></div> <div class="reco-bgm-box" style="left:10px;bottom:10px;z-index:999999;" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><div class="reco-bgm-cover" style="background-image:url(/img/logo.png);" data-v-b1d3339e><div class="mini-operation" style="display:none;" data-v-b1d3339e><i class="reco-bgm reco-bgm-pause" style="display:none;" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-play" style="display:none;" data-v-b1d3339e></i></div> <div class="falut-message" style="display:none;" data-v-b1d3339e>
          播放失败
        </div></div> <div class="reco-bgm-info" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><div class="info-box" data-v-b1d3339e><i class="reco-bgm reco-bgm-music music" data-v-b1d3339e></i>太阳照常升起</div> <div class="info-box" data-v-b1d3339e><i class="reco-bgm reco-bgm-artist" data-v-b1d3339e></i>久石譲</div> <div class="reco-bgm-progress" data-v-b1d3339e><div class="progress-bar" data-v-b1d3339e><div class="bar" data-v-b1d3339e></div></div></div> <div class="reco-bgm-operation" data-v-b1d3339e><i class="reco-bgm reco-bgm-last last" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-pause pause" style="display:none;" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-play play" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-next next" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-volume1 volume" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-mute mute" style="display:none;" data-v-b1d3339e></i> <div class="volume-bar" data-v-b1d3339e><div class="bar" data-v-b1d3339e></div></div></div></div> <div class="reco-bgm-left-box" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><i class="reco-bgm reco-bgm-left" data-v-b1d3339e></i></div></div></div></div></div>
    <script src="/assets/js/app.ba90bb8b.js" defer></script><script src="/assets/js/3.a94f18cb.js" defer></script><script src="/assets/js/37.75de189e.js" defer></script><script src="/assets/js/29.94ccb989.js" defer></script>
  </body>
</html>
