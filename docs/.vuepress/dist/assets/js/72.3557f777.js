(window.webpackJsonp=window.webpackJsonp||[]).push([[72],{1562:function(s,t,a){"use strict";a.r(t);var n=a(4),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"消息队列模型"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#消息队列模型"}},[s._v("#")]),s._v(" 消息队列模型")]),s._v(" "),t("h3",{attrs:{id:"点对点模型"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#点对点模型"}},[s._v("#")]),s._v(" 点对点模型")]),s._v(" "),t("p",[s._v("队列模型，又叫点对点模型，每个生产者对应一个消费者（一对一）")]),s._v(" "),t("p",[s._v("比如 OJ 中 MQ 的使用，后端收到判题请求后，先将判题记录写入数据库，而后作为生产者将判题记录 ID 写入消息队列，此时真正的判题模块由于订阅了该判题队列，于是自动从 MQ 中读出判题请求 ID，从 DB 中拿取数据执行判题业务，最后通过 WebSocket 返回")]),s._v(" "),t("h3",{attrs:{id:"订阅发布模型"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#订阅发布模型"}},[s._v("#")]),s._v(" 订阅发布模型")]),s._v(" "),t("p",[s._v("订阅发布模型，一个生产者将把消息广播到每一个订阅者，即一对多")]),s._v(" "),t("p",[s._v("订阅发布能够将串行执行的任务变成“并行”，例如以下串行场景，他是一步步执行")]),s._v(" "),t("img",{attrs:{src:a(959)}}),s._v(" "),t("p",[s._v("若引入 MQ，它可以变成这样的形式，这是合理的，实际上，更新积分、通知商家、更新用户标签这三个事件并没有直接的逻辑联系或是执行顺序问题，他们都是由“更新订单状态触发”")]),s._v(" "),t("img",{attrs:{src:a(960)}}),s._v(" "),t("p",[s._v("从而大幅提高效率")]),s._v(" "),t("p",[s._v("上述订阅发布模式的举例是 MQ 一大应用场景，"),t("strong",[s._v("异步处理")]),s._v("，而队列模式的举例是"),t("strong",[s._v("应用解耦")]),s._v("，消息队列的常用场景如下")]),s._v(" "),t("ul",[t("li",[s._v("异步处理：就是将一些非核心的业务流程以异步并行的方式执行，从而减少请求响应时间，提高系统吞吐量")]),s._v(" "),t("li",[s._v("应用解耦：顾名思义就是解除应用系统之间的耦合依赖。通过消息队列，使得每个应用系统不必受其他系统影响，可以更独立自主运行")]),s._v(" "),t("li",[s._v("流量削峰：是消息队列中的常用场景，一般在秒杀或团抢活动中使用广泛")]),s._v(" "),t("li",[s._v("消息通讯：指应用间的数据通信，消息队列一般都内置了高效的通信机制，因此也可以用在纯的消息通讯。比如实现点对点消息队列，或者聊天室等点对点通讯")])]),s._v(" "),t("h2",{attrs:{id:"rabbitmq"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#rabbitmq"}},[s._v("#")]),s._v(" RabbitMQ")]),s._v(" "),t("h3",{attrs:{id:"安装部署"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装部署"}},[s._v("#")]),s._v(" 安装部署")]),s._v(" "),t("p",[s._v("manjaro 安装")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("yay "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-S")]),s._v(" rabbitmq rabbitmqadmin\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("启动")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" rabbitmq-plugins "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" rabbitmq-server\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("默认端口")]),s._v(" "),t("ul",[t("li",[s._v("管理界面：15672")]),s._v(" "),t("li",[s._v("客户端：5672")])]),s._v(" "),t("p",[s._v("后台运行")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("rabbitmq-server "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-detached")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"spring-集成"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#spring-集成"}},[s._v("#")]),s._v(" Spring 集成")]),s._v(" "),t("p",[s._v("引入 RabbitMQ 依赖")]),s._v(" "),t("div",{staticClass:"language-xml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-xml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("dependency")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("groupId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("org.springframework.boot"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("groupId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("artifactId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("spring-boot-starter-amqp"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("artifactId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("dependency")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("配置文件")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spring")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("rabbitmq")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n\t\t"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 10.2.1.231\n\t\t"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5672")]),s._v("\n\t\t"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("username")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" northboat\n\t\t"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("password")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v("\n\t\t"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("virtualHost")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" order\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v('一个简单的消费者，订阅队列"'),t("code",[s._v('rabbitmq_queue"')])]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Component")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Consumer")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@RabbitHandler")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@RabbitListener")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("queuesToDeclare "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Queue")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"rabbitmq_queue"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("process")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" message"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\t"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"消费者消费消息: "')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" message"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[s._v("一个简单的生产者")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Component")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Producer")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Autowired")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RabbitTemplate")]),s._v(" rabbitTemplate"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t\n\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("produce")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\t"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" message "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Date")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Beijing"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t\t"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"生产者产生消息: "')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" message"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t\trabbitTemplate"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("convertAndSend")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"rabbitmq_queue"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" message"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("p",[s._v("这里传输的是简单字符串，我们尝试传输一个实体对象 User，需要进行序列化，即继承"),t("code",[s._v("Serializable")]),s._v("类")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("User")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implements")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Serializable")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" password"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 省略get和set方法")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("仍然通过"),t("code",[s._v("convertAndSend")]),s._v("方法进行传输")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Component")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Producer")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Autowired")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RabbitTemplate")]),s._v(" rabbitTemplate"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t\n\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("produce")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\t\n\t\t"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("User")]),s._v(" user "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("User")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nmsl"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"wdnmd"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t\t"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"生产者生产消息: "')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" user"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t\t\n\t\trabbitTemplate"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("convertAndSend")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"rabbitmq_queue_object"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" user"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("p",[s._v("convertAndSend() 方法支持 String、Integer、Object 等基础的数据类型")]),s._v(" "),t("h2",{attrs:{id:"确保可靠传输"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#确保可靠传输"}},[s._v("#")]),s._v(" 确保可靠传输")]),s._v(" "),t("p",[s._v("在使用消息队列时，因为生产者和消费者不直接交互，所以面临下面几个问题")]),s._v(" "),t("ol",[t("li",[s._v("要把消息添加到队列中，怎么保证消息成功添加？")]),s._v(" "),t("li",[s._v("如何保证消息发送出去时一定会被消费者正常消费？")]),s._v(" "),t("li",[s._v("消费者正常消费了，生产者或者队列如何知道消费者已经成功消费了消息？")])]),s._v(" "),t("p",[s._v("那么，如何保证消息 100% 可靠性发送？我们可以采用 ack 应答 + 日志记录 + 定时任务来实现")]),s._v(" "),t("p",[s._v("假设有一个创建订单业务，后端收到请求后，将该业务通过消息队列发送到具体的业务模块，我们这样保证消息的可靠传输")]),s._v(" "),t("ol",[t("li",[s._v("完成订单业务处理后，生产者发送一条消息到消息队列，同时记录这条操作日志（发送中）")]),s._v(" "),t("li",[s._v("消费者收到消息后处理进行")]),s._v(" "),t("li",[s._v("消费者处理成功后给消息队列发送 ack 应答")]),s._v(" "),t("li",[s._v("消息队列收到 ack 应答后，给生成者的 Confirm Listener 发送确认")]),s._v(" "),t("li",[s._v("生产者对消息日志表进行操作，修改之前的日志状态（发送成功）")]),s._v(" "),t("li",[s._v("在消费端返回应答的过程中，可能发生网络异常，导致生产者未收到应答消息，因此需要一个定时任务去提取其状态为“发送中”并已经超时的消息集合")]),s._v(" "),t("li",[s._v("使用定时任务判断为消息事先设置的最大重发次数，大于最大重发次数就判断消息发送失败，更新日志记录状态为发送失败")])]),s._v(" "),t("p",[s._v("流程图如下")]),s._v(" "),t("img",{attrs:{src:a(961)}}),s._v(" "),t("p",[s._v("具体实现")]),s._v(" "),t("p",[s._v("1️⃣ 创建生产者")]),s._v(" "),t("p",[s._v("定义应答方法"),t("code",[s._v("final RabbitTemplate.ConfirmCallback confirmCallback = new RabbitTemplate.ConfirmCallback() {}")]),s._v("，即定义收到消费者发回的 ack 应答后的处理：更新日志记录，修改订单状态为成功")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Component")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RabbitOrderSender")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Logger")]),s._v(" logger "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LoggerFactory")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getLogger")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RabbitOrderSender")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Autowired")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RabbitTemplate")]),s._v(" rabbitTemplate"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Autowired")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MessageLogMapper")]),s._v(" messageLogMapper"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/**\n     * Broker应答后，会调用该方法区获取应答结果\n     */")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RabbitTemplate"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ConfirmCallback")]),s._v(" confirmCallback "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RabbitTemplate"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ConfirmCallback")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("confirm")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CorrelationData")]),s._v(" correlationData"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" ack"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" cause"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            logger"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("info")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"correlationData："')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("correlationData"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" messageId "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" correlationData"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            logger"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("info")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"消息确认返回值："')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("ack"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ack"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//如果返回成功，则进行更新")]),s._v("\n                messageLogMapper"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("changeMessageLogStatus")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("messageId"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Constans")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ORDER_SEND_SUCCESS")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Date")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//失败进行操作：根据具体失败原因选择重试或补偿等手段")]),s._v("\n                logger"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("error")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"异常处理,返回结果："')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("cause"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/**\n     * 发送消息方法调用: 构建自定义对象消息\n     * @param order\n     * @throws Exception\n     */")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sendOrder")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("OrderInfo")]),s._v(" order"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Exception")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 通过实现 ConfirmCallback 接口，消息发送到 Broker 后触发回调，确认消息是否到达 Broker 服务器，也就是只确认是否正确到达 Exchange 中")]),s._v("\n        rabbitTemplate"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setConfirmCallback")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("confirmCallback"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//消息唯一ID")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CorrelationData")]),s._v(" correlationData "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CorrelationData")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("order"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getMessageId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        rabbitTemplate"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("convertAndSend")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"order.exchange"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"order.message"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" order"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" correlationData"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br")])]),t("p",[s._v("当生产者调用"),t("code",[s._v("ConfirmCallback()")]),s._v("，说明当前请求已被消费者消费")]),s._v(" "),t("p",[s._v("2️⃣ 定义消息定时重发任务")]),s._v(" "),t("p",[s._v("定期去数据库中找状态为 0 的数据项，进行消息重发")]),s._v(" "),t("ul",[t("li",[s._v("通过"),t("code",[s._v("@Compoent")]),s._v("和"),t("code",[s._v("@Scheduled(initialDelay = 5000, fixedDelay = 10000)")]),s._v("注解将定时任务注入 Spring，初始 5 s 后开始执行，往后每 10s 执行一次")]),s._v(" "),t("li",[s._v("判断逻辑为：当重发大于两次，认为任务失败，不再执行，否则通过 RabbitOrderSender 进行重发")])]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Component")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RetryMessageTasker")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Logger")]),s._v(" logger "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LoggerFactory")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getLogger")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RetryMessageTasker")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Autowired")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RabbitOrderSender")]),s._v(" rabbitOrderSender"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Autowired")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MessageLogMapper")]),s._v(" messageLogMapper"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/**\n     * 定时任务\n     */")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Scheduled")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("initialDelay "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" fixedDelay "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("reSend")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        logger"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("info")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-----------定时任务开始-----------"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//抽取消息状态为0且已经超时的消息集合")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("List")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MessageLog")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" list "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" messageLogMapper"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("query4StatusAndTimeoutMessage")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        list"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("forEach")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("messageLog "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//投递三次以上的消息")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("messageLog"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getTryCount")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//更新失败的消息")]),s._v("\n                messageLogMapper"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("changeMessageLogStatus")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("messageLog"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getMessageId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Constans")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ORDER_SEND_FAILURE")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Date")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 重试投递消息，将重试次数递增")]),s._v("\n                messageLogMapper"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("update4ReSend")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("messageLog"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getMessageId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Date")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("OrderInfo")]),s._v(" reSendOrder "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("JsonUtil")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("jsonToObject")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("messageLog"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getMessage")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("OrderInfo")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    rabbitOrderSender"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sendOrder")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("reSendOrder"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Exception")]),s._v(" e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("printStackTrace")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                    logger"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("error")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-----------异常处理-----------"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br")])]),t("p",[s._v("3️⃣ 运行测试")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@RunWith")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SpringRunner")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@SpringBootTest")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MqApplicationTests")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Autowired")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("OrderService")]),s._v(" orderService"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/**\n     * 测试订单创建\n     */")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Test")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("createOrder")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("OrderInfo")]),s._v(" order "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("OrderInfo")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        order"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"201901236"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        order"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setName")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"测试订单6"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        order"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setMessageId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("currentTimeMillis")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"$"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("UUID")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("randomUUID")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("toString")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            orderService"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("createOrder")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("order"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Exception")]),s._v(" e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("printStackTrace")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br")])]),t("h2",{attrs:{id:"消息队列的选择"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#消息队列的选择"}},[s._v("#")]),s._v(" 消息队列的选择")]),s._v(" "),t("h3",{attrs:{id:"kafka-vs-rabbitmq"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#kafka-vs-rabbitmq"}},[s._v("#")]),s._v(" Kafka VS RabbitMQ")]),s._v(" "),t("p",[s._v("Kafka 设计之初是用于处理大批量的日志，基于自定义的二进制协议，专注于高吞吐量，其特点如下")]),s._v(" "),t("p",[s._v("而 RabbitMQ 的设计目标是"),t("strong",[s._v("低延迟")]),s._v("和"),t("strong",[s._v("可靠传递")]),s._v("，它的消息确认机制和重试机制可以确保任务被正确处理，适合高并发的任务，常用于业务的解耦、异步处理")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("消息队列")]),s._v(" "),t("th",[s._v("协议")]),s._v(" "),t("th",[s._v("消息传输")]),s._v(" "),t("th",[s._v("实时性")]),s._v(" "),t("th",[s._v("扩展性")]),s._v(" "),t("th",[s._v("持久化")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("Kafka")]),s._v(" "),t("td",[s._v("基于自定义的二进制协议，专注于高吞吐量")]),s._v(" "),t("td",[s._v("消息以"),t("strong",[s._v("日志")]),s._v("的形式持久化存储，支持高吞吐量的消息流；不支持消息确认（ACK）和重试机制，但可以通过消费者偏移量（Offset）实现消息重放")]),s._v(" "),t("td",[s._v("延迟较高，适合批量处理")]),s._v(" "),t("td",[s._v("支持分布式集群，可以轻松扩展到数百个节点，处理海量数据")]),s._v(" "),t("td",[s._v("消息持久化到磁盘，支持长期存储和回溯")])]),s._v(" "),t("tr",[t("td",[s._v("RabbitMQ")]),s._v(" "),t("td",[s._v("基于 AMQP（Advanced Message Queuing Protocol），支持多种消息模式（如点对点、发布/订阅）")]),s._v(" "),t("td",[s._v("支持消息确认（ACK）和重试机制，确保消息可靠传递；支持消息优先级、延迟队列、死信队列等高级特性")]),s._v(" "),t("td",[s._v("适合低延迟的消息传递")]),s._v(" "),t("td",[s._v("支持复杂的路由规则（如 direct、topic、fanout 等交换器）")]),s._v(" "),t("td",[s._v("可以通过集群实现高可用性，但扩展性相对有限")])])])]),s._v(" "),t("p",[s._v("什么是 AMQP（Advanced Message Queuing Protocol）")]),s._v(" "),t("p",[s._v("RabbitMQ 的适用场景")]),s._v(" "),t("ul",[t("li",[s._v("任务队列：适合需要"),t("strong",[s._v("实时处理")]),s._v("的任务，例如 Web 应用中的异步任务（如发送邮件、处理订单）")]),s._v(" "),t("li",[s._v("低延迟场景：需要"),t("strong",[s._v("快速响应")]),s._v("的场景，例如实时通知、即时消息")]),s._v(" "),t("li",[s._v("复杂路由：需要根据消息内容或规则将消息路由到不同消费者的场景")]),s._v(" "),t("li",[s._v("可靠传递：需要确保"),t("strong",[s._v("每条消息都被正确处理")]),s._v("，适合对消息丢失敏感的场景")])]),s._v(" "),t("p",[s._v("Kafka 使用场景")]),s._v(" "),t("ul",[t("li",[s._v("日志收集：适合收集和存储大量日志数据，例如应用程序日志、系统日志")]),s._v(" "),t("li",[s._v("流处理：适合实时"),t("strong",[s._v("流处理场景")]),s._v("，例如用户行为分析、实时推荐系统")]),s._v(" "),t("li",[s._v("大数据管道：适合作为"),t("strong",[s._v("大数据")]),s._v("生态系统的数据传输管道，例如将数据从生产系统传输到 Hadoop 或 Spark")]),s._v(" "),t("li",[s._v("事件溯源：适合需要"),t("strong",[s._v("记录事件历史")]),s._v("的场景，例如金融交易记录、审计日志（因为数据会写入磁盘进行持久化）")])]),s._v(" "),t("p",[s._v("选择 RabbitMQ 的场景")]),s._v(" "),t("ul",[t("li",[s._v("你需要低延迟的消息传递")]),s._v(" "),t("li",[s._v("你需要复杂的路由规则（如根据消息内容路由到不同消费者）")]),s._v(" "),t("li",[s._v("你需要确保每条消息都被正确处理（如金融交易、订单处理）")]),s._v(" "),t("li",[s._v("你的系统规模较小或中等，不需要处理海量数据")])]),s._v(" "),t("p",[s._v("选择 Kafka 的场景")]),s._v(" "),t("ul",[t("li",[s._v("你需要高吞吐量的消息处理（如日志收集、用户行为分析）")]),s._v(" "),t("li",[s._v("你需要持久化存储消息，并且可能需要回溯历史消息")]),s._v(" "),t("li",[s._v("你需要流处理能力（如实时推荐、实时监控）")]),s._v(" "),t("li",[s._v("你的系统规模较大，需要处理海量数据。")])]),s._v(" "),t("p",[s._v("RabbitMQ 为什么 RabbitMQ 并发能力强于 Kafka 而 Kafka 吞吐量大于 RabbitMQ？")]),s._v(" "),t("p",[s._v("首先回答吞吐量的问题")]),s._v(" "),t("ol",[t("li",[s._v("Kafka 的吞吐量高很大原因来自于其"),t("strong",[s._v("批处理")]),s._v("设计，将多个消息打包成一个批次来减少网络和磁盘 I/O 的开销，相应的，这样处理的延迟会变大")]),s._v(" "),t("li",[s._v("另外，Kafka 不仅仅是一个消息队列，它还提供了 Kafka Streams 和 Kafka Connect 等工具，用于实现"),t("strong",[s._v("流处理")]),s._v("，从而大大提高数据处理速度")])]),s._v(" "),t("p",[s._v("什么是批处理，什么是流处理？")]),s._v(" "),t("ul",[t("li",[s._v("批处理是指对"),t("strong",[s._v("静态的、有限的数据集")]),s._v("进行处理。数据通常以文件或数据库表的形式存储，处理过程是周期性的（如每天、每小时）")]),s._v(" "),t("li",[s._v("流处理是指对"),t("strong",[s._v("连续的、无限的数据流")]),s._v("进行实时或近实时的处理。数据通常是动态生成的（如日志、传感器数据、用户行为数据）")])]),s._v(" "),t("p",[s._v("💤 PS：流处理让我想到 Java Stream 流，虽然都叫“流”，但 Java Stream 实际上是一个用于对集合（Collection）数据进行函数式操作（如过滤、映射、排序、聚合等）的 API，提供一种更简洁、更高效的方式来处理集合数据（所谓函数式编程）")]),s._v(" "),t("p",[s._v("而 RabbitMQ 的高并发显著强于 Kafka，首先我们要明确到底什么是并发能力强，并发能力强并不是只 QPS（Queries Per Second）高，1s 在计算机系统其实是一个比较大的时间跨度，以至于他反应的实际上是吞吐量而并非并发量")]),s._v(" "),t("p",[s._v("所以，这里说 RabbitMQ 的高并发能力其实指的是低延迟的处理，进行快速的实时反馈")]),s._v(" "),t("h3",{attrs:{id:"其他对比"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#其他对比"}},[s._v("#")]),s._v(" 其他对比")]),s._v(" "),t("p",[s._v("现有一些开源 MQ 的对比")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("特性\\消息队列")]),s._v(" "),t("th",[s._v("Kafka")]),s._v(" "),t("th",[s._v("RocketMQ")]),s._v(" "),t("th",[s._v("RabbitMQ")]),s._v(" "),t("th",[s._v("ActiveMQ")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("单机吞吐量")]),s._v(" "),t("td",[s._v("10万级")]),s._v(" "),t("td",[s._v("10万级")]),s._v(" "),t("td",[s._v("万级")]),s._v(" "),t("td",[s._v("10万级")])]),s._v(" "),t("tr",[t("td",[s._v("开发语言")]),s._v(" "),t("td",[s._v("Scala")]),s._v(" "),t("td",[s._v("Java")]),s._v(" "),t("td",[s._v("Erlang")]),s._v(" "),t("td",[s._v("Java")])]),s._v(" "),t("tr",[t("td",[s._v("高可用")]),s._v(" "),t("td",[s._v("分布式")]),s._v(" "),t("td",[s._v("分布式")]),s._v(" "),t("td",[s._v("主从")]),s._v(" "),t("td",[s._v("分布式")])]),s._v(" "),t("tr",[t("td",[s._v("消息延迟")]),s._v(" "),t("td",[s._v("ms级")]),s._v(" "),t("td",[s._v("ms级")]),s._v(" "),t("td",[s._v("us级")]),s._v(" "),t("td",[s._v("ms级")])]),s._v(" "),t("tr",[t("td",[s._v("消息丢失")]),s._v(" "),t("td",[s._v("理论上不会丢失")]),s._v(" "),t("td",[s._v("理论上不会丢失")]),s._v(" "),t("td",[s._v("低")]),s._v(" "),t("td",[s._v("低")])]),s._v(" "),t("tr",[t("td",[s._v("消费模式")]),s._v(" "),t("td",[s._v("拉取")]),s._v(" "),t("td",[s._v("推拉")]),s._v(" "),t("td",[s._v("推拉")]),s._v(" "),t("td")]),s._v(" "),t("tr",[t("td",[s._v("持久化")]),s._v(" "),t("td"),s._v(" "),t("td",[s._v("文件")]),s._v(" "),t("td",[s._v("内存，文件")]),s._v(" "),t("td",[s._v("内存，文件，数据库")])]),s._v(" "),t("tr",[t("td",[s._v("支持协议")]),s._v(" "),t("td",[s._v("自定义协议")]),s._v(" "),t("td",[s._v("自定义协议")]),s._v(" "),t("td",[s._v("AMQP，XMPP, SMTP,STOMP")]),s._v(" "),t("td",[s._v("AMQP,MQTT,OpenWire,STOMP")])]),s._v(" "),t("tr",[t("td",[s._v("社区活跃度")]),s._v(" "),t("td",[s._v("高")]),s._v(" "),t("td",[s._v("中")]),s._v(" "),t("td",[s._v("高")]),s._v(" "),t("td",[s._v("高")])]),s._v(" "),t("tr",[t("td",[s._v("管理界面")]),s._v(" "),t("td"),s._v(" "),t("td",[s._v("web console")]),s._v(" "),t("td",[s._v("好")]),s._v(" "),t("td",[s._v("一般")])]),s._v(" "),t("tr",[t("td",[s._v("部署难度")]),s._v(" "),t("td",[s._v("中")]),s._v(" "),t("td"),s._v(" "),t("td",[s._v("低")]),s._v(" "),t("td")]),s._v(" "),t("tr",[t("td",[s._v("部署方式")]),s._v(" "),t("td",[s._v("独立")]),s._v(" "),t("td",[s._v("独立")]),s._v(" "),t("td",[s._v("独立")]),s._v(" "),t("td",[s._v("独立，嵌入")])]),s._v(" "),t("tr",[t("td",[s._v("成熟度")]),s._v(" "),t("td",[s._v("成熟")]),s._v(" "),t("td",[s._v("比较成熟")]),s._v(" "),t("td",[s._v("成熟")]),s._v(" "),t("td",[s._v("成熟")])]),s._v(" "),t("tr",[t("td",[s._v("综合评价")]),s._v(" "),t("td",[s._v("优点：拥有强大的性能及吞吐量，兼容性很好。 缺点：由于支持消息堆积，导致延迟比较高")]),s._v(" "),t("td",[s._v("优点：性能好，稳定可靠，有活跃的中文社区，特点响应快。 缺点：兼容性较差，但随着影响力的扩大，该问题会有改善")]),s._v(" "),t("td",[s._v("优点：产品成熟，容易部署和使用，拥有灵活的路由配置。 缺点：性能和吞吐量较差，不易进行二次开发")]),s._v(" "),t("td",[s._v("优点：产品成熟，支持协议多，支持多种语言的客户端。 缺点：社区不活跃，存在消息丢失的可能")])])])])])}),[],!1,null,null,null);t.default=e.exports},959:function(s,t,a){s.exports=a.p+"assets/img/image-20250303143017426.77128625.png"},960:function(s,t,a){s.exports=a.p+"assets/img/image-20250303143143342.6d217d1f.png"},961:function(s,t){s.exports="data:image/png;base64,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"}}]);