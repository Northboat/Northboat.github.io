(window.webpackJsonp=window.webpackJsonp||[]).push([[131],{1563:function(s,a,t){"use strict";t.r(a);var e=t(4),n=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"镜像构建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#镜像构建"}},[s._v("#")]),s._v(" 镜像构建")]),s._v(" "),a("h3",{attrs:{id:"dockerfile"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dockerfile"}},[s._v("#")]),s._v(" Dockerfile")]),s._v(" "),a("p",[s._v("Dockerfile 定义了如何构建一个 Docker 镜像")]),s._v(" "),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" golang:1.20")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" /app")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" . .")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" go build -o main .")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CMD")]),s._v(" ["),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./main"')]),s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("使用"),a("code",[s._v("docker build -t myapp .")]),s._v("来构建镜像")]),s._v(" "),a("h3",{attrs:{id:"docker-compose"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose"}},[s._v("#")]),s._v(" Docker-Compose")]),s._v(" "),a("p",[s._v("定义多个 Docker 容器的运行方式")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'3'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("build")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" .\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"8080:8080"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("depends_on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" db\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("db")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mysql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.0")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("MYSQL_ROOT_PASSWORD")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" example\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("使用"),a("code",[s._v("docker-compose up -d")]),s._v("启动容器")]),s._v(" "),a("h2",{attrs:{id:"容器逃逸"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#容器逃逸"}},[s._v("#")]),s._v(" 容器逃逸")]),s._v(" "),a("p",[s._v("安全问题")]),s._v(" "),a("h2",{attrs:{id:"服务部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#服务部署"}},[s._v("#")]),s._v(" 服务部署")]),s._v(" "),a("h3",{attrs:{id:"spring-应用部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#spring-应用部署"}},[s._v("#")]),s._v(" Spring 应用部署")]),s._v(" "),a("h3",{attrs:{id:"gin-应用部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#gin-应用部署"}},[s._v("#")]),s._v(" Gin 应用部署")]),s._v(" "),a("h2",{attrs:{id:"k8s-基础"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#k8s-基础"}},[s._v("#")]),s._v(" K8s 基础")]),s._v(" "),a("p",[s._v("Kubernetes 是用于自动部署、扩展和容器化应用程序的开源系统")]),s._v(" "),a("p",[s._v("容器，"),a("strong",[s._v("轻量")]),s._v("的虚拟化技术")]),s._v(" "),a("ul",[a("li",[s._v("为应用程序提供运行环境")]),s._v(" "),a("li",[s._v("隔离运行在主机上不同进程")])]),s._v(" "),a("p",[s._v("重点在于：进程之间、进程和宿主操作系统相互隔离、互不影响，容器技术具有"),a("strong",[s._v("简化部署、快速启动、服务组合、易迁移")]),s._v("等优点")]),s._v(" "),a("h3",{attrs:{id:"docker-和-kubernetes"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-和-kubernetes"}},[s._v("#")]),s._v(" Docker 和 Kubernetes")]),s._v(" "),a("p",[s._v("Docker 三个最主要的概念")]),s._v(" "),a("ul",[a("li",[s._v("容器：运行在虚拟机上的进程")]),s._v(" "),a("li",[s._v("镜像：程序之于进程")]),s._v(" "),a("li",[s._v("仓库：镜像库")])]),s._v(" "),a("p",[s._v("Docker 能够普遍使用起来，很大程度上个得益于 Docker 的仓库里汇集了很多已经标准化的镜像，大大提升了部署效率")]),s._v(" "),a("p",[s._v("当我们使用的容器服务多了，面临的访问量增大以后，我们就需要一种工具把这些容器统一的管理起来，需要实现对这些容器的自动部署、扩展和管理，也就是俗称的容器编排")]),s._v(" "),a("ul",[a("li",[s._v("正如 OJ 项目中调用的 JDK 镜像，其实当访问量大了之后，也是需要一定的编排策略")])]),s._v(" "),a("p",[s._v("Kubernetes（K8s）正是这样一种容器编排系统，是当下最流行的管理容器的编排工具，它具有可移植性、灵活性和可扩展性，同时支持命令式/声明式配置和自动化，作为 CNCF 的一个毕业项目，拥有庞大的生态系统")]),s._v(" "),a("h3",{attrs:{id:"k3s-微服务部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#k3s-微服务部署"}},[s._v("#")]),s._v(" K3s 微服务部署")]),s._v(" "),a("p",[s._v("学习如何在 k3s 运行 Go 微服务，并进行监控")]),s._v(" "),a("ul",[a("li",[s._v("K3s 基础：安装 K3s，创建 Pod、Service、Ingress")]),s._v(" "),a("li",[s._v("容器化：\n"),a("ul",[a("li",[s._v("使用 "),a("code",[s._v("Docker")]),s._v(" 构建 Go 微服务")]),s._v(" "),a("li",[s._v("使用 "),a("code",[s._v("Helm")]),s._v(" 部署微服务")])])]),s._v(" "),a("li",[s._v("服务监控：\n"),a("ul",[a("li",[s._v("Prometheus + Grafana 进行监控")]),s._v(" "),a("li",[s._v("Loki + Promtail 进行日志采集")])])])]),s._v(" "),a("p",[s._v("K3s 是 Rancher 实验室的一个"),a("strong",[s._v("轻量级")]),s._v(" Kubernetes 发行版，是由 CNCF 完全认证的 Kubernetes 产品，适合在资源受限的硬件上使用（例如 IoT 设备），它保留了 Kubernetes 的核心功能，但通过去除一些不必要的组件（如云服务提供商集成）来减小二进制文件的大小")]),s._v(" "),a("ul",[a("li",[s._v("K3s 有一个基础二进制包，其大小不到 100MB")])]),s._v(" "),a("p",[s._v("当然了，有好就有坏，轻量级带来的是功能的缺失，例如 K3s 目前不支持在主节点上运行除 SQLite 以外的任何其他数据库，也不支持多个主节点（在选择默认容器编排器时，定义需求和目标非常重要）")]),s._v(" "),a("p",[s._v("快速安装")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-sfL")]),s._v(" https://get.k3s.io "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" -\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 检查就绪代码")]),s._v("\ntakes maybe "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v(" seconds\n\nk3s kubectl get "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("node")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])])])}),[],!1,null,null,null);a.default=n.exports}}]);